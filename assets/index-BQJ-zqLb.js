const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MainLegal-DbPSbOIJ.js","assets/MainLegal-CZOPaPYE.css","assets/MainAbout-DQHX5Iwq.js","assets/MainContact-Dq4fH2YA.js","assets/MainContact-BM86F0VK.css"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(i){if(i.ep)return;i.ep=!0;const s=n(i);fetch(i.href,s)}})();const L={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return Br(this.context.count)},getNextContextId(){return Br(this.context.count++)}};function Br(e){const t=String(e),n=t.length-1;return L.context.id+(n?String.fromCharCode(96+n):"")+t}function St(e){L.context=e}const hi=!1,pi=(e,t)=>e===t,Ee=Symbol("solid-proxy"),gi=typeof Proxy=="function",Gn=Symbol("solid-track"),en={equals:pi};let Ot=null,mi=ki;const ve=1,tn=2,wi={owned:null,cleanups:null,context:null,owner:null},In={};var B=null;let Fn=null,js=null,U=null,oe=null,ye=null,yn=0;function mt(e,t){const n=U,r=B,i=e.length===0,s=t===void 0?r:t,o=i?wi:{owned:null,cleanups:null,context:s?s.context:null,owner:s},l=i?e:()=>e(()=>X(()=>Mt(o)));B=o,U=null;try{return Re(l,!0)}finally{U=n,B=r}}function x(e,t){t=t?Object.assign({},en,t):en;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(i=i(n.value)),vi(n,i));return[_i.bind(n),r]}function Ks(e,t,n){const r=_t(e,t,!0,ve);ot(r)}function Z(e,t,n){const r=_t(e,t,!1,ve);ot(r)}function fe(e,t,n){mi=Xs;const r=_t(e,t,!1,ve);(!n||!n.render)&&(r.user=!0),ye?ye.push(r):ot(r)}function $(e,t,n){n=n?Object.assign({},en,n):en;const r=_t(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,ot(r),_i.bind(r)}function zs(e){return e&&typeof e=="object"&&"then"in e}function bi(e,t,n){let r,i,s;typeof t=="function"?(r=e,i=t,s={}):(r=!0,i=e,s=t||{});let o=null,l=In,c=null,a=!1,u="initialValue"in s,f=typeof r=="function"&&$(r);const d=new Set,[h,w]=(s.storage||x)(s.initialValue),[p,b]=x(void 0),[k,_]=x(void 0,{equals:!1}),[T,O]=x(u?"ready":"unresolved");L.context&&(c=L.getNextContextId(),s.ssrLoadFrom==="initial"?l=s.initialValue:L.load&&L.has(c)&&(l=L.load(c)));function N(F,D,P,R){return o===F&&(o=null,R!==void 0&&(u=!0),(F===l||D===l)&&s.onHydrated&&queueMicrotask(()=>s.onHydrated(R,{value:D})),l=In,Y(D,P)),D}function Y(F,D){Re(()=>{D===void 0&&w(()=>F),O(D!==void 0?"errored":u?"ready":"unresolved"),b(D);for(const P of d.keys())P.decrement();d.clear()},!1)}function re(){const F=Ws,D=h(),P=p();if(P!==void 0&&!o)throw P;return U&&U.user,D}function E(F=!0){if(F!==!1&&a)return;a=!1;const D=f?f():r;if(D==null||D===!1){N(o,X(h));return}let P;const R=l!==In?l:X(()=>{try{return i(D,{value:h(),refetching:F})}catch(C){P=C}});if(P!==void 0){N(o,void 0,Zt(P),D);return}else if(!zs(R))return N(o,R,void 0,D),R;return o=R,"v"in R?(R.s===1?N(o,R.v,void 0,D):N(o,void 0,Zt(R.v),D),R):(a=!0,queueMicrotask(()=>a=!1),Re(()=>{O(u?"refreshing":"pending"),_()},!1),R.then(C=>N(R,C,void 0,D),C=>N(R,void 0,Zt(C),D)))}Object.defineProperties(re,{state:{get:()=>T()},error:{get:()=>p()},loading:{get(){const F=T();return F==="pending"||F==="refreshing"}},latest:{get(){if(!u)return re();const F=p();if(F&&!o)throw F;return h()}}});let H=B;return f?Ks(()=>(H=B,E(!1))):E(!1),[re,{refetch:F=>_n(H,()=>E(F)),mutate:w}]}function yi(e,t=pi,n){const r=new Map,i=_t(s=>{const o=e();for(const[l,c]of r.entries())if(t(l,o)!==t(l,s))for(const a of c.values())a.state=ve,a.pure?oe.push(a):ye.push(a);return o},void 0,!0,ve);return ot(i),s=>{const o=U;if(o){let l;(l=r.get(s))?l.add(o):r.set(s,l=new Set([o])),je(()=>{l.delete(o),!l.size&&r.delete(s)})}return t(s,i.value)}}function Lt(e){return Re(e,!1)}function X(e){if(U===null)return e();const t=U;U=null;try{return e()}finally{U=t}}function st(e,t,n){const r=Array.isArray(e);let i,s=n&&n.defer;return o=>{let l;if(r){l=Array(e.length);for(let a=0;a<e.length;a++)l[a]=e[a]()}else l=e();if(s)return s=!1,o;const c=X(()=>t(l,i,o));return i=l,c}}function Ut(e){fe(()=>X(e))}function je(e){return B===null||(B.cleanups===null?B.cleanups=[e]:B.cleanups.push(e)),e}function Us(e,t){Ot||(Ot=Symbol("error")),B=_t(void 0,void 0,!0),B.context={...B.context,[Ot]:[t]};try{return e()}catch(n){Wt(n)}finally{B=B.owner}}function Vn(){return U}function nn(){return B}function _n(e,t){const n=B,r=U;B=e,U=null;try{return Re(t,!0)}catch(i){Wt(i)}finally{B=n,U=r}}function Hs(e){const t=U,n=B;return Promise.resolve().then(()=>{U=t,B=n;let r;return Re(e,!1),U=B=null,r?r.done:void 0})}const[Ju,ef]=x(!1);function pr(e,t){const n=Symbol("context");return{id:n,Provider:Qs(n),defaultValue:e}}function vn(e){let t;return B&&B.context&&(t=B.context[e.id])!==void 0?t:e.defaultValue}function Ht(e){const t=$(e),n=$(()=>Xn(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let Ws;function _i(){if(this.sources&&this.state)if(this.state===ve)ot(this);else{const e=oe;oe=null,Re(()=>sn(this),!1),oe=e}if(U){const e=this.observers?this.observers.length:0;U.sources?(U.sources.push(this),U.sourceSlots.push(e)):(U.sources=[this],U.sourceSlots=[e]),this.observers?(this.observers.push(U),this.observerSlots.push(U.sources.length-1)):(this.observers=[U],this.observerSlots=[U.sources.length-1])}return this.value}function vi(e,t,n){let r=e.value;return(!e.comparator||!e.comparator(r,t))&&(e.value=t,e.observers&&e.observers.length&&Re(()=>{for(let i=0;i<e.observers.length;i+=1){const s=e.observers[i],o=Fn&&Fn.running;o&&Fn.disposed.has(s),(o?!s.tState:!s.state)&&(s.pure?oe.push(s):ye.push(s),s.observers&&Ci(s)),o||(s.state=ve)}if(oe.length>1e6)throw oe=[],new Error},!1)),t}function ot(e){if(!e.fn)return;Mt(e);const t=yn;Gs(e,e.value,t)}function Gs(e,t,n){let r;const i=B,s=U;U=B=e;try{r=e.fn(t)}catch(o){return e.pure&&(e.state=ve,e.owned&&e.owned.forEach(Mt),e.owned=null),e.updatedAt=n+1,Wt(o)}finally{U=s,B=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?vi(e,r):e.value=r,e.updatedAt=n)}function _t(e,t,n,r=ve,i){const s={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:B,context:B?B.context:null,pure:n};return B===null||B!==wi&&(B.owned?B.owned.push(s):B.owned=[s]),s}function rn(e){if(e.state===0)return;if(e.state===tn)return sn(e);if(e.suspense&&X(e.suspense.inFallback))return e.suspense.effects.push(e);const t=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<yn);)e.state&&t.push(e);for(let n=t.length-1;n>=0;n--)if(e=t[n],e.state===ve)ot(e);else if(e.state===tn){const r=oe;oe=null,Re(()=>sn(e,t[0]),!1),oe=r}}function Re(e,t){if(oe)return e();let n=!1;t||(oe=[]),ye?n=!0:ye=[],yn++;try{const r=e();return Vs(n),r}catch(r){n||(ye=null),oe=null,Wt(r)}}function Vs(e){if(oe&&(ki(oe),oe=null),e)return;const t=ye;ye=null,t.length&&Re(()=>mi(t),!1)}function ki(e){for(let t=0;t<e.length;t++)rn(e[t])}function Xs(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:rn(r)}if(L.context){if(L.count){L.effects||(L.effects=[]),L.effects.push(...e.slice(0,n));return}St()}for(L.effects&&(L.done||!L.count)&&(e=[...L.effects,...e],n+=L.effects.length,delete L.effects),t=0;t<n;t++)rn(e[t])}function sn(e,t){e.state=0;for(let n=0;n<e.sources.length;n+=1){const r=e.sources[n];if(r.sources){const i=r.state;i===ve?r!==t&&(!r.updatedAt||r.updatedAt<yn)&&rn(r):i===tn&&sn(r,t)}}}function Ci(e){for(let t=0;t<e.observers.length;t+=1){const n=e.observers[t];n.state||(n.state=tn,n.pure?oe.push(n):ye.push(n),n.observers&&Ci(n))}}function Mt(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const s=i.pop(),o=n.observerSlots.pop();r<i.length&&(s.sourceSlots[o]=r,i[r]=s,n.observerSlots[r]=o)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Mt(e.tOwned[t]);delete e.tOwned}if(e.owned){for(t=e.owned.length-1;t>=0;t--)Mt(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}e.state=0}function Zt(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function jr(e,t,n){try{for(const r of t)r(e)}catch(r){Wt(r,n&&n.owner||null)}}function Wt(e,t=B){const n=Ot&&t&&t.context&&t.context[Ot],r=Zt(e);if(!n)throw r;ye?ye.push({fn(){jr(r,n,t)},state:ve}):jr(r,n,t)}function Xn(e){if(typeof e=="function"&&!e.length)return Xn(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=Xn(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function Qs(e,t){return function(r){let i;return Z(()=>i=X(()=>(B.context={...B.context,[e]:r.value},Ht(()=>r.children))),void 0),i}}const Ys=Symbol("fallback");function Kr(e){for(let t=0;t<e.length;t++)e[t]()}function $i(e,t,n={}){let r=[],i=[],s=[],o=0,l=t.length>1?[]:null;return je(()=>Kr(s)),()=>{let c=e()||[],a=c.length,u,f;return c[Gn],X(()=>{let h,w,p,b,k,_,T,O,N;if(a===0)o!==0&&(Kr(s),s=[],r=[],i=[],o=0,l&&(l=[])),n.fallback&&(r=[Ys],i[0]=mt(Y=>(s[0]=Y,n.fallback())),o=1);else if(o===0){for(i=new Array(a),f=0;f<a;f++)r[f]=c[f],i[f]=mt(d);o=a}else{for(p=new Array(a),b=new Array(a),l&&(k=new Array(a)),_=0,T=Math.min(o,a);_<T&&r[_]===c[_];_++);for(T=o-1,O=a-1;T>=_&&O>=_&&r[T]===c[O];T--,O--)p[O]=i[T],b[O]=s[T],l&&(k[O]=l[T]);for(h=new Map,w=new Array(O+1),f=O;f>=_;f--)N=c[f],u=h.get(N),w[f]=u===void 0?-1:u,h.set(N,f);for(u=_;u<=T;u++)N=r[u],f=h.get(N),f!==void 0&&f!==-1?(p[f]=i[u],b[f]=s[u],l&&(k[f]=l[u]),f=w[f],h.set(N,f)):s[u]();for(f=_;f<a;f++)f in p?(i[f]=p[f],s[f]=b[f],l&&(l[f]=k[f],l[f](f))):i[f]=mt(d);i=i.slice(0,o=a),r=c.slice(0)}return i});function d(h){if(s[f]=h,l){const[w,p]=x(f);return l[f]=p,t(c[f],w)}return t(c[f])}}}function g(e,t){return X(()=>e(t||{}))}function Yt(){return!0}const Qn={get(e,t,n){return t===Ee?n:e.get(t)},has(e,t){return t===Ee?!0:e.has(t)},set:Yt,deleteProperty:Yt,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:Yt,deleteProperty:Yt}},ownKeys(e){return e.keys()}};function qn(e){return(e=typeof e=="function"?e():e)?e:{}}function Zs(){for(let e=0,t=this.length;e<t;++e){const n=this[e]();if(n!==void 0)return n}}function Ke(...e){let t=!1;for(let o=0;o<e.length;o++){const l=e[o];t=t||!!l&&Ee in l,e[o]=typeof l=="function"?(t=!0,$(l)):l}if(gi&&t)return new Proxy({get(o){for(let l=e.length-1;l>=0;l--){const c=qn(e[l])[o];if(c!==void 0)return c}},has(o){for(let l=e.length-1;l>=0;l--)if(o in qn(e[l]))return!0;return!1},keys(){const o=[];for(let l=0;l<e.length;l++)o.push(...Object.keys(qn(e[l])));return[...new Set(o)]}},Qn);const n={},r=Object.create(null);for(let o=e.length-1;o>=0;o--){const l=e[o];if(!l)continue;const c=Object.getOwnPropertyNames(l);for(let a=c.length-1;a>=0;a--){const u=c[a];if(u==="__proto__"||u==="constructor")continue;const f=Object.getOwnPropertyDescriptor(l,u);if(!r[u])r[u]=f.get?{enumerable:!0,configurable:!0,get:Zs.bind(n[u]=[f.get.bind(l)])}:f.value!==void 0?f:void 0;else{const d=n[u];d&&(f.get?d.push(f.get.bind(l)):f.value!==void 0&&d.push(()=>f.value))}}}const i={},s=Object.keys(r);for(let o=s.length-1;o>=0;o--){const l=s[o],c=r[l];c&&c.get?Object.defineProperty(i,l,c):i[l]=c?c.value:void 0}return i}function gr(e,...t){const n=t.length;if(gi&&Ee in e){const i=n>1?t.flat():t[0],s=t.map(o=>new Proxy({get(l){return o.includes(l)?e[l]:void 0},has(l){return o.includes(l)&&l in e},keys(){return o.filter(l=>l in e)}},Qn));return s.push(new Proxy({get(o){return i.includes(o)?void 0:e[o]},has(o){return i.includes(o)?!1:o in e},keys(){return Object.keys(e).filter(o=>!i.includes(o))}},Qn)),s}const r=[];for(let i=0;i<=n;i++)r[i]={};for(const i of Object.getOwnPropertyNames(e)){let s=n;for(let c=0;c<t.length;c++)if(t[c].includes(i)){s=c;break}const o=Object.getOwnPropertyDescriptor(e,i);!o.get&&!o.set&&o.enumerable&&o.writable&&o.configurable?r[s][i]=o.value:Object.defineProperty(r[s],i,o)}return r}function kn(e){let t,n;const r=i=>{const s=L.context;if(s){const[l,c]=x();L.count||(L.count=0),L.count++,(n||(n=e())).then(a=>{!L.done&&St(s),L.count--,c(()=>a.default),St()}),t=l}else if(!t){const[l]=bi(()=>(n||(n=e())).then(c=>c.default));t=l}let o;return $(()=>(o=t())?X(()=>{if(!s||L.done)return o(i);const l=L.context;St(s);const c=o(i);return St(l),c}):"")};return r.preload=()=>n||((n=e()).then(i=>t=()=>i.default),n),r}let Js=0;function eo(){return L.context?L.getNextContextId():`cl-${Js++}`}const Pi=e=>`Stale read from <${e}>.`;function Gt(e){const t="fallback"in e&&{fallback:()=>e.fallback};return $($i(()=>e.each,e.children,t||void 0))}function ke(e){const t=e.keyed,n=$(()=>e.when,void 0,void 0),r=t?n:$(n,void 0,{equals:(i,s)=>!i==!s});return $(()=>{const i=r();if(i){const s=e.children;return typeof s=="function"&&s.length>0?X(()=>s(t?i:()=>{if(!X(r))throw Pi("Show");return n()})):s}return e.fallback},void 0,void 0)}function to(e){const t=Ht(()=>e.children),n=$(()=>{const r=t(),i=Array.isArray(r)?r:[r];let s=()=>{};for(let o=0;o<i.length;o++){const l=o,c=i[o],a=s,u=$(()=>a()?void 0:c.when,void 0,void 0),f=c.keyed?u:$(u,void 0,{equals:(d,h)=>!d==!h});s=()=>a()||(f()?[l,u,c]:void 0)}return s});return $(()=>{const r=n()();if(!r)return e.fallback;const[i,s,o]=r,l=o.children;return typeof l=="function"&&l.length>0?X(()=>l(o.keyed?s():()=>{if(X(n)()?.[0]!==i)throw Pi("Match");return s()})):l},void 0,void 0)}function zr(e){return e}const no=["allowfullscreen","async","alpha","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected","adauctionheaders","browsingtopics","credentialless","defaultchecked","defaultmuted","defaultselected","defer","disablepictureinpicture","disableremoteplayback","preservespitch","shadowrootclonable","shadowrootcustomelementregistry","shadowrootdelegatesfocus","shadowrootserializable","sharedstoragewritable"],ro=new Set(["className","value","readOnly","noValidate","formNoValidate","isMap","noModule","playsInline","adAuctionHeaders","allowFullscreen","browsingTopics","defaultChecked","defaultMuted","defaultSelected","disablePictureInPicture","disableRemotePlayback","preservesPitch","shadowRootClonable","shadowRootCustomElementRegistry","shadowRootDelegatesFocus","shadowRootSerializable","sharedStorageWritable",...no]),io=new Set(["innerHTML","textContent","innerText","children"]),so=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),oo=Object.assign(Object.create(null),{class:"className",novalidate:{$:"noValidate",FORM:1},formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1},adauctionheaders:{$:"adAuctionHeaders",IFRAME:1},allowfullscreen:{$:"allowFullscreen",IFRAME:1},browsingtopics:{$:"browsingTopics",IMG:1},defaultchecked:{$:"defaultChecked",INPUT:1},defaultmuted:{$:"defaultMuted",AUDIO:1,VIDEO:1},defaultselected:{$:"defaultSelected",OPTION:1},disablepictureinpicture:{$:"disablePictureInPicture",VIDEO:1},disableremoteplayback:{$:"disableRemotePlayback",AUDIO:1,VIDEO:1},preservespitch:{$:"preservesPitch",AUDIO:1,VIDEO:1},shadowrootclonable:{$:"shadowRootClonable",TEMPLATE:1},shadowrootdelegatesfocus:{$:"shadowRootDelegatesFocus",TEMPLATE:1},shadowrootserializable:{$:"shadowRootSerializable",TEMPLATE:1},sharedstoragewritable:{$:"sharedStorageWritable",IFRAME:1,IMG:1}});function lo(e,t){const n=oo[e];return typeof n=="object"?n[t]?n.$:void 0:n}const co=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),ao=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),uo={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},vt=e=>$(()=>e());function fo(e,t,n){let r=n.length,i=t.length,s=r,o=0,l=0,c=t[i-1].nextSibling,a=null;for(;o<i||l<s;){if(t[o]===n[l]){o++,l++;continue}for(;t[i-1]===n[s-1];)i--,s--;if(i===o){const u=s<r?l?n[l-1].nextSibling:n[s-l]:c;for(;l<s;)e.insertBefore(n[l++],u)}else if(s===l)for(;o<i;)(!a||!a.has(t[o]))&&t[o].remove(),o++;else if(t[o]===n[s-1]&&n[l]===t[i-1]){const u=t[--i].nextSibling;e.insertBefore(n[l++],t[o++].nextSibling),e.insertBefore(n[--s],u),t[i]=n[s]}else{if(!a){a=new Map;let f=l;for(;f<s;)a.set(n[f],f++)}const u=a.get(t[o]);if(u!=null)if(l<u&&u<s){let f=o,d=1,h;for(;++f<i&&f<s&&!((h=a.get(t[f]))==null||h!==u+d);)d++;if(d>u-l){const w=t[o];for(;l<u;)e.insertBefore(n[l++],w)}else e.replaceChild(n[l++],t[o++])}else o++;else t[o++].remove()}}}const Ur="_$DX_DELEGATE";function ho(e,t,n,r={}){let i;return mt(s=>{i=s,t===document?e():v(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=""}}function M(e,t,n,r){let i;const s=()=>{const l=document.createElement("template");return l.innerHTML=e,l.content.firstChild},o=()=>(i||(i=s())).cloneNode(!0);return o.cloneNode=o,o}function Te(e,t=window.document){const n=t[Ur]||(t[Ur]=new Set);for(let r=0,i=e.length;r<i;r++){const s=e[r];n.has(s)||(n.add(s),t.addEventListener(s,vo))}}function Nt(e,t,n){ct(e)||(n==null?e.removeAttribute(t):e.setAttribute(t,n))}function po(e,t,n,r){ct(e)||(r==null?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,r))}function go(e,t,n){ct(e)||(n?e.setAttribute(t,""):e.removeAttribute(t))}function mo(e,t){ct(e)||(t==null?e.removeAttribute("class"):e.className=t)}function Oe(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const i=n[0];e.addEventListener(t,n[0]=s=>i.call(e,n[1],s))}else e.addEventListener(t,n,typeof n!="function"&&n)}function wo(e,t,n={}){const r=Object.keys(t||{}),i=Object.keys(n);let s,o;for(s=0,o=i.length;s<o;s++){const l=i[s];!l||l==="undefined"||t[l]||(Hr(e,l,!1),delete n[l])}for(s=0,o=r.length;s<o;s++){const l=r[s],c=!!t[l];!l||l==="undefined"||n[l]===c||!c||(Hr(e,l,!0),n[l]=c)}return n}function Ei(e,t,n){if(!t)return n?Nt(e,"style"):t;const r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let i,s;for(s in n)t[s]==null&&r.removeProperty(s),delete n[s];for(s in t)i=t[s],i!==n[s]&&(r.setProperty(s,i),n[s]=i);return n}function lt(e,t={},n,r){const i={};return r||Z(()=>i.children=Tt(e,t.children,i.children)),Z(()=>typeof t.ref=="function"&&Le(t.ref,e)),Z(()=>bo(e,t,n,!0,i,!0)),i}function Le(e,t,n){return X(()=>e(t,n))}function v(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Tt(e,t,r,n);Z(i=>Tt(e,t(),i,n),r)}function bo(e,t,n,r,i={},s=!1){t||(t={});for(const o in i)if(!(o in t)){if(o==="children")continue;i[o]=Wr(e,o,null,i[o],n,s,t)}for(const o in t){if(o==="children")continue;const l=t[o];i[o]=Wr(e,o,l,i[o],n,s,t)}}function yo(e){let t,n;return!ct()||!(t=L.registry.get(n=ko()))?e():(L.completed&&L.completed.add(t),L.registry.delete(n),t)}function ct(e){return!!L.context&&!L.done&&(!e||e.isConnected)}function _o(e){return e.toLowerCase().replace(/-([a-z])/g,(t,n)=>n.toUpperCase())}function Hr(e,t,n){const r=t.trim().split(/\s+/);for(let i=0,s=r.length;i<s;i++)e.classList.toggle(r[i],n)}function Wr(e,t,n,r,i,s,o){let l,c,a,u,f;if(t==="style")return Ei(e,n,r);if(t==="classList")return wo(e,n,r);if(n===r)return r;if(t==="ref")s||n(e);else if(t.slice(0,3)==="on:"){const d=t.slice(3);r&&e.removeEventListener(d,r,typeof r!="function"&&r),n&&e.addEventListener(d,n,typeof n!="function"&&n)}else if(t.slice(0,10)==="oncapture:"){const d=t.slice(10);r&&e.removeEventListener(d,r,!0),n&&e.addEventListener(d,n,!0)}else if(t.slice(0,2)==="on"){const d=t.slice(2).toLowerCase(),h=co.has(d);if(!h&&r){const w=Array.isArray(r)?r[0]:r;e.removeEventListener(d,w)}(h||n)&&(Oe(e,d,n,h),h&&Te([d]))}else if(t.slice(0,5)==="attr:")Nt(e,t.slice(5),n);else if(t.slice(0,5)==="bool:")go(e,t.slice(5),n);else if((f=t.slice(0,5)==="prop:")||(a=io.has(t))||!i&&((u=lo(t,e.tagName))||(c=ro.has(t)))||(l=e.nodeName.includes("-")||"is"in o)){if(f)t=t.slice(5),c=!0;else if(ct(e))return n;t==="class"||t==="className"?mo(e,n):l&&!c&&!a?e[_o(t)]=n:e[u||t]=n}else{const d=i&&t.indexOf(":")>-1&&uo[t.split(":")[0]];d?po(e,d,t,n):Nt(e,so[t]||t,n)}return n}function vo(e){if(L.registry&&L.events&&L.events.find(([c,a])=>a===e))return;let t=e.target;const n=`$$${e.type}`,r=e.target,i=e.currentTarget,s=c=>Object.defineProperty(e,"target",{configurable:!0,value:c}),o=()=>{const c=t[n];if(c&&!t.disabled){const a=t[`${n}Data`];if(a!==void 0?c.call(t,a,e):c.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&s(t.host),!0},l=()=>{for(;o()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),L.registry&&!L.done&&(L.done=_$HY.done=!0),e.composedPath){const c=e.composedPath();s(c[0]);for(let a=0;a<c.length-2&&(t=c[a],!!o());a++){if(t._$host){t=t._$host,l();break}if(t.parentNode===i)break}}else l();s(r)}function Tt(e,t,n,r,i){const s=ct(e);if(s){!n&&(n=[...e.childNodes]);let c=[];for(let a=0;a<n.length;a++){const u=n[a];u.nodeType===8&&u.data.slice(0,2)==="!$"?u.remove():c.push(u)}n=c}for(;typeof n=="function";)n=n();if(t===n)return n;const o=typeof t,l=r!==void 0;if(e=l&&n[0]&&n[0].parentNode||e,o==="string"||o==="number"){if(s||o==="number"&&(t=t.toString(),t===n))return n;if(l){let c=n[0];c&&c.nodeType===3?c.data!==t&&(c.data=t):c=document.createTextNode(t),n=ft(e,n,r,c)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||o==="boolean"){if(s)return n;n=ft(e,n,r)}else{if(o==="function")return Z(()=>{let c=t();for(;typeof c=="function";)c=c();n=Tt(e,c,n,r)}),()=>n;if(Array.isArray(t)){const c=[],a=n&&Array.isArray(n);if(Yn(c,t,n,i))return Z(()=>n=Tt(e,c,n,r,!0)),()=>n;if(s){if(!c.length)return n;if(r===void 0)return n=[...e.childNodes];let u=c[0];if(u.parentNode!==e)return n;const f=[u];for(;(u=u.nextSibling)!==r;)f.push(u);return n=f}if(c.length===0){if(n=ft(e,n,r),l)return n}else a?n.length===0?Gr(e,c,r):fo(e,n,c):(n&&ft(e),Gr(e,c));n=c}else if(t.nodeType){if(s&&t.parentNode)return n=l?[t]:t;if(Array.isArray(n)){if(l)return n=ft(e,n,r,t);ft(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function Yn(e,t,n,r){let i=!1;for(let s=0,o=t.length;s<o;s++){let l=t[s],c=n&&n[e.length],a;if(!(l==null||l===!0||l===!1))if((a=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))i=Yn(e,l,c)||i;else if(a==="function")if(r){for(;typeof l=="function";)l=l();i=Yn(e,Array.isArray(l)?l:[l],Array.isArray(c)?c:[c])||i}else e.push(l),i=!0;else{const u=String(l);c&&c.nodeType===3&&c.data===u?e.push(c):e.push(document.createTextNode(u))}}return i}function Gr(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function ft(e,t,n,r){if(n===void 0)return e.textContent="";const i=r||document.createTextNode("");if(t.length){let s=!1;for(let o=t.length-1;o>=0;o--){const l=t[o];if(i!==l){const c=l.parentNode===e;!s&&!o?c?e.replaceChild(i,l):e.insertBefore(i,n):c&&l.remove()}else s=!0}}else e.insertBefore(i,n);return[i]}function ko(){return L.getNextContextId()}const Co=!1,$o="http://www.w3.org/2000/svg";function Si(e,t=!1,n=void 0){return t?document.createElementNS($o,e):document.createElement(e,{is:n})}function mr(e){const{useShadow:t}=e,n=document.createTextNode(""),r=()=>e.mount||document.body,i=nn();let s,o=!!L.context;return fe(()=>{o&&(nn().user=o=!1),s||(s=_n(i,()=>$(()=>e.children)));const l=r();if(l instanceof HTMLHeadElement){const[c,a]=x(!1),u=()=>a(!0);mt(f=>v(l,()=>c()?f():s(),null)),je(u)}else{const c=Si(e.isSVG?"g":"div",e.isSVG),a=t&&c.attachShadow?c.attachShadow({mode:"open"}):c;Object.defineProperty(c,"_$host",{get(){return n.parentNode},configurable:!0}),v(a,s),l.appendChild(c),e.ref&&e.ref(c),je(()=>l.removeChild(c))}},void 0,{render:!o}),n}function Po(e,t){const n=$(e);return $(()=>{const r=n();switch(typeof r){case"function":return X(()=>r(t));case"string":const i=ao.has(r),s=L.context?yo():Si(r,i,X(()=>t.is));return lt(s,t,i),s}})}function Eo(e){const[,t]=gr(e,["component"]);return Po(()=>e.component,t)}const So="modulepreload",Ao=function(e){return"/"+e},Vr={},Cn=function(t,n,r){let i=Promise.resolve();if(n&&n.length>0){let c=function(a){return Promise.all(a.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),l=o?.nonce||o?.getAttribute("nonce");i=c(n.map(a=>{if(a=Ao(a),a in Vr)return;Vr[a]=!0;const u=a.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${a}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":So,u||(d.as="script"),d.crossOrigin="",d.href=a,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((h,w)=>{d.addEventListener("load",h),d.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${a}`)))})}))}function s(o){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=o,window.dispatchEvent(l),!l.defaultPrevented)throw o}return i.then(o=>{for(const l of o||[])l.status==="rejected"&&s(l.reason);return t().catch(s)})};function Ai(){let e=new Set;function t(i){return e.add(i),()=>e.delete(i)}let n=!1;function r(i,s){if(n)return!(n=!1);const o={to:i,options:s,defaultPrevented:!1,preventDefault:()=>o.defaultPrevented=!0};for(const l of e)l.listener({...o,from:l.location,retry:c=>{c&&(n=!0),l.navigate(i,{...s,resolve:!1})}});return!o.defaultPrevented}return{subscribe:t,confirm:r}}let Zn;function wr(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),Zn=window.history.state._depth}wr();function Oo(e){return{...e,_depth:window.history.state&&window.history.state._depth}}function xo(e,t){let n=!1;return()=>{const r=Zn;wr();const i=r==null?null:Zn-r;if(n){n=!1;return}i&&t(i)?(n=!0,window.history.go(-i)):e()}}const Ro=/^(?:[a-z0-9]+:)?\/\//i,Lo=/^\/+|(\/)\/+$/g,Oi="http://sr";function tt(e,t=!1){const n=e.replace(Lo,"$1");return n?t||/^[?#]/.test(n)?n:"/"+n:""}function Jt(e,t,n){if(Ro.test(t))return;const r=tt(e),i=n&&tt(n);let s="";return!i||t.startsWith("/")?s=r:i.toLowerCase().indexOf(r.toLowerCase())!==0?s=r+i:s=i,(s||"/")+tt(t,!s)}function Mo(e,t){if(e==null)throw new Error(t);return e}function No(e,t){return tt(e).replace(/\/*(\*.*)?$/g,"")+tt(t)}function xi(e){const t={};return e.searchParams.forEach((n,r)=>{r in t?Array.isArray(t[r])?t[r].push(n):t[r]=[t[r],n]:t[r]=n}),t}function To(e,t,n){const[r,i]=e.split("/*",2),s=r.split("/").filter(Boolean),o=s.length;return l=>{const c=l.split("/").filter(Boolean),a=c.length-o;if(a<0||a>0&&i===void 0&&!t)return null;const u={path:o?"":"/",params:{}},f=d=>n===void 0?void 0:n[d];for(let d=0;d<o;d++){const h=s[d],w=h[0]===":",p=w?c[d]:c[d].toLowerCase(),b=w?h.slice(1):h.toLowerCase();if(w&&Bn(p,f(b)))u.params[b]=p;else if(w||!Bn(p,b))return null;u.path+=`/${p}`}if(i){const d=a?c.slice(-a).join("/"):"";if(Bn(d,f(i)))u.params[i]=d;else return null}return u}}function Bn(e,t){const n=r=>r===e;return t===void 0?!0:typeof t=="string"?n(t):typeof t=="function"?t(e):Array.isArray(t)?t.some(n):t instanceof RegExp?t.test(e):!1}function Do(e){const[t,n]=e.pattern.split("/*",2),r=t.split("/").filter(Boolean);return r.reduce((i,s)=>i+(s.startsWith(":")?2:3),r.length-(n===void 0?0:1))}function Ri(e){const t=new Map,n=nn();return new Proxy({},{get(r,i){return t.has(i)||_n(n,()=>t.set(i,$(()=>e()[i]))),t.get(i)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())},has(r,i){return i in e()}})}function Li(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length);const i=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)i.push(n+=t[1]),r=r.slice(t[0].length);return Li(r).reduce((s,o)=>[...s,...i.map(l=>l+o)],[])}const Io=100,Mi=pr(),br=pr(),yr=()=>Mo(vn(Mi),"<A> and 'use' router primitives can be only used inside a Route."),Fo=()=>vn(br)||yr().base,qo=e=>{const t=Fo();return $(()=>t.resolvePath(e()))},Bo=e=>{const t=yr();return $(()=>{const n=e();return n!==void 0?t.renderPath(n):n})},jo=()=>yr().location;function Ko(e,t=""){const{component:n,preload:r,load:i,children:s,info:o}=e,l=!s||Array.isArray(s)&&!s.length,c={key:e,component:n,preload:r||i,info:o};return Ni(e.path).reduce((a,u)=>{for(const f of Li(u)){const d=No(t,f);let h=l?d:d.split("/*",1)[0];h=h.split("/").map(w=>w.startsWith(":")||w.startsWith("*")?w:encodeURIComponent(w)).join("/"),a.push({...c,originalPath:u,pattern:h,matcher:To(h,!l,e.matchFilters)})}return a},[])}function zo(e,t=0){return{routes:e,score:Do(e[e.length-1])*1e4-t,matcher(n){const r=[];for(let i=e.length-1;i>=0;i--){const s=e[i],o=s.matcher(n);if(!o)return null;r.unshift({...o,route:s})}return r}}}function Ni(e){return Array.isArray(e)?e:[e]}function Ti(e,t="",n=[],r=[]){const i=Ni(e);for(let s=0,o=i.length;s<o;s++){const l=i[s];if(l&&typeof l=="object"){l.hasOwnProperty("path")||(l.path="");const c=Ko(l,t);for(const a of c){n.push(a);const u=Array.isArray(l.children)&&l.children.length===0;if(l.children&&!u)Ti(l.children,a.pattern,n,r);else{const f=zo([...n],r.length);r.push(f)}n.pop()}}}return n.length?r:r.sort((s,o)=>o.score-s.score)}function jn(e,t){for(let n=0,r=e.length;n<r;n++){const i=e[n].matcher(t);if(i)return i}return[]}function Uo(e,t,n){const r=new URL(Oi),i=$(u=>{const f=e();try{return new URL(f,r)}catch{return console.error(`Invalid path ${f}`),u}},r,{equals:(u,f)=>u.href===f.href}),s=$(()=>i().pathname),o=$(()=>i().search,!0),l=$(()=>i().hash),c=()=>"",a=st(o,()=>xi(i()));return{get pathname(){return s()},get search(){return o()},get hash(){return l()},get state(){return t()},get key(){return c()},query:n?n(a):Ri(a)}}let Ze;function Ho(){return Ze}function Wo(e,t,n,r={}){const{signal:[i,s],utils:o={}}=e,l=o.parsePath||(C=>C),c=o.renderPath||(C=>C),a=o.beforeLeave||Ai(),u=Jt("",r.base||"");if(u===void 0)throw new Error(`${u} is not a valid base path`);u&&!i().value&&s({value:u,replace:!0,scroll:!1});const[f,d]=x(!1);let h;const w=(C,q)=>{q.value===p()&&q.state===k()||(h===void 0&&d(!0),Ze=C,h=q,Hs(()=>{h===q&&(b(h.value),_(h.state),N[1](V=>V.filter(J=>J.pending)))}).finally(()=>{h===q&&Lt(()=>{Ze=void 0,C==="navigate"&&P(h),d(!1),h=void 0})}))},[p,b]=x(i().value),[k,_]=x(i().state),T=Uo(p,k,o.queryWrapper),O=[],N=x([]),Y=$(()=>typeof r.transformUrl=="function"?jn(t(),r.transformUrl(T.pathname)):jn(t(),T.pathname)),re=()=>{const C=Y(),q={};for(let V=0;V<C.length;V++)Object.assign(q,C[V].params);return q},E=o.paramsWrapper?o.paramsWrapper(re,t):Ri(re),H={pattern:u,path:()=>u,outlet:()=>null,resolvePath(C){return Jt(u,C)}};return Z(st(i,C=>w("native",C),{defer:!0})),{base:H,location:T,params:E,isRouting:f,renderPath:c,parsePath:l,navigatorFactory:D,matches:Y,beforeLeave:a,preloadRoute:R,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:N};function F(C,q,V){X(()=>{if(typeof q=="number"){q&&(o.go?o.go(q):console.warn("Router integration does not support relative routing"));return}const J=!q||q[0]==="?",{replace:ce,resolve:j,scroll:K,state:ee}={replace:!1,resolve:!J,scroll:!0,...V},y=j?C.resolvePath(q):Jt(J&&T.pathname||"",q);if(y===void 0)throw new Error(`Path '${q}' is not a routable path`);if(O.length>=Io)throw new Error("Too many redirects");const S=p();(y!==S||ee!==k())&&(Co||a.confirm(y,V)&&(O.push({value:S,replace:ce,scroll:K,state:k()}),w("navigate",{value:y,state:ee})))})}function D(C){return C=C||vn(br)||H,(q,V)=>F(C,q,V)}function P(C){const q=O[0];q&&(s({...C,replace:q.replace,scroll:q.scroll}),O.length=0)}function R(C,q){const V=jn(t(),C.pathname),J=Ze;Ze="preload";for(let ce in V){const{route:j,params:K}=V[ce];j.component&&j.component.preload&&j.component.preload();const{preload:ee}=j;q&&ee&&_n(n(),()=>ee({params:K,location:{pathname:C.pathname,search:C.search,hash:C.hash,query:xi(C),state:null,key:""},intent:"preload"}))}Ze=J}}function Go(e,t,n,r){const{base:i,location:s,params:o}=e,{pattern:l,component:c,preload:a}=r().route,u=$(()=>r().path);c&&c.preload&&c.preload();const f=a?a({params:o,location:s,intent:Ze||"initial"}):void 0;return{parent:t,pattern:l,path:u,outlet:()=>c?g(c,{params:o,location:s,data:f,get children(){return n()}}):n(),resolvePath(h){return Jt(i.path(),h,u())}}}const Vo=e=>t=>{const{base:n}=t,r=Ht(()=>t.children),i=$(()=>Ti(r(),t.base||""));let s;const o=Wo(e,i,()=>s,{base:n,singleFlight:t.singleFlight,transformUrl:t.transformUrl});return e.create&&e.create(o),g(Mi.Provider,{value:o,get children(){return g(Xo,{routerState:o,get root(){return t.root},get preload(){return t.rootPreload||t.rootLoad},get children(){return[vt(()=>(s=nn())&&null),g(Qo,{routerState:o,get branches(){return i()}})]}})}})};function Xo(e){const t=e.routerState.location,n=e.routerState.params,r=$(()=>e.preload&&X(()=>{e.preload({params:n,location:t,intent:Ho()||"initial"})}));return g(ke,{get when(){return e.root},keyed:!0,get fallback(){return e.children},children:i=>g(i,{params:n,location:t,get data(){return r()},get children(){return e.children}})})}function Qo(e){const t=[];let n;const r=$(st(e.routerState.matches,(i,s,o)=>{let l=s&&i.length===s.length;const c=[];for(let a=0,u=i.length;a<u;a++){const f=s&&s[a],d=i[a];o&&f&&d.route.key===f.route.key?c[a]=o[a]:(l=!1,t[a]&&t[a](),mt(h=>{t[a]=h,c[a]=Go(e.routerState,c[a-1]||e.routerState.base,Xr(()=>r()[a+1]),()=>{const w=e.routerState.matches();return w[a]??w[0]})}))}return t.splice(i.length).forEach(a=>a()),o&&l?o:(n=c[0],c)}));return Xr(()=>r()&&n)()}const Xr=e=>()=>g(ke,{get when(){return e()},keyed:!0,children:t=>g(br.Provider,{value:t,get children(){return t.outlet()}})}),Ct=e=>{const t=Ht(()=>e.children);return Ke(e,{get children(){return t()}})};function Yo([e,t],n,r){return[e,r?i=>t(r(i)):t]}function Zo(e){let t=!1;const n=i=>typeof i=="string"?{value:i}:i,r=Yo(x(n(e.get()),{equals:(i,s)=>i.value===s.value&&i.state===s.state}),void 0,i=>(!t&&e.set(i),L.registry&&!L.done&&(L.done=!0),i));return e.init&&je(e.init((i=e.get())=>{t=!0,r[1](n(i)),t=!1})),Vo({signal:r,create:e.create,utils:e.utils})}function Jo(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function el(e,t){const n=e&&document.getElementById(e);n?n.scrollIntoView():t&&window.scrollTo(0,0)}const tl=new Map;function nl(e=!0,t=!1,n="/_server",r){return i=>{const s=i.base.path(),o=i.navigatorFactory(i.base);let l,c;function a(p){return p.namespaceURI==="http://www.w3.org/2000/svg"}function u(p){if(p.defaultPrevented||p.button!==0||p.metaKey||p.altKey||p.ctrlKey||p.shiftKey)return;const b=p.composedPath().find(Y=>Y instanceof Node&&Y.nodeName.toUpperCase()==="A");if(!b||t&&!b.hasAttribute("link"))return;const k=a(b),_=k?b.href.baseVal:b.href;if((k?b.target.baseVal:b.target)||!_&&!b.hasAttribute("state"))return;const O=(b.getAttribute("rel")||"").split(/\s+/);if(b.hasAttribute("download")||O&&O.includes("external"))return;const N=k?new URL(_,document.baseURI):new URL(_);if(!(N.origin!==window.location.origin||s&&N.pathname&&!N.pathname.toLowerCase().startsWith(s.toLowerCase())))return[b,N]}function f(p){const b=u(p);if(!b)return;const[k,_]=b,T=i.parsePath(_.pathname+_.search+_.hash),O=k.getAttribute("state");p.preventDefault(),o(T,{resolve:!1,replace:k.hasAttribute("replace"),scroll:!k.hasAttribute("noscroll"),state:O?JSON.parse(O):void 0})}function d(p){const b=u(p);if(!b)return;const[k,_]=b;r&&(_.pathname=r(_.pathname)),i.preloadRoute(_,k.getAttribute("preload")!=="false")}function h(p){clearTimeout(l);const b=u(p);if(!b)return c=null;const[k,_]=b;c!==k&&(r&&(_.pathname=r(_.pathname)),l=setTimeout(()=>{i.preloadRoute(_,k.getAttribute("preload")!=="false"),c=k},20))}function w(p){if(p.defaultPrevented)return;let b=p.submitter&&p.submitter.hasAttribute("formaction")?p.submitter.getAttribute("formaction"):p.target.getAttribute("action");if(!b)return;if(!b.startsWith("https://action/")){const _=new URL(b,Oi);if(b=i.parsePath(_.pathname+_.search),!b.startsWith(n))return}if(p.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const k=tl.get(b);if(k){p.preventDefault();const _=new FormData(p.target,p.submitter);k.call({r:i,f:p.target},p.target.enctype==="multipart/form-data"?_:new URLSearchParams(_))}}Te(["click","submit"]),document.addEventListener("click",f),e&&(document.addEventListener("mousemove",h,{passive:!0}),document.addEventListener("focusin",d,{passive:!0}),document.addEventListener("touchstart",d,{passive:!0})),document.addEventListener("submit",w),je(()=>{document.removeEventListener("click",f),e&&(document.removeEventListener("mousemove",h),document.removeEventListener("focusin",d),document.removeEventListener("touchstart",d)),document.removeEventListener("submit",w)})}}function rl(e){const t=()=>{const r=window.location.pathname.replace(/^\/+/,"/")+window.location.search,i=window.history.state&&window.history.state._depth&&Object.keys(window.history.state).length===1?void 0:window.history.state;return{value:r+window.location.hash,state:i}},n=Ai();return Zo({get:t,set({value:r,replace:i,scroll:s,state:o}){i?window.history.replaceState(Oo(o),"",r):window.history.pushState(o,"",r),el(decodeURIComponent(window.location.hash.slice(1)),s),wr()},init:r=>Jo(window,"popstate",xo(r,i=>{if(i)return!n.confirm(i);{const s=t();return!n.confirm(s.value,{state:s.state})}})),create:nl(e.preload,e.explicitLinks,e.actionBase,e.transformUrl),utils:{go:r=>window.history.go(r),beforeLeave:n}})(e)}var il=M("<a>");function dt(e){e=Ke({inactiveClass:"inactive",activeClass:"active"},e);const[,t]=gr(e,["href","state","class","activeClass","inactiveClass","end"]),n=qo(()=>e.href),r=Bo(n),i=jo(),s=$(()=>{const o=n();if(o===void 0)return[!1,!1];const l=tt(o.split(/[?#]/,1)[0]).toLowerCase(),c=decodeURI(tt(i.pathname).toLowerCase());return[e.end?l===c:c.startsWith(l+"/")||c===l,l===c]});return(()=>{var o=il();return lt(o,Ke(t,{get href(){return r()||e.href},get state(){return JSON.stringify(e.state)},get classList(){return{...e.class&&{[e.class]:!0},[e.inactiveClass]:!s()[0],[e.activeClass]:s()[0],...t.classList}},link:"",get"aria-current"(){return s()[1]?"page":void 0}}),!1,!1),o})()}const Jn=Symbol("store-raw"),wt=Symbol("store-node"),qe=Symbol("store-has"),Di=Symbol("store-self");function Ii(e){let t=e[Ee];if(!t&&(Object.defineProperty(e,Ee,{value:t=new Proxy(e,ll)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let i=0,s=n.length;i<s;i++){const o=n[i];r[o].get&&Object.defineProperty(e,o,{enumerable:r[o].enumerable,get:r[o].get.bind(t)})}}return t}function We(e){let t;return e!=null&&typeof e=="object"&&(e[Ee]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function yt(e,t=new Set){let n,r,i,s;if(n=e!=null&&e[Jn])return n;if(!We(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let o=0,l=e.length;o<l;o++)i=e[o],(r=yt(i,t))!==i&&(e[o]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const o=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let c=0,a=o.length;c<a;c++)s=o[c],!l[s].get&&(i=e[s],(r=yt(i,t))!==i&&(e[s]=r))}return e}function on(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Dt(e,t,n){if(e[t])return e[t];const[r,i]=x(n,{equals:!1,internal:!0});return r.$=i,e[t]=r}function sl(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===Ee||t===wt||(delete n.value,delete n.writable,n.get=()=>e[Ee][t]),n}function Fi(e){Vn()&&Dt(on(e,wt),Di)()}function ol(e){return Fi(e),Reflect.ownKeys(e)}const ll={get(e,t,n){if(t===Jn)return e;if(t===Ee)return n;if(t===Gn)return Fi(e),n;const r=on(e,wt),i=r[t];let s=i?i():e[t];if(t===wt||t===qe||t==="__proto__")return s;if(!i){const o=Object.getOwnPropertyDescriptor(e,t);Vn()&&(typeof s!="function"||e.hasOwnProperty(t))&&!(o&&o.get)&&(s=Dt(r,t,s)())}return We(s)?Ii(s):s},has(e,t){return t===Jn||t===Ee||t===Gn||t===wt||t===qe||t==="__proto__"?!0:(Vn()&&Dt(on(e,qe),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:ol,getOwnPropertyDescriptor:sl};function be(e,t,n,r=!1){if(!r&&e[t]===n)return;const i=e[t],s=e.length;n===void 0?(delete e[t],e[qe]&&e[qe][t]&&i!==void 0&&e[qe][t].$()):(e[t]=n,e[qe]&&e[qe][t]&&i===void 0&&e[qe][t].$());let o=on(e,wt),l;if((l=Dt(o,t,i))&&l.$(()=>n),Array.isArray(e)&&e.length!==s){for(let c=e.length;c<s;c++)(l=o[c])&&l.$();(l=Dt(o,"length",s))&&l.$(e.length)}(l=o[Di])&&l.$()}function qi(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const i=n[r];be(e,i,t[i])}}function cl(e,t){if(typeof t=="function"&&(t=t(e)),t=yt(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const i=t[n];e[n]!==i&&be(e,n,i)}be(e,"length",r)}else qi(e,t)}function At(e,t,n=[]){let r,i=e;if(t.length>1){r=t.shift();const o=typeof r,l=Array.isArray(e);if(Array.isArray(r)){for(let c=0;c<r.length;c++)At(e,[r[c]].concat(t),n);return}else if(l&&o==="function"){for(let c=0;c<e.length;c++)r(e[c],c)&&At(e,[c].concat(t),n);return}else if(l&&o==="object"){const{from:c=0,to:a=e.length-1,by:u=1}=r;for(let f=c;f<=a;f+=u)At(e,[f].concat(t),n);return}else if(t.length>1){At(e[r],t,[r].concat(n));return}i=e[r],n=[r].concat(n)}let s=t[0];typeof s=="function"&&(s=s(i,n),s===i)||r===void 0&&s==null||(s=yt(s),r===void 0||We(i)&&We(s)&&!Array.isArray(s)?qi(i,s):be(e,r,s))}function Bi(...[e,t]){const n=yt(e||{}),r=Array.isArray(n),i=Ii(n);function s(...o){Lt(()=>{r&&o.length===1?cl(n,o[0]):At(n,o)})}return[i,s]}const er=Symbol("store-root");function pt(e,t,n,r,i){const s=t[n];if(e===s)return;const o=Array.isArray(e);if(n!==er&&(!We(e)||!We(s)||o!==Array.isArray(s)||i&&e[i]!==s[i])){be(t,n,e);return}if(o){if(e.length&&s.length&&(!r||i&&e[0]&&e[0][i]!=null)){let a,u,f,d,h,w,p,b;for(f=0,d=Math.min(s.length,e.length);f<d&&(s[f]===e[f]||i&&s[f]&&e[f]&&s[f][i]&&s[f][i]===e[f][i]);f++)pt(e[f],s,f,r,i);const k=new Array(e.length),_=new Map;for(d=s.length-1,h=e.length-1;d>=f&&h>=f&&(s[d]===e[h]||i&&s[d]&&e[h]&&s[d][i]&&s[d][i]===e[h][i]);d--,h--)k[h]=s[d];if(f>h||f>d){for(u=f;u<=h;u++)be(s,u,e[u]);for(;u<e.length;u++)be(s,u,k[u]),pt(e[u],s,u,r,i);s.length>e.length&&be(s,"length",e.length);return}for(p=new Array(h+1),u=h;u>=f;u--)w=e[u],b=i&&w?w[i]:w,a=_.get(b),p[u]=a===void 0?-1:a,_.set(b,u);for(a=f;a<=d;a++)w=s[a],b=i&&w?w[i]:w,u=_.get(b),u!==void 0&&u!==-1&&(k[u]=s[a],u=p[u],_.set(b,u));for(u=f;u<e.length;u++)u in k?(be(s,u,k[u]),pt(e[u],s,u,r,i)):be(s,u,e[u])}else for(let a=0,u=e.length;a<u;a++)pt(e[a],s,a,r,i);s.length>e.length&&be(s,"length",e.length);return}const l=Object.keys(e);for(let a=0,u=l.length;a<u;a++)pt(e[l[a]],s,l[a],r,i);const c=Object.keys(s);for(let a=0,u=c.length;a<u;a++)e[c[a]]===void 0&&be(s,c[a],void 0)}function al(e,t={}){const{merge:n,key:r="id"}=t,i=yt(e);return s=>{if(!We(s)||!We(i))return i;const o=pt(i,{[er]:s},er,n,r);return o===void 0?s:o}}function ze(e,t){let n,r=()=>!n||n.state==="unresolved"?void 0:n.latest;[n]=bi(()=>ul(e,Us(()=>X(r),()=>{})),s=>s);const i=(()=>n());return Object.defineProperty(i,"latest",{get(){return n.latest}}),i}class we{static all(){return new we}static allSettled(){return new we}static any(){return new we}static race(){return new we}static reject(){return new we}static resolve(){return new we}catch(){return new we}then(){return new we}finally(){return new we}}function ul(e,t){if(!L.context)return e(t);const n=fetch,r=Promise;try{return window.fetch=()=>new we,Promise=we,e(t)}finally{window.fetch=n,Promise=r}}const fl=["white","black"],ln=["a","b","c","d","e","f","g","h"],cn=["1","2","3","4","5","6","7","8"],dl=[...cn].reverse(),$n=ln.flatMap(e=>cn.map(t=>e+t)),Me=e=>e.every(t=>t>=0&&t<=7)?$n[8*e[0]+e[1]]:void 0,Qe=e=>Me(e),z=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],ji=$n.map(z),hl=$n.map((e,t)=>({key:e,pos:ji[t]}));function Ki(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const pl=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},Pn=e=>e==="white"?"black":"white",It=(e,t)=>(e[0]-t[0])**2+(e[1]-t[1])**2,an=(e,t)=>e.role===t.role&&e.color===t.color,gl=(e,t)=>e[0]===t[0]&&e[1]===t[1],Vt=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],Se=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},zi=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},_r=(e,t)=>{e.style.visibility=t?"visible":"hidden"},at=e=>{if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(e.targetTouches?.[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},ml=Ki(()=>!("ontouchstart"in window)&&["macintosh","firefox"].every(e=>navigator.userAgent.toLowerCase().includes(e))),Ui=e=>e.button===2&&!(e.ctrlKey&&ml()),Be=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function Hi(e,t,n){const r=z(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const Ne=(e,t)=>Math.abs(e-t),vr=(e,t,n,r)=>Ne(e,n)*Ne(t,r)===2,kr=(e,t,n,r)=>e===n!=(t===r),Cr=(e,t,n,r)=>Ne(e,n)===Ne(t,r)&&e!==n,Wi=(e,t,n,r)=>kr(e,t,n,r)||Cr(e,t,n,r),Gi=(e,t,n,r)=>Math.max(Ne(e,n),Ne(t,r))===1,Vi=(e,t,n,r,i)=>Ne(e,n)===1&&r===t+(i?1:-1),Xi=(e,t,n,r,i)=>{const s=i?1:-1;return e===n&&(r===t+s||r===t+2*s&&(i?t<=1:t>=6))},En=(e,t,n,r)=>{const i=n-e,s=r-t;if(i&&s&&Math.abs(i)!==Math.abs(s))return[];const o=Math.sign(i),l=Math.sign(s),c=[];let a=e+o,u=t+l;for(;a!==n||u!==r;)c.push([a,u]),a+=o,u+=l;return c.map(Me).filter(f=>f!==void 0)},wl=e=>{const t=z(e),n=[];return t[0]>0&&n.push([t[0]-1,t[1]]),t[0]<7&&n.push([t[0]+1,t[1]]),n.map(Me).filter(r=>r!==void 0)},un=(e,t)=>{const n=z(e);return n[1]+=t,Me(n)},kt=e=>e.friendlies.has(e.dest.key),bl=e=>e.enemies.has(e.dest.key),Qi=(e,t,n)=>En(...e,...t).some(r=>n.has(r)),Yi=(e,t,n)=>{const r=n.enemies.get(e);if(r?.role!=="pawn")return!1;const i=r.color==="white"?1:-1,s=z(e),o=z(t);return Xi(...s,...o,r.color==="white")&&!Qi(s,[o[0],o[1]+i],n.allPieces)},yl=(e,t,n)=>{const r=n.enemies.get(e);return r?.role==="pawn"&&Vi(...z(e),...z(t),r.color==="white")&&(n.friendlies.has(t)||An(un(t,r.color==="white"?-1:1),n.friendlies,n.enemies,n.lastMove))},_l=e=>[...e.enemies.keys()].some(t=>Yi(t,e.dest.key,e)),tr=(e,t)=>{const n=e.dest.pos;return[...e.enemies].some(([r,i])=>{const s=z(r);return!t?.includes(i.role)&&(i.role==="pawn"&&Vi(...s,...n,i.color==="white")||i.role==="knight"&&vr(...s,...n)||i.role==="bishop"&&Cr(...s,...n)||i.role==="rook"&&kr(...s,...n)||i.role==="queen"&&Wi(...s,...n)||i.role==="king"&&Gi(...s,...n))&&(!["bishop","rook","queen"].includes(i.role)||!Qi(s,n,e.allPieces))})},Sn=e=>kt(e)&&(An(e.dest.key,e.friendlies,e.enemies,e.lastMove)||tr(e)),An=(e,t,n,r)=>{if(!e||r&&e!==r[1])return!1;const i=z(e),s=t.get(e);return s?.role==="pawn"&&i[1]===(s.color==="white"?3:4)&&(!r||Ne(z(r[0])[1],i[1])===2)&&[1,-1].some(o=>{const l=Me([i[0]+o,i[1]]);return!!l&&n.get(l)?.role==="pawn"})},vl=(e,t)=>{if(e.unrestrictedPremoves)return!0;const n=En(...e.orig.pos,...e.dest.pos);t&&n.push(e.dest.key);const r=n.filter(o=>e.friendlies.has(o));if(!r.length)return!0;const i=r[0],s=un(i,e.color==="white"?-1:1);return r.length===1&&An(i,e.friendlies,e.enemies,e.lastMove)&&!!s&&!n.includes(s)},kl=(e,t)=>{if(e.unrestrictedPremoves)return!0;const n=En(...e.orig.pos,...e.dest.pos);t&&n.push(e.dest.key);const r=n.filter(u=>e.enemies.has(u));if(r.length>1)return!1;if(!r.length)return!0;const i=r[0],s=e.enemies.get(i);if(!s||s.role!=="pawn")return!0;const o=s.color==="white"?1:-1,l=un(i,o),c=l?[...wl(l).filter(u=>yl(i,u,e)),...[l,un(l,o)].filter(u=>!!u).filter(u=>Yi(i,u,e))]:[],a=[...n,e.orig.key];return c.some(u=>!a.includes(u))},$r=(e,t)=>vl(e,t)&&kl(e,t),Cl=e=>{const t=e.color==="white"?1:-1;return Ne(e.orig.pos[0],e.dest.pos[0])>1?!1:Ne(e.orig.pos[0],e.dest.pos[0])?e.dest.pos[1]!==e.orig.pos[1]+t?!1:e.unrestrictedPremoves||bl(e)?!0:kt(e)?tr(e):_l(e)||An(Me([e.dest.pos[0],e.dest.pos[1]+t]),e.friendlies,e.enemies,e.lastMove)||tr(e,["pawn"]):Xi(...e.orig.pos,...e.dest.pos,e.color==="white")&&$r(e,!0)},$l=e=>vr(...e.orig.pos,...e.dest.pos)&&(e.unrestrictedPremoves||!kt(e)||Sn(e)),Zi=e=>Cr(...e.orig.pos,...e.dest.pos)&&$r(e,!1)&&(e.unrestrictedPremoves||!kt(e)||Sn(e)),Ji=e=>kr(...e.orig.pos,...e.dest.pos)&&$r(e,!1)&&(e.unrestrictedPremoves||!kt(e)||Sn(e)),Pl=e=>Zi(e)||Ji(e),El=e=>Gi(...e.orig.pos,...e.dest.pos)&&(e.unrestrictedPremoves||!kt(e)||Sn(e))||e.canCastle&&e.orig.pos[1]===e.dest.pos[1]&&e.orig.pos[1]===(e.color==="white"?0:7)&&(e.orig.pos[0]===4&&(e.dest.pos[0]===2&&e.rookFilesFriendlies.includes(0)||e.dest.pos[0]===6&&e.rookFilesFriendlies.includes(7))||e.rookFilesFriendlies.includes(e.dest.pos[0]))&&(e.unrestrictedPremoves||En(...e.orig.pos,e.dest.pos[0]>e.orig.pos[0]?7:1,e.dest.pos[1]).map(t=>e.allPieces.get(t)).every(t=>!t||an(t,{role:"rook",color:e.color}))),Sl={pawn:Cl,knight:$l,bishop:Zi,rook:Ji,queen:Pl,king:El};function es(e,t){const n=e.pieces,r=e.premovable.castle,i=!!e.premovable.unrestrictedPremoves,s=n.get(t);if(!s||s.color===e.turnColor)return[];const o=s.color,l=new Map([...n].filter(([d,h])=>h.color===o)),c=new Map([...n].filter(([d,h])=>h.color===Pn(o))),a={key:t,pos:z(t)},u=d=>Sl[s.role](d)&&e.premovable.additionalPremoveRequirements(d),f={orig:a,role:s.role,allPieces:n,friendlies:l,enemies:c,unrestrictedPremoves:i,color:o,canCastle:r,rookFilesFriendlies:Array.from(n).filter(([d,h])=>d[1]===(o==="white"?"1":"8")&&h.color===o&&h.role==="rook").map(([d])=>z(d)[0]),lastMove:e.lastMove};return hl.filter(d=>u({...f,dest:d})).map(d=>d.key)}function de(e,...t){e&&setTimeout(()=>e(...t),1)}function Al(e){e.orientation=Pn(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Ol(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function xl(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,r]of e.pieces)r.role==="king"&&r.color===t&&(e.check=n)}function Rl(e,t,n,r){Xe(e),e.premovable.current=[t,n],de(e.premovable.events.set,t,n,r)}function Ve(e){e.premovable.current&&(e.premovable.current=void 0,de(e.premovable.events.unset))}function Ll(e,t,n){Ve(e),e.predroppable.current={role:t,key:n},de(e.predroppable.events.set,t,n)}function Xe(e){const t=e.predroppable;t.current&&(t.current=void 0,de(t.events.unset))}function Ml(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||r.role!=="king")return!1;const i=z(t),s=z(n);if(i[1]!==0&&i[1]!==7||i[1]!==s[1])return!1;i[0]===4&&!e.pieces.has(n)&&(s[0]===6?n=Qe([7,s[1]]):s[0]===2&&(n=Qe([0,s[1]])));const o=e.pieces.get(n);return!o||o.color!==r.color||o.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<s[0]?(e.pieces.set(Qe([6,s[1]]),r),e.pieces.set(Qe([5,s[1]]),o)):(e.pieces.set(Qe([2,s[1]]),r),e.pieces.set(Qe([3,s[1]]),o)),!0)}function ts(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!r)return!1;const s=i&&i.color!==r.color?i:void 0;return n===e.selected&&_e(e),de(e.events.move,t,n,s),Ml(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,de(e.events.change),s||!0}function Pr(e,t,n,r){if(e.pieces.has(n))if(r)e.pieces.delete(n);else return!1;return de(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,de(e.events.change),e.movable.dests=void 0,e.turnColor=Pn(e.turnColor),!0}function ns(e,t,n){const r=ts(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=Pn(e.turnColor),e.animation.current=void 0),r}function rs(e,t,n){if(Er(e,t,n)){const r=ns(e,t,n);if(r){const i=e.hold.stop();_e(e);const s={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(s.captured=r),de(e.movable.events.after,t,n,s),!0}}else if(Tl(e,t,n))return Rl(e,t,n,{ctrlKey:e.stats.ctrlKey}),_e(e),!0;return _e(e),!1}function is(e,t,n,r){const i=e.pieces.get(t);i&&(Nl(e,t,n)||r)?(e.pieces.delete(t),Pr(e,i,n,r),de(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&Dl(e,t,n)?Ll(e,i.role,n):(Ve(e),Xe(e)),e.pieces.delete(t),_e(e)}function nr(e,t,n){if(de(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){_e(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&rs(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(os(e,t)||Sr(e,t))&&(ss(e,t),e.hold.start())}function ss(e,t){e.selected=t,Sr(e,t)?e.premovable.customDests||(e.premovable.dests=es(e,t)):e.premovable.dests=void 0}function _e(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function os(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Er=(e,t,n)=>t!==n&&os(e,t)&&(e.movable.free||!!e.movable.dests?.get(t)?.includes(n));function Nl(e,t,n){const r=e.pieces.get(t);return!!r&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function Sr(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const Tl=(e,t,n)=>t!==n&&Sr(e,t)&&(e.premovable.customDests?.get(t)??es(e,t)).includes(n);function Dl(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function Il(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function Fl(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let i=!1;if(Er(e,n,r)){const s=ns(e,n,r);if(s){const o={premove:!0};s!==!0&&(o.captured=s),de(e.movable.events.after,n,r,o),i=!0}}return Ve(e),i}function ql(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;if(t(n)){const i={role:n.role,color:e.movable.color};Pr(e,i,n.key)&&(de(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0)}return Xe(e),r}function Ar(e){Ve(e),Xe(e),_e(e)}function Qr(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Ar(e)}function ut(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),r>=0&&r<8&&i>=0&&i<8?Me([r,i]):void 0}function Bl(e,t,n,r){const i=z(e),s=ji.filter(a=>gl(i,a)||Wi(i[0],i[1],a[0],a[1])||vr(i[0],i[1],a[0],a[1])),l=s.map(a=>Hi(Qe(a),n,r)).map(a=>It(t,a)),[,c]=l.reduce((a,u,f)=>a[0]<u?a:[u,f],[l[0],0]);return Me(s[c])}const he=e=>e.orientation==="white",ls="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",jl={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},Kl={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function cs(e){e==="start"&&(e=ls);const t=new Map;let n=7,r=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--n,n<0)return t;r=0;break;case"~":{const s=Me([r-1,n]),o=s&&t.get(s);o&&(o.promoted=!0);break}default:{const s=i.charCodeAt(0);if(s<57)r+=s-48;else{const o=i.toLowerCase(),l=Me([r,n]);l&&t.set(l,{role:jl[o],color:i===o?"black":"white"}),++r}}}return t}function zl(e){return dl.map(t=>ln.map(n=>{const r=e.get(n+t);if(r){let i=Kl[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function as(e,t){t.animation&&(Or(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function us(e,t){if(t.movable?.dests&&(e.movable.dests=void 0),t.drawable?.autoShapes&&(e.drawable.autoShapes=[]),Or(e,t),t.fen&&(e.pieces=cs(t.fen),e.drawable.shapes=t.drawable?.shapes||[]),"check"in t&&xl(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&ss(e,e.selected),as(e,t),!e.movable.rookCastle&&e.movable.dests){const n=e.movable.color==="white"?"1":"8",r="e"+n,i=e.movable.dests.get(r),s=e.pieces.get(r);if(!i||!s||s.role!=="king")return;e.movable.dests.set(r,i.filter(o=>!(o==="a"+n&&i.includes("c"+n))&&!(o==="h"+n&&i.includes("g"+n))))}}function Or(e,t){for(const n in t)n==="__proto__"||n==="constructor"||!Object.prototype.hasOwnProperty.call(t,n)||(Object.prototype.hasOwnProperty.call(e,n)&&Yr(e[n])&&Yr(t[n])?Or(e[n],t[n]):e[n]=t[n])}function Yr(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const Ye=(e,t)=>t.animation.enabled?Wl(e,t):Ue(e,t);function Ue(e,t){const n=e(t);return t.dom.redraw(),n}const Kn=(e,t)=>({key:e,pos:z(e),piece:t}),Ul=(e,t)=>t.sort((n,r)=>It(e.pos,n.pos)-It(e.pos,r.pos))[0];function Hl(e,t){const n=new Map,r=[],i=new Map,s=[],o=[],l=new Map;let c,a,u;for(const[f,d]of e)l.set(f,Kn(f,d));for(const f of $n)c=t.pieces.get(f),a=l.get(f),c?a?an(c,a.piece)||(s.push(a),o.push(Kn(f,c))):o.push(Kn(f,c)):a&&s.push(a);for(const f of o)a=Ul(f,s.filter(d=>an(f.piece,d.piece))),a&&(u=[a.pos[0]-f.pos[0],a.pos[1]-f.pos[1]],n.set(f.key,u.concat(u)),r.push(a.key));for(const f of s)r.includes(f.key)||i.set(f.key,f.piece);return{anims:n,fadings:i}}function fs(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=Gl(r);for(const s of n.plan.anims.values())s[2]=s[0]*i,s[3]=s[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((s=performance.now())=>fs(e,s))}}function Wl(e,t){const n=new Map(t.pieces),r=e(t),i=Hl(n,t);if(i.anims.size||i.fadings.size){const s=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},s||fs(t,performance.now())}else t.dom.redraw();return r}const Gl=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,Vl=["green","red","blue","yellow"];function Xl(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?_e(e):Ar(e);const n=at(t),r=ut(n,he(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:Jl(t),snapToValidMove:e.drawable.defaultSnapToValidMove},ds(e))}function ds(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=ut(t.pos,he(e),e.dom.bounds());n||(t.snapToValidMove=!1);const r=t.snapToValidMove?Bl(t.orig,t.pos,he(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),ds(e)}})}function Ql(e,t){e.drawable.current&&(e.drawable.current.pos=at(t))}function Yl(e){const t=e.drawable.current;t&&(t.mouseSq&&ec(e.drawable,t),hs(e))}function hs(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function Zl(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),gs(e.drawable))}const rr=(e,t)=>e.orig===t.orig&&e.dest===t.dest,ps=(e,t)=>e.brush===t.brush;function Jl(e){const t=(e.shiftKey||e.ctrlKey)&&Ui(e),n=e.altKey||e.metaKey||e.getModifierState?.("AltGraph");return Vl[(t?1:0)+(n?2:0)]}function ec(e,t){const n=e.shapes.find(r=>rr(r,t));n&&(e.shapes=e.shapes.filter(r=>!rr(r,t))),(!n||!ps(n,t))&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),gs(e)}function gs(e){e.onChange&&e.onChange(e.shapes)}function tc(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),r=at(t),i=ut(r,he(e),n);if(!i)return;const s=e.pieces.get(i),o=e.selected;if(!o&&e.drawable.enabled&&(e.drawable.eraseOnMovablePieceClick||!s||s.color!==e.turnColor)&&Zl(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||s||o||nc(e,r)))t.preventDefault();else if(t.touches)return;const l=!!e.premovable.current,c=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Er(e,e.selected,i)?Ye(f=>nr(f,i),e):nr(e,i);const a=e.selected===i,u=ws(e,i);if(s&&u&&a&&Il(e,i)){e.draggable.current={orig:i,piece:s,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:o,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const f=e.dom.elements.ghost;f&&(f.className=`ghost ${s.color} ${s.role}`,Se(f,Vt(n)(z(i),he(e))),_r(f,!0)),xr(e)}else l&&Ve(e),c&&Xe(e);e.dom.redraw()}function nc(e,t){const n=he(e),r=e.dom.bounds(),i=Math.pow(e.touchIgnoreRadius*r.width/16,2)*2;for(const s of e.pieces.keys()){const o=Hi(s,n,r);if(It(o,t)<=i)return!0}return!1}function rc(e,t,n,r){e.pieces.set("a0",t),e.dom.redraw();const s=at(n);e.draggable.current={orig:"a0",piece:t,origPos:s,pos:s,started:!0,element:()=>ws(e,"a0"),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},xr(e)}function xr(e){requestAnimationFrame(()=>{const t=e.draggable.current;if(!t)return;e.animation.current?.plan.anims.has(t.orig)&&(e.animation.current=void 0);const n=e.pieces.get(t.orig);if(!n||!an(n,t.piece))fn(e);else if(!t.started&&It(t.pos,t.origPos)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if(typeof t.element=="function"){const i=t.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),t.element=i}const r=e.dom.bounds();Se(t.element,[t.pos[0]-r.left-r.width/16,t.pos[1]-r.top-r.height/16]),t.keyHasChanged||(t.keyHasChanged=t.orig!==ut(t.pos,he(e),r))}xr(e)})}function ic(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=at(t))}function sc(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}Ve(e),Xe(e);const r=at(t)||n.pos,i=ut(r,he(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?is(e,n.orig,i,n.force):(e.stats.ctrlKey=t.ctrlKey,rs(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),de(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?_e(e):e.selectable.enabled||_e(e),ms(e),e.draggable.current=void 0,e.dom.redraw()}function fn(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,_e(e),ms(e),e.dom.redraw())}function ms(e){const t=e.dom.elements;t.ghost&&_r(t.ghost,!1)}function ws(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function oc(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{Zr(e,2),setTimeout(()=>Zr(e,void 0),120)},120)}function Zr(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function lc(e,t){function n(){Al(e),t()}return{set(r){r.orientation&&r.orientation!==e.orientation&&n(),as(e,r),(r.fen?Ye:Ue)(i=>us(i,r),e)},state:e,getFen:()=>zl(e.pieces),toggleOrientation:n,setPieces(r){Ye(i=>Ol(i,r),e)},selectSquare(r,i){r?Ye(s=>nr(s,r,i),e):e.selected&&(_e(e),e.dom.redraw())},move(r,i){Ye(s=>ts(s,r,i),e)},newPiece(r,i){Ye(s=>Pr(s,r,i),e)},playPremove(){if(e.premovable.current){if(Ye(Fl,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=ql(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){Ue(Ve,e)},cancelPredrop(){Ue(Xe,e)},cancelMove(){Ue(r=>{Ar(r),fn(r)},e)},stop(){Ue(r=>{Qr(r),fn(r)},e)},explode(r){oc(e,r)},setAutoShapes(r){Ue(i=>i.drawable.autoShapes=r,e)},setShapes(r){Ue(i=>i.drawable.shapes=r.slice(),e)},getKeyAtDomPos(r){return ut(r,he(e),e.dom.bounds())},redrawAll:t,dragNewPiece(r,i,s){rc(e,r,i,s)},destroy(){Qr(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function cc(){return{pieces:cs(ls),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,touchIgnoreRadius:1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,additionalPremoveRequirements:e=>!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnMovablePieceClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10},paleWhite:{key:"pwhite",color:"white",opacity:.6,lineWidth:10}},prevSvgHash:""},hold:pl()}}function ac(){const e=le("defs"),t=ae(le("filter"),{id:"cg-filter-blur"});return t.appendChild(ae(le("feGaussianBlur"),{stdDeviation:"0.013"})),e.appendChild(t),e}function uc(e,t){const n=e.drawable,r=n.current,i=r&&r.mouseSq?r:void 0,s=new Map,o=e.dom.bounds(),l=n.autoShapes.filter(f=>!f.piece);for(const f of n.shapes.concat(l).concat(i?[i]:[])){if(!f.dest)continue;const d=s.get(f.dest)??new Set,h=hn(dn(z(f.orig),e.orientation),o),w=hn(dn(z(f.dest),e.orientation),o);d.add(sr(h,w)),s.set(f.dest,d)}const c=[],a=i?n.shapes.findIndex(f=>rr(f,i)&&ps(f,i)):-1;for(const[f,d]of n.shapes.concat(l).entries()){const h=a!==-1&&a===f;c.push({shape:d,current:!1,pendingErase:h,hash:Jr(d,ir(d.dest,s),!1,o,h)})}i&&a===-1&&c.push({shape:i,current:!0,hash:Jr(i,ir(i.dest,s),!0,o,!1),pendingErase:!1});const u=c.map(f=>f.hash).join(";");u!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=u,fc(n,c,t),dc(c,t,f=>gc(e,f,n.brushes,s,o)))}function fc(e,t,n){for(const r of[n.shapes,n.shapesBelow]){const i=r.querySelector("defs"),s=t.filter(a=>r===n.shapesBelow==!!a.shape.below),o=new Map;for(const a of s.filter(u=>u.shape.dest&&u.shape.brush)){const u=bs(e.brushes[a.shape.brush],a.shape.modifiers),{key:f,color:d}=ys(a.shape);f&&d&&o.set(f,{key:f,color:d,opacity:1,lineWidth:1}),o.set(u.key,u)}const l=new Set;let c=i.firstElementChild;for(;c;)l.add(c.getAttribute("cgKey")),c=c.nextElementSibling;for(const[a,u]of o.entries())l.has(a)||i.appendChild(bc(u))}}function dc(e,t,n){for(const[r,i]of[[t.shapes,t.custom],[t.shapesBelow,t.customBelow]]){const[s,o]=[r,i].map(a=>a.querySelector("g")),l=e.filter(a=>r===t.shapesBelow==!!a.shape.below),c=new Map;for(const a of l)c.set(a.hash,!1);for(const a of[s,o]){const u=[];let f=a.firstElementChild,d;for(;f;)d=f.getAttribute("cgHash"),c.has(d)?c.set(d,!0):u.push(f),f=f.nextElementSibling;for(const h of u)a.removeChild(h)}for(const a of l.filter(u=>!c.get(u.hash)))for(const u of n(a))u.isCustom?o.appendChild(u.el):s.appendChild(u.el)}}function Jr({orig:e,dest:t,brush:n,piece:r,modifiers:i,customSvg:s,label:o,below:l},c,a,u,f){return[u.width,u.height,a,f&&"pendingErase",e,t,n,c&&"-",r&&hc(r),i&&pc(i),s&&`custom-${ei(s.html)},${s.center?.[0]??"o"}`,o&&`label-${ei(o.text)}`,l&&"below"].filter(d=>d).join(",")}function hc(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function pc(e){return[e.lineWidth,e.hilite].filter(t=>t).join(",")}function ei(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function gc(e,{shape:t,current:n,pendingErase:r,hash:i},s,o,l){const c=hn(dn(z(t.orig),e.orientation),l),a=t.dest?hn(dn(z(t.dest),e.orientation),l):c,u=t.brush&&bs(s[t.brush],t.modifiers),f=o.get(t.dest),d=[];if(u){const h=ae(le("g"),{cgHash:i});d.push({el:h}),c[0]!==a[0]||c[1]!==a[1]?h.appendChild(wc(t,u,c,a,n,ir(t.dest,o),r)):h.appendChild(mc(s[t.brush],c,n,l,r))}if(t.label){const h=t.label;h.fill??(h.fill=t.brush&&s[t.brush].color);const w=t.brush?void 0:"tr";d.push({el:yc(h,i,c,a,f,w),isCustom:!0})}if(t.customSvg){const h=t.customSvg.center??"orig",[w,p]=h==="label"?vs(c,a,f).map(k=>k-.5):h==="dest"?a:c,b=ae(le("g"),{transform:`translate(${w},${p})`,cgHash:i});b.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,d.push({el:b,isCustom:!0})}return d}function mc(e,t,n,r,i){const s=_c(),o=(r.width+r.height)/(4*Math.max(r.width,r.height));return ae(le("circle"),{stroke:e.color,"stroke-width":s[n?0:1],fill:"none",opacity:_s(e,n,i),cx:t[0],cy:t[1],r:o-s[1]/2})}function wc(e,t,n,r,i,s,o){function l(u){const f=kc(s&&!i),d=r[0]-n[0],h=r[1]-n[1],w=Math.atan2(h,d),p=Math.cos(w)*f,b=Math.sin(w)*f,k=ys(e);return ae(le("line"),{stroke:u?k.color:t.color,"stroke-width":vc(t,i)*(u?1.14:1),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?k.key:t.key})`,opacity:e.modifiers?.hilite&&!o?1:_s(t,i,o),x1:n[0],y1:n[1],x2:r[0]-p,y2:r[1]-b})}if(!e.modifiers?.hilite)return l(!1);const c=ae(le("g"),{opacity:t.opacity}),a=ae(le("g"),{filter:"url(#cg-filter-blur)"});return a.appendChild(Cc(n,r)),a.appendChild(l(!0)),c.appendChild(a),c.appendChild(l(!1)),c}function bc(e){const t=ae(le("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(ae(le("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function yc(e,t,n,r,i,s){const l=.4*.75**e.text.length,c=vs(n,r,i),a=s==="tr"?.4:0,u=ae(le("g"),{transform:`translate(${c[0]+a},${c[1]-a})`,cgHash:t});u.appendChild(ae(le("circle"),{r:.4/2,"fill-opacity":s?1:.8,"stroke-opacity":s?1:.7,"stroke-width":.03,fill:e.fill??"#666",stroke:"white"}));const f=ae(le("text"),{"font-size":l,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return f.innerHTML=e.text,u.appendChild(f),u}function dn(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function ir(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function le(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function ae(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function bs(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function _c(){return[3/64,4/64]}function vc(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function ys(e){const t=e.modifiers?.hilite;return{key:t&&`hilite-${t.replace("#","")}`,color:t}}function _s(e,t,n){return(e.opacity||1)*(n?.6:t?.9:1)}function kc(e){return(e?20:10)/64}function hn(e,t){const n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function Cc(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return ae(le("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function sr(e,t,n=!0){const r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(r*8/Math.PI)+16)%16:r}function $c(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,r)=>n+r*r,0))}function vs(e,t,n){let r=$c(e,t);const i=sr(e,t,!1);if(n&&(r-=33/64,n.size>1)){r-=10/64;const s=sr(e,t);(n.has((s+1)%16)||n.has((s+15)%16))&&s&1&&(r-=.4)}return[e[0]-Math.cos(i)*r,e[1]-Math.sin(i)*r].map(s=>s+.5)}function Pc(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const u of fl)e.classList.toggle("orientation-"+u,t.orientation===u);e.classList.toggle("manipulable",!t.viewOnly);const n=Be("cg-container");e.appendChild(n);const r=Be("cg-board");n.appendChild(r);let i,s,o,l,c;if(t.drawable.visible&&([i,s]=["cg-shapes-below","cg-shapes"].map(u=>ti(u,!0)),[o,l]=["cg-custom-below","cg-custom-svgs"].map(u=>ti(u,!1)),c=Be("cg-auto-pieces"),n.appendChild(i),n.appendChild(o),n.appendChild(s),n.appendChild(l),n.appendChild(c)),t.coordinates){const u=t.orientation==="black"?" black":"",f=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const d=t.orientation==="white"?h=>h+1:h=>8-h;ln.forEach((h,w)=>n.appendChild(zn(cn.map(p=>h+p),"squares rank"+d(w)+u+f)))}else n.appendChild(zn(cn,"ranks"+u+f)),n.appendChild(zn(ln,"files"+u))}let a;return t.draggable.enabled&&t.draggable.showGhost&&(a=Be("piece","ghost"),_r(a,!1),n.appendChild(a)),{board:r,container:n,wrap:e,ghost:a,shapes:s,shapesBelow:i,custom:l,customBelow:o,autoPieces:c}}function ti(e,t){const n=ae(le("svg"),{class:e,viewBox:t?"-4 -4 8 8":"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"});return t&&n.appendChild(ac()),n.appendChild(le("g")),n}function zn(e,t){const n=Be("coords",t);let r;for(const i of e)r=Be("coord"),r.textContent=i,n.appendChild(r);return n}function Ec(e,t){if(!e.dropmode.active)return;Ve(e),Xe(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const r=at(t),i=r&&ut(r,he(e),e.dom.bounds());i&&is(e,"a0",i)}e.dom.redraw()}function Sc(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=Oc(e);n.addEventListener("touchstart",r,{passive:!1}),n.addEventListener("mousedown",r,{passive:!1})}function Ac(e,t){const n=[];if("ResizeObserver"in window||n.push($t(document.body,"chessground.resize",t)),!e.viewOnly){const r=ni(e,ic,Ql),i=ni(e,sc,Yl);for(const o of["touchmove","mousemove"])n.push($t(document,o,r));for(const o of["touchend","mouseup"])n.push($t(document,o,i));const s=()=>e.dom.bounds.clear();n.push($t(document,"scroll",s,{capture:!0,passive:!0})),n.push($t(window,"resize",s,{passive:!0}))}return()=>n.forEach(r=>r())}function $t(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}const Oc=e=>t=>{e.draggable.current?fn(e):e.drawable.current?hs(e):t.shiftKey||Ui(t)?e.drawable.enabled&&Xl(e,t):e.viewOnly||(e.dropmode.active?Ec(e,t):tc(e,t))},ni=(e,t,n)=>r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)};function xc(e){const t=he(e),n=Vt(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,s=e.animation.current,o=s?s.plan.anims:new Map,l=s?s.plan.fadings:new Map,c=e.draggable.current,a=Lc(e),u=new Set,f=new Set,d=new Map,h=new Map;let w,p,b,k,_,T,O,N,Y,re;for(p=r.firstChild;p;){if(w=p.cgKey,ks(p))if(b=i.get(w),_=o.get(w),T=l.get(w),k=p.cgPiece,p.cgDragging&&(!c||c.orig!==w)&&(p.classList.remove("dragging"),Se(p,n(z(w),t)),p.cgDragging=!1),!T&&p.cgFading&&(p.cgFading=!1,p.classList.remove("fading")),b){if(_&&p.cgAnimating&&k===Pt(b)){const E=z(w);E[0]+=_[2],E[1]+=_[3],p.classList.add("anim"),Se(p,n(E,t))}else p.cgAnimating&&(p.cgAnimating=!1,p.classList.remove("anim"),Se(p,n(z(w),t)),e.addPieceZIndex&&(p.style.zIndex=Un(z(w),t)));k===Pt(b)&&(!T||!p.cgFading)?u.add(w):T&&k===Pt(T)?(p.classList.add("fading"),p.cgFading=!0):Hn(d,k,p)}else Hn(d,k,p);else if(Cs(p)){const E=p.className;a.get(w)===E?f.add(w):Hn(h,E,p)}p=p.nextSibling}for(const[E,H]of a)if(!f.has(E)){Y=h.get(H),re=Y&&Y.pop();const F=n(z(E),t);if(re)re.cgKey=E,Se(re,F);else{const D=Be("square",H);D.cgKey=E,Se(D,F),r.insertBefore(D,r.firstChild)}}for(const[E,H]of i)if(_=o.get(E),!u.has(E))if(O=d.get(Pt(H)),N=O&&O.pop(),N){N.cgKey=E,N.cgFading&&(N.classList.remove("fading"),N.cgFading=!1);const F=z(E);e.addPieceZIndex&&(N.style.zIndex=Un(F,t)),_&&(N.cgAnimating=!0,N.classList.add("anim"),F[0]+=_[2],F[1]+=_[3]),Se(N,n(F,t))}else{const F=Pt(H),D=Be("piece",F),P=z(E);D.cgPiece=F,D.cgKey=E,_&&(D.cgAnimating=!0,P[0]+=_[2],P[1]+=_[3]),Se(D,n(P,t)),e.addPieceZIndex&&(D.style.zIndex=Un(P,t)),r.appendChild(D)}for(const E of d.values())ii(e,E);for(const E of h.values())ii(e,E)}function Rc(e){const t=he(e),n=Vt(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(ks(r)&&!r.cgAnimating||Cs(r))&&Se(r,n(z(r.cgKey),t)),r=r.nextSibling}function ri(e){const t=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,r=t.height/t.width,i=Math.floor(t.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,s=i*r;n.style.width=i+"px",n.style.height=s+"px",e.dom.bounds.clear(),e.addDimensionsCssVarsTo?.style.setProperty("---cg-width",i+"px"),e.addDimensionsCssVarsTo?.style.setProperty("---cg-height",s+"px")}const ks=e=>e.tagName==="PIECE",Cs=e=>e.tagName==="SQUARE";function ii(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function Un(e,t){const r=e[1];return`${t?10-r:3+r}`}const Pt=e=>`${e.color} ${e.role}`;function Lc(e){const t=new Map;if(e.lastMove&&e.highlight.lastMove)for(const i of e.lastMove)Ie(t,i,"last-move");if(e.check&&e.highlight.check&&Ie(t,e.check,"check"),e.selected&&(Ie(t,e.selected,"selected"),e.movable.showDests)){const i=e.movable.dests?.get(e.selected);if(i)for(const o of i)Ie(t,o,"move-dest"+(e.pieces.has(o)?" oc":""));const s=e.premovable.customDests?.get(e.selected)??e.premovable.dests;if(s)for(const o of s)Ie(t,o,"premove-dest"+(e.pieces.has(o)?" oc":""))}const n=e.premovable.current;if(n)for(const i of n)Ie(t,i,"current-premove");else e.predroppable.current&&Ie(t,e.predroppable.current.key,"current-premove");const r=e.exploding;if(r)for(const i of r.keys)Ie(t,i,"exploding"+r.stage);return e.highlight.custom&&e.highlight.custom.forEach((i,s)=>{Ie(t,s,i)}),t}function Ie(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function Hn(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function Mc(e,t,n){const r=new Map,i=[];for(const l of e)r.set(l.hash,!1);let s=t.firstElementChild,o;for(;s;)o=s.getAttribute("cgHash"),r.has(o)?r.set(o,!0):i.push(s),s=s.nextElementSibling;for(const l of i)t.removeChild(l);for(const l of e)r.get(l.hash)||t.appendChild(n(l))}function Nc(e,t){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:Ic(i),current:!1,pendingErase:!1}));Mc(r,t,i=>Dc(e,i,e.dom.bounds()))}function Tc(e){const t=he(e),n=Vt(e.dom.bounds());let r=e.dom.elements.autoPieces?.firstChild;for(;r;)zi(r,n(z(r.cgKey),t),r.cgScale),r=r.nextSibling}function Dc(e,{shape:t,hash:n},r){const i=t.orig,s=t.piece?.role,o=t.piece?.color,l=t.piece?.scale,c=Be("piece",`${s} ${o}`);return c.setAttribute("cgHash",n),c.cgKey=i,c.cgScale=l,zi(c,Vt(r)(z(i),he(e)),l),c}const Ic=e=>[e.orig,e.piece?.role,e.piece?.color,e.piece?.scale].join(",");function Fc(e,t){const n=cc();us(n,t||{});function r(){const i="dom"in n?n.dom.unbind:void 0,s=Pc(e,n),o=Ki(()=>s.board.getBoundingClientRect()),l=u=>{xc(a),s.autoPieces&&Nc(a,s.autoPieces),!u&&s.shapes&&uc(a,s)},c=()=>{ri(a),Rc(a),s.autoPieces&&Tc(a)},a=n;return a.dom={elements:s,bounds:o,redraw:qc(l),redrawNow:l,unbind:i},a.drawable.prevSvgHash="",ri(a),l(!1),Sc(a,c),i||(a.dom.unbind=Ac(a,c)),a.events.insert&&a.events.insert(s),a}return lc(r(),r)}function qc(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const pn=["a","b","c","d","e","f","g","h"],$s=["1","2","3","4","5","6","7","8"],nt=["white","black"],Ce=["pawn","knight","bishop","rook","queen","king"],Bc=["a","h"],gn=e=>"role"in e,I=e=>e!==void 0,ie=e=>e==="white"?"black":"white",rt=e=>e>>3,ge=e=>e&7,or=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,xt=e=>{switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function lr(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Rt(e){if(e.length===2)return or(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const Ft=e=>pn[ge(e)]+$s[rt(e)],jc=e=>{if(e[1]==="@"&&e.length===4){const t=lr(e[0]),n=Rt(e.slice(2));if(t&&I(n))return{role:t,to:n}}else if(e.length===4||e.length===5){const t=Rt(e.slice(0,2)),n=Rt(e.slice(2,4));let r;if(e.length===5&&(r=lr(e[4]),!r))return;if(I(t)&&I(n))return{from:t,to:n,promotion:r}}},Rr=(e,t)=>e==="white"?t==="a"?2:6:t==="a"?58:62,Lr=(e,t)=>e==="white"?t==="a"?3:5:t==="a"?59:61,Kc=(e,t)=>{const n=new Map,r=e.ctx();for(const[i,s]of e.allDests(r))if(s.nonEmpty()){const o=Array.from(s,Ft);i===r.king&&ge(i)===4&&(s.has(0)?o.push("c1"):s.has(56)&&o.push("c8"),s.has(7)?o.push("g1"):s.has(63)&&o.push("g8")),n.set(Ft(i),o)}return n};function zc(e){let t=0;return n=>{t+=n.deltaY*(n.deltaMode?40:1),Math.abs(t)>=4?(e(n,!0),t=0):e(n,!1)}}const si=e=>(e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),cr=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),oi=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,cr(e));class m{constructor(t,n){this.lo=t|0,this.hi=n|0}static fromSquare(t){return t>=32?new m(0,1<<t-32):new m(1<<t,0)}static fromRank(t){return new m(255,0).shl64(8*t)}static fromFile(t){return new m(16843009<<t,16843009<<t)}static empty(){return new m(0,0)}static full(){return new m(4294967295,4294967295)}static corners(){return new m(129,2164260864)}static center(){return new m(402653184,24)}static backranks(){return new m(255,4278190080)}static backrank(t){return t==="white"?new m(255,0):new m(0,4278190080)}static lightSquares(){return new m(1437226410,1437226410)}static darkSquares(){return new m(2857740885,2857740885)}complement(){return new m(~this.lo,~this.hi)}xor(t){return new m(this.lo^t.lo,this.hi^t.hi)}union(t){return new m(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new m(this.lo&t.lo,this.hi&t.hi)}diff(t){return new m(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?m.empty():t>=32?new m(this.hi>>>t-32,0):t>0?new m(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?m.empty():t>=32?new m(0,this.lo<<t-32):t>0?new m(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new m(cr(this.hi),cr(this.lo))}rbit64(){return new m(oi(this.hi),oi(this.lo))}minus64(t){const n=this.lo-t.lo,r=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new m(n,this.hi-(t.hi+r))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return si(this.lo)+si(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(t){return(t>=32?this.hi&1<<t-32:this.lo&1<<t)!==0}set(t,n){return n?this.with(t):this.without(t)}with(t){return t>=32?new m(this.lo,this.hi|1<<t-32):new m(this.lo|1<<t,this.hi)}without(t){return t>=32?new m(this.lo,this.hi&~(1<<t-32)):new m(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new m(this.lo,this.hi^1<<t-32):new m(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new m(this.lo&this.lo-1,this.hi):new m(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,n=this.hi;for(;t!==0;){const r=31-Math.clz32(t&-t);t^=1<<r,yield r}for(;n!==0;){const r=31-Math.clz32(n&-n);n^=1<<r,yield 32+r}}*reversed(){let t=this.lo,n=this.hi;for(;n!==0;){const r=31-Math.clz32(n);n^=1<<r,yield 32+r}for(;t!==0;){const r=31-Math.clz32(t);t^=1<<r,yield r}}}const mn=(e,t)=>{let n=m.empty();for(const r of t){const i=e+r;0<=i&&i<64&&Math.abs(ge(e)-ge(i))<=2&&(n=n.with(i))}return n},Ge=e=>{const t=[];for(let n=0;n<64;n++)t[n]=e(n);return t},Uc=Ge(e=>mn(e,[-9,-8,-7,-1,1,7,8,9])),Hc=Ge(e=>mn(e,[-17,-15,-10,-6,6,10,15,17])),Wc={white:Ge(e=>mn(e,[7,9])),black:Ge(e=>mn(e,[-7,-9]))},Mr=e=>Uc[e],Nr=e=>Hc[e],On=(e,t)=>Wc[e][t],ar=Ge(e=>m.fromFile(ge(e)).without(e)),ur=Ge(e=>m.fromRank(rt(e)).without(e)),fr=Ge(e=>{const t=new m(134480385,2151686160),n=8*(rt(e)-ge(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),dr=Ge(e=>{const t=new m(270549120,16909320),n=8*(rt(e)+ge(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),hr=(e,t,n)=>{let r=n.intersect(t),i=r.bswap64();return r=r.minus64(e),i=i.minus64(e.bswap64()),r.xor(i.bswap64()).intersect(t)},Gc=(e,t)=>hr(m.fromSquare(e),ar[e],t),Vc=(e,t)=>{const n=ur[e];let r=t.intersect(n),i=r.rbit64();return r=r.minus64(m.fromSquare(e)),i=i.minus64(m.fromSquare(63-e)),r.xor(i.rbit64()).intersect(n)},qt=(e,t)=>{const n=m.fromSquare(e);return hr(n,fr[e],t).xor(hr(n,dr[e],t))},Bt=(e,t)=>Gc(e,t).xor(Vc(e,t)),Ps=(e,t)=>qt(e,t).xor(Bt(e,t)),Es=(e,t)=>{const n=m.fromSquare(t);return ur[e].intersects(n)?ur[e].with(e):dr[e].intersects(n)?dr[e].with(e):fr[e].intersects(n)?fr[e].with(e):ar[e].intersects(n)?ar[e].with(e):m.empty()},jt=(e,t)=>Es(e,t).intersect(m.full().shl64(e).xor(m.full().shl64(t))).withoutFirst();class bt{constructor(){}static default(){const t=new bt;return t.reset(),t}reset(){this.occupied=new m(65535,4294901760),this.promoted=m.empty(),this.white=new m(65535,0),this.black=new m(0,4294901760),this.pawn=new m(65280,16711680),this.knight=new m(66,1107296256),this.bishop=new m(36,603979776),this.rook=new m(129,2164260864),this.queen=new m(8,134217728),this.king=new m(16,268435456)}static empty(){const t=new bt;return t.clear(),t}clear(){this.occupied=m.empty(),this.promoted=m.empty();for(const t of nt)this[t]=m.empty();for(const t of Ce)this[t]=m.empty()}clone(){const t=new bt;t.occupied=this.occupied,t.promoted=this.promoted;for(const n of nt)t[n]=this[n];for(const n of Ce)t[n]=this[n];return t}getColor(t){if(this.white.has(t))return"white";if(this.black.has(t))return"black"}getRole(t){for(const n of Ce)if(this[n].has(t))return n}get(t){const n=this.getColor(t);if(!n)return;const r=this.getRole(t),i=this.promoted.has(t);return{color:n,role:r,promoted:i}}take(t){const n=this.get(t);return n&&(this.occupied=this.occupied.without(t),this[n.color]=this[n.color].without(t),this[n.role]=this[n.role].without(t),n.promoted&&(this.promoted=this.promoted.without(t))),n}set(t,n){const r=this.take(t);return this.occupied=this.occupied.with(t),this[n.color]=this[n.color].with(t),this[n.role]=this[n.role].with(t),n.promoted&&(this.promoted=this.promoted.with(t)),r}has(t){return this.occupied.has(t)}*[Symbol.iterator](){for(const t of this.occupied)yield[t,this.get(t)]}pieces(t,n){return this[t].intersect(this[n])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}steppers(){return this.knight.union(this.pawn).union(this.king)}sliders(){return this.bishop.union(this.rook).union(this.queen)}kingOf(t){return this.pieces(t,"king").singleSquare()}}class Ae{constructor(){}static empty(){const t=new Ae;for(const n of Ce)t[n]=0;return t}static fromBoard(t,n){const r=new Ae;for(const i of Ce)r[i]=t.pieces(n,i).size();return r}clone(){const t=new Ae;for(const n of Ce)t[n]=this[n];return t}equals(t){return Ce.every(n=>this[n]===t[n])}add(t){const n=new Ae;for(const r of Ce)n[r]=this[r]+t[r];return n}subtract(t){const n=new Ae;for(const r of Ce)n[r]=this[r]-t[r];return n}nonEmpty(){return Ce.some(t=>this[t]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class Je{constructor(t,n){this.white=t,this.black=n}static empty(){return new Je(Ae.empty(),Ae.empty())}static fromBoard(t){return new Je(Ae.fromBoard(t,"white"),Ae.fromBoard(t,"black"))}clone(){return new Je(this.white.clone(),this.black.clone())}equals(t){return this.white.equals(t.white)&&this.black.equals(t.black)}add(t){return new Je(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new Je(this.white.subtract(t.white),this.black.subtract(t.black))}count(t){return this.white[t]+this.black[t]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class Kt{constructor(t,n){this.white=t,this.black=n}static default(){return new Kt(3,3)}clone(){return new Kt(this.white,this.black)}equals(t){return this.white===t.white&&this.black===t.black}}class Ss{unwrap(t,n){const r=this._chain(i=>A.ok(t?t(i):i),i=>n?A.ok(n(i)):A.err(i));if(r.isErr)throw r.error;return r.value}map(t,n){return this._chain(r=>A.ok(t(r)),r=>A.err(n?n(r):r))}chain(t,n){return this._chain(t,n??(r=>A.err(r)))}}class Xc extends Ss{constructor(t){super(),this.value=t,this.isOk=!0,this.isErr=!1}_chain(t,n){return t(this.value)}}class Qc extends Ss{constructor(t){super(),this.error=t,this.isOk=!1,this.isErr=!0}_chain(t,n){return n(this.error)}}var A;(function(e){function t(i){return new Xc(i)}e.ok=t;function n(i){return new Qc(i||new Error)}e.err=n;function r(i){if(Array.isArray(i)){const l=[];for(let c=0;c<i.length;c++){const a=i[c];if(a.isErr)return a;l.push(a.value)}return e.ok(l)}const s={},o=Object.keys(i);for(let l=0;l<o.length;l++){const c=i[o[l]];if(c.isErr)return c;s[o[l]]=c.value}return e.ok(s)}e.all=r})(A||(A={}));var He;(function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"})(He||(He={}));class ht extends Error{}const Yc=(e,t,n,r)=>n[t].intersect(Bt(e,r).intersect(n.rooksAndQueens()).union(qt(e,r).intersect(n.bishopsAndQueens())).union(Nr(e).intersect(n.knight)).union(Mr(e).intersect(n.king)).union(On(ie(t),e).intersect(n.pawn)));class et{constructor(){}static default(){const t=new et;return t.castlingRights=m.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new m(14,0),h:new m(96,0)},black:{a:new m(0,234881024),h:new m(0,1610612736)}},t}static empty(){const t=new et;return t.castlingRights=m.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:m.empty(),h:m.empty()},black:{a:m.empty(),h:m.empty()}},t}clone(){const t=new et;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(t,n,r,i){const s=Rr(t,n),o=Lr(t,n);this.castlingRights=this.castlingRights.with(i),this.rook[t][n]=i,this.path[t][n]=jt(i,o).with(o).union(jt(r,s).with(s)).without(r).without(i)}static fromSetup(t){const n=et.empty(),r=t.castlingRights.intersect(t.board.rook);for(const i of nt){const s=m.backrank(i),o=t.board.kingOf(i);if(!I(o)||!s.has(o))continue;const l=r.intersect(t.board[i]).intersect(s),c=l.first();I(c)&&c<o&&n.add(i,"a",o,c);const a=l.last();I(a)&&o<a&&n.add(i,"h",o,a)}return n}discardRook(t){if(this.castlingRights.has(t)){this.castlingRights=this.castlingRights.without(t);for(const n of nt)for(const r of Bc)this.rook[n][r]===t&&(this.rook[n][r]=void 0)}}discardColor(t){this.castlingRights=this.castlingRights.diff(m.backrank(t)),this.rook[t].a=void 0,this.rook[t].h=void 0}}class Zc{constructor(t){this.rules=t}reset(){this.board=bt.default(),this.pockets=void 0,this.turn="white",this.castles=et.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){this.board=t.board.clone(),this.board.promoted=m.empty(),this.pockets=void 0,this.turn=t.turn,this.castles=et.fromSetup(t),this.epSquare=Jc(this,t.epSquare),this.remainingChecks=void 0,this.halfmoves=t.halfmoves,this.fullmoves=t.fullmoves}kingAttackers(t,n,r){return Yc(t,n,this.board,r)}playCaptureAt(t,n){this.halfmoves=0,n.role==="rook"&&this.castles.discardRook(t),this.pockets&&this.pockets[ie(n.color)][n.promoted?"pawn":n.role]++}ctx(){const t=this.isVariantEnd(),n=this.board.kingOf(this.turn);if(!I(n))return{king:n,blockers:m.empty(),checkers:m.empty(),variantEnd:t,mustCapture:!1};const r=Bt(n,m.empty()).intersect(this.board.rooksAndQueens()).union(qt(n,m.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[ie(this.turn)]);let i=m.empty();for(const o of r){const l=jt(n,o).intersect(this.board.occupied);l.moreThanOne()||(i=i.union(l))}const s=this.kingAttackers(n,ie(this.turn),this.board.occupied);return{king:n,blockers:i,checkers:s,variantEnd:t,mustCapture:!1}}clone(){var t,n;const r=new this.constructor;return r.board=this.board.clone(),r.pockets=(t=this.pockets)===null||t===void 0?void 0:t.clone(),r.turn=this.turn,r.castles=this.castles.clone(),r.epSquare=this.epSquare,r.remainingChecks=(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),r.halfmoves=this.halfmoves,r.fullmoves=this.fullmoves,r}validate(){if(this.board.occupied.isEmpty())return A.err(new ht(He.Empty));if(this.board.king.size()!==2)return A.err(new ht(He.Kings));if(!I(this.board.kingOf(this.turn)))return A.err(new ht(He.Kings));const t=this.board.kingOf(ie(this.turn));return I(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?A.err(new ht(He.OppositeCheck)):m.backranks().intersects(this.board.pawn)?A.err(new ht(He.PawnsOnBackrank)):A.ok(void 0):A.err(new ht(He.Kings))}dropDests(t){return m.empty()}dests(t,n){if(n=n||this.ctx(),n.variantEnd)return m.empty();const r=this.board.get(t);if(!r||r.color!==this.turn)return m.empty();let i,s;if(r.role==="pawn"){i=On(this.turn,t).intersect(this.board[ie(this.turn)]);const o=this.turn==="white"?8:-8,l=t+o;if(0<=l&&l<64&&!this.board.occupied.has(l)){i=i.with(l);const c=this.turn==="white"?t<16:t>=48,a=l+o;c&&!this.board.occupied.has(a)&&(i=i.with(a))}I(this.epSquare)&&ta(this,t,n)&&(s=m.fromSquare(this.epSquare))}else r.role==="bishop"?i=qt(t,this.board.occupied):r.role==="knight"?i=Nr(t):r.role==="rook"?i=Bt(t,this.board.occupied):r.role==="queen"?i=Ps(t,this.board.occupied):i=Mr(t);if(i=i.diff(this.board[this.turn]),I(n.king)){if(r.role==="king"){const o=this.board.occupied.without(t);for(const l of i)this.kingAttackers(l,ie(this.turn),o).nonEmpty()&&(i=i.without(l));return i.union(li(this,"a",n)).union(li(this,"h",n))}if(n.checkers.nonEmpty()){const o=n.checkers.singleSquare();if(!I(o))return m.empty();i=i.intersect(jt(o,n.king).with(o))}n.blockers.has(t)&&(i=i.intersect(Es(t,n.king)))}return s&&(i=i.union(s)),i}isVariantEnd(){return!1}variantOutcome(t){}hasInsufficientMaterial(t){return this.board[t].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[t].intersects(this.board.knight)?this.board[t].size()<=2&&this.board[ie(t)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[t].intersects(this.board.bishop)?(!this.board.bishop.intersects(m.darkSquares())||!this.board.bishop.intersects(m.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var t,n;return{board:this.board.clone(),pockets:(t=this.pockets)===null||t===void 0?void 0:t.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:ea(this),remainingChecks:(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return nt.every(t=>this.hasInsufficientMaterial(t))}hasDests(t){t=t||this.ctx();for(const n of this.board[this.turn])if(this.dests(n,t).nonEmpty())return!0;return this.dropDests(t).nonEmpty()}isLegal(t,n){if(gn(t))return!this.pockets||this.pockets[this.turn][t.role]<=0||t.role==="pawn"&&m.backranks().has(t.to)?!1:this.dropDests(n).has(t.to);{if(t.promotion==="pawn"||t.promotion==="king"&&this.rules!=="antichess"||!!t.promotion!==(this.board.pawn.has(t.from)&&m.backranks().has(t.to)))return!1;const r=this.dests(t.from,n);return r.has(t.to)||r.has(na(this,t).to)}}isCheck(){const t=this.board.kingOf(this.turn);return I(t)&&this.kingAttackers(t,ie(this.turn),this.board.occupied).nonEmpty()}isEnd(t){return(t?t.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(t)}isCheckmate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.nonEmpty()&&!this.hasDests(t)}isStalemate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.isEmpty()&&!this.hasDests(t)}outcome(t){const n=this.variantOutcome(t);return n||(t=t||this.ctx(),this.isCheckmate(t)?{winner:ie(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(t)?{winner:void 0}:void 0)}allDests(t){t=t||this.ctx();const n=new Map;if(t.variantEnd)return n;for(const r of this.board[this.turn])n.set(r,this.dests(r,t));return n}play(t){const n=this.turn,r=this.epSquare,i=Os(this,t);if(this.epSquare=void 0,this.halfmoves+=1,n==="black"&&(this.fullmoves+=1),this.turn=ie(n),gn(t))this.board.set(t.to,{role:t.role,color:n}),this.pockets&&this.pockets[n][t.role]--,t.role==="pawn"&&(this.halfmoves=0);else{const s=this.board.take(t.from);if(!s)return;let o;if(s.role==="pawn"){this.halfmoves=0,t.to===r&&(o=this.board.take(t.to+(n==="white"?-8:8)));const l=t.from-t.to;Math.abs(l)===16&&8<=t.from&&t.from<=55&&(this.epSquare=t.from+t.to>>1),t.promotion&&(s.role=t.promotion,s.promoted=!!this.pockets)}else if(s.role==="rook")this.castles.discardRook(t.from);else if(s.role==="king"){if(i){const l=this.castles.rook[n][i];if(I(l)){const c=this.board.take(l);this.board.set(Rr(n,i),s),c&&this.board.set(Lr(n,i),c)}}this.castles.discardColor(n)}if(!i){const l=this.board.set(t.to,s)||o;l&&this.playCaptureAt(t.to,l)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[n]=Math.max(this.remainingChecks[n]-1,0))}}class As extends Zc{constructor(){super("chess")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(r=>n)}clone(){return super.clone()}}const Jc=(e,t)=>{if(!I(t))return;const n=e.turn==="white"?5:2,r=e.turn==="white"?8:-8;if(rt(t)!==n||e.board.occupied.has(t+r))return;const i=t-r;if(!(!e.board.pawn.has(i)||!e.board[ie(e.turn)].has(i)))return t},ea=e=>{if(!I(e.epSquare))return;const t=e.ctx(),r=e.board.pieces(e.turn,"pawn").intersect(On(ie(e.turn),e.epSquare));for(const i of r)if(e.dests(i,t).has(e.epSquare))return e.epSquare},ta=(e,t,n)=>{if(!I(e.epSquare)||!On(e.turn,t).has(e.epSquare))return!1;if(!I(n.king))return!0;const r=e.turn==="white"?8:-8,i=e.epSquare-r;return e.kingAttackers(n.king,ie(e.turn),e.board.occupied.toggle(t).toggle(i).with(e.epSquare)).without(i).isEmpty()},li=(e,t,n)=>{if(!I(n.king)||n.checkers.nonEmpty())return m.empty();const r=e.castles.rook[e.turn][t];if(!I(r)||e.castles.path[e.turn][t].intersects(e.board.occupied))return m.empty();const i=Rr(e.turn,t),s=jt(n.king,i),o=e.board.occupied.without(n.king);for(const a of s)if(e.kingAttackers(a,ie(e.turn),o).nonEmpty())return m.empty();const l=Lr(e.turn,t),c=e.board.occupied.toggle(n.king).toggle(r).toggle(l);return e.kingAttackers(i,ie(e.turn),c).nonEmpty()?m.empty():m.fromSquare(r)},Os=(e,t)=>{if(gn(t))return;const n=t.to-t.from;if(!(Math.abs(n)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return n>0?"h":"a"},na=(e,t)=>{const n=Os(e,t);if(!n)return t;const r=e.castles.rook[e.turn][n];return{from:t.from,to:I(r)?r:t.to}},ra="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ia=ra+" w KQkq -",Tr=ia+" 0 1";var ne;(function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"})(ne||(ne={}));class se extends Error{}const sa=(e,t,n)=>{let r=e.indexOf(t);for(;n-- >0&&r!==-1;)r=e.indexOf(t,r+t.length);return r},gt=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,xs=e=>{const t=lr(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},Wn=e=>{const t=bt.empty();let n=7,r=0;for(let i=0;i<e.length;i++){const s=e[i];if(s==="/"&&r===8)r=0,n--;else{const o=parseInt(s,10);if(o>0)r+=o;else{if(r>=8||n<0)return A.err(new se(ne.Board));const l=r+n*8,c=xs(s);if(!c)return A.err(new se(ne.Board));e[i+1]==="~"&&(c.promoted=!0,i++),t.set(l,c),r++}}}return n!==0||r!==8?A.err(new se(ne.Board)):A.ok(t)},ci=e=>{if(e.length>64)return A.err(new se(ne.Pockets));const t=Je.empty();for(const n of e){const r=xs(n);if(!r)return A.err(new se(ne.Pockets));t[r.color][r.role]++}return A.ok(t)},oa=(e,t)=>{let n=m.empty();if(t==="-")return A.ok(n);for(const r of t){const i=r.toLowerCase(),s=r===i?"black":"white",o=s==="white"?0:7;if("a"<=i&&i<="h")n=n.with(or(i.charCodeAt(0)-97,o));else if(i==="k"||i==="q"){const l=e[s].intersect(m.backrank(s)).intersect(e.rook.union(e.king)),c=i==="k"?l.last():l.first();n=n.with(I(c)&&e.rook.has(c)?c:or(i==="k"?7:0,o))}else return A.err(new se(ne.Castling))}return nt.some(r=>m.backrank(r).intersect(n).size()>2)?A.err(new se(ne.Castling)):A.ok(n)},ai=e=>{const t=e.split("+");if(t.length===3&&t[0]===""){const n=gt(t[1]),r=gt(t[2]);return!I(n)||n>3||!I(r)||r>3?A.err(new se(ne.RemainingChecks)):A.ok(new Kt(3-n,3-r))}else if(t.length===2){const n=gt(t[0]),r=gt(t[1]);return!I(n)||n>3||!I(r)||r>3?A.err(new se(ne.RemainingChecks)):A.ok(new Kt(n,r))}else return A.err(new se(ne.RemainingChecks))},la=e=>{const t=e.split(/[\s_]+/),n=t.shift();let r,i=A.ok(void 0);if(n.endsWith("]")){const l=n.indexOf("[");if(l===-1)return A.err(new se(ne.Fen));r=Wn(n.slice(0,l)),i=ci(n.slice(l+1,-1))}else{const l=sa(n,"/",7);l===-1?r=Wn(n):(r=Wn(n.slice(0,l)),i=ci(n.slice(l+1)))}let s;const o=t.shift();if(!I(o)||o==="w")s="white";else if(o==="b")s="black";else return A.err(new se(ne.Turn));return r.chain(l=>{const c=t.shift(),a=I(c)?oa(l,c):A.ok(m.empty()),u=t.shift();let f;if(I(u)&&u!=="-"&&(f=Rt(u),!I(f)))return A.err(new se(ne.EpSquare));let d=t.shift(),h;I(d)&&d.includes("+")&&(h=ai(d),d=t.shift());const w=I(d)?gt(d):0;if(!I(w))return A.err(new se(ne.Halfmoves));const p=t.shift(),b=I(p)?gt(p):1;if(!I(b))return A.err(new se(ne.Fullmoves));const k=t.shift();let _=A.ok(void 0);if(I(k)){if(I(h))return A.err(new se(ne.RemainingChecks));_=ai(k)}else I(h)&&(_=h);return t.length>0?A.err(new se(ne.Fen)):i.chain(T=>a.chain(O=>_.map(N=>({board:l,pockets:T,turn:s,castlingRights:O,remainingChecks:N,epSquare:f,halfmoves:w,fullmoves:Math.max(1,b)}))))})},ca=e=>{let t=xt(e.role);return e.color==="white"&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t},aa=e=>{let t="",n=0;for(let r=7;r>=0;r--)for(let i=0;i<8;i++){const s=i+r*8,o=e.get(s);o?(n>0&&(t+=n,n=0),t+=ca(o)):n++,i===7&&(n>0&&(t+=n,n=0),r!==0&&(t+="/"))}return t},ui=e=>Ce.map(t=>xt(t).repeat(e[t])).join(""),ua=e=>ui(e.white).toUpperCase()+ui(e.black),fa=(e,t)=>{let n="";for(const r of nt){const i=m.backrank(r);let s=e.kingOf(r);I(s)&&!i.has(s)&&(s=void 0);const o=e.pieces(r,"rook").intersect(i);for(const l of t.intersect(i).reversed())if(l===o.first()&&I(s)&&l<s)n+=r==="white"?"Q":"q";else if(l===o.last()&&I(s)&&s<l)n+=r==="white"?"K":"k";else{const c=pn[ge(l)];n+=r==="white"?c.toUpperCase():c}}return n||"-"},da=e=>`${e.white}+${e.black}`,ha=(e,t)=>[aa(e.board)+(e.pockets?`[${ua(e.pockets)}]`:""),e.turn[0],fa(e.board,e.castlingRights),I(e.epSquare)?Ft(e.epSquare):"-",...e.remainingChecks?[da(e.remainingChecks)]:[],Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))].join(" "),pa=(e,t)=>{let n="";if(gn(t))t.role!=="pawn"&&(n=xt(t.role).toUpperCase()),n+="@"+Ft(t.to);else{const r=e.board.getRole(t.from);if(!r)return"--";if(r==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))n=t.to>t.from?"O-O":"O-O-O";else{const i=e.board.occupied.has(t.to)||r==="pawn"&&ge(t.from)!==ge(t.to);if(r!=="pawn"){n=xt(r).toUpperCase();let s;if(r==="king"?s=Mr(t.to).intersect(e.board.king):r==="queen"?s=Ps(t.to,e.board.occupied).intersect(e.board.queen):r==="rook"?s=Bt(t.to,e.board.occupied).intersect(e.board.rook):r==="bishop"?s=qt(t.to,e.board.occupied).intersect(e.board.bishop):s=Nr(t.to).intersect(e.board.knight),s=s.intersect(e.board[e.turn]).without(t.from),s.nonEmpty()){const o=e.ctx();for(const l of s)e.dests(l,o).has(t.to)||(s=s.without(l));if(s.nonEmpty()){let l=!1,c=s.intersects(m.fromRank(rt(t.from)));s.intersects(m.fromFile(ge(t.from)))?l=!0:c=!0,c&&(n+=pn[ge(t.from)]),l&&(n+=$s[rt(t.from)])}}}else i&&(n=pn[ge(t.from)]);i&&(n+="x"),n+=Ft(t.to),t.promotion&&(n+="="+xt(t.promotion).toUpperCase())}}return n},ga=(e,t)=>{var n;const r=pa(e,t);return e.play(t),!((n=e.outcome())===null||n===void 0)&&n.winner?r+"#":e.isCheck()?r+"+":r},ma=(e,t)=>ga(e.clone(),t),xn=e=>As.fromSetup(la(e).unwrap()).unwrap(),wa=e=>xn(e).turn,Rs=(e,t)=>{let n=e[e.length-1]?.fen??Tr,r=xn(n),i=jc(t),s=ma(r,i);return r.play(i),{fen:ha(r.toSetup()),before_fen:n,uci:t,san:s}},fi=e=>{let t=[];return e.map(n=>{t=[...t,Rs(t,n)]}),t},ba=e=>e.map(t=>t.uci).join(" "),ya=e=>e.map((t,n)=>`${Ls(n+1)}${t.san}`).join(" "),Ls=e=>e%2===0?"":_a(e),_a=e=>`${Math.ceil(e/2)}.`+(e%2===0?"..":"");var va=M('<div class="is2d chessboard"> ');function ka(e){let t,n,r=$(()=>{try{return xn(e.fen??Tr)}catch{return As.default()}}),i=$(()=>Kc(r())),s=$(()=>r().isCheck());return Ut(()=>{let o=r().isCheck(),l={fen:e.fen,check:o,premovable:{enabled:!1},movable:{color:e.movable_color,free:!1,dests:i(),events:{after:e.play_orig_key}}};n=Fc(t,l)}),fe(()=>{let o;if(e.last_move_uci){let l=e.last_move_uci;o=[l.slice(0,2),l.slice(2,4)]}n.set({lastMove:o,fen:e.fen,turnColor:e.turn_color,orientation:e.orientation??"white",check:s(),movable:{color:e.movable_color,dests:i()}})}),fe(()=>{n.setAutoShapes(e.shapes??[])}),(()=>{var o=va();return Le(l=>t=l,o),o})()}const Ca=e=>zc(t=>{const n=t.target;n.tagName!=="PIECE"&&n.tagName!=="SQUARE"&&n.tagName!=="CG-BOARD"||(t.preventDefault(),e(Math.sign(t.deltaY)))});var $a=M('<button class="meet-button draw">');function Pa(e){return(()=>{var t=$a();return Oe(t,"click",e.onClick,!0),v(t,()=>e.children),Z(n=>{var r=e.disabled,i=!!e.gray,s=!!(e.draw||e.meet),o=!!e.meet;return r!==n.e&&(t.disabled=n.e=r),i!==n.t&&t.classList.toggle("gray",n.t=i),s!==n.a&&t.classList.toggle("draw",n.a=s),o!==n.o&&t.classList.toggle("meet",n.o=o),n},{e:void 0,t:void 0,a:void 0,o:void 0}),t})()}Te(["click"]);var Ea=M("<div class=moves-wrap><ul class=replay>"),Sa=M("<li class=move><span class=index>");function Aa(e){let t;return fe(()=>{let n=e.cursor,r=t.parentElement;if(!r)return;const i=t.querySelector(".cursor");if(!i){r.scrollTop=n>0?99999:0;return}let s=i.offsetTop-r.offsetHeight/2+i.offsetHeight;r.scrollTo({behavior:"smooth",top:s})}),(()=>{var n=Ea(),r=n.firstChild;return Le(i=>t=i,r),v(r,g(Gt,{get fallback(){return e.fallback},get each(){return e.san_moves},children:(i,s)=>(()=>{var o=Sa(),l=o.firstChild;return o.$$click=()=>e.on_set_cursor(s()),v(l,()=>Ls(s()+1)),v(o,i,null),Z(()=>o.classList.toggle("cursor",e.cursor===s())),o})()})),n})()}Te(["click"]);const zt={equals:!1},Oa=(e,t)=>e.length>0?()=>e(X(t)):e;function xa(e,t){let n=0;const r=e.map((i,s)=>$(()=>(n=s,i()),void 0,zt));return $(()=>r.map(i=>i())[n],void 0,t)}function Dr(e,t,n){let r=()=>t;const[i,s]=x(t,zt),o=$(Oa(e,()=>r()),t,zt);return[r=xa([i,o],n),(l=>s(()=>typeof l=="function"?l(X(r)):l))]}function Ra(e,t,n){let r=!1,i=!0;const[s,o]=x(void 0,zt),l=$(c=>r?e(c):(i=!s(),c),t,zt);return()=>{r=!0,i&&(i=o());const c=l();return r=!1,c}}function La(e,t){const n=16.666666666666668;let r=performance.now(),i=0,s;function o(l){s=requestAnimationFrame(o);let c=Math.min(l-r,1e3);for(r=l,i+=c;i>=n;)e(n),i-=n}return{start(){cancelAnimationFrame(s),s=requestAnimationFrame(o)},stop(){cancelAnimationFrame(s)}}}function Ma(e,t){const n=f=>{if(f.clientX||f.clientX===0)return[f.clientX,f.clientY]},r=f=>{let[d,h]=n(f)??[0,0];return[d-l.left,h-l.top]};function i(f){f.preventDefault(),e.setPointerCapture(f.pointerId);let d=r(f);t.on_down(d)}function s(f){let d=r(f);t.on_up(d)}function o(f){let d=r(f);t.on_move(d)}let l;c();function c(){l=e.getBoundingClientRect()}function a(){c()}e.addEventListener("pointerdown",i,{passive:!1}),e.addEventListener("pointermove",o,{passive:!1}),document.addEventListener("pointerup",s);let u=new ResizeObserver(c);return u.observe(e),document.addEventListener("scroll",a,{capture:!0,passive:!0}),window.addEventListener("resize",a,{passive:!0}),()=>{e.removeEventListener("pointerdown",i),e.removeEventListener("pointermove",o),document.removeEventListener("pointerup",s),document.removeEventListener("scroll",a),window.removeEventListener("resize",a),u.unobserve(e)}}function Na(e,t,n){return e<t?Math.min(e+n,t):e>t?Math.max(e-n,t):e}function Et(e,t){let[n,r,i,s]=e,[o,l,c,a]=t;return n<o+c&&n+i>o&&r<l+a&&r+s>l}function Ta(e,t){let n,r,i,s,o,l=!1,c=0,a={on_down(f){i=void 0,r=f,s=f,l=!1,t()},on_up(f){r=void 0,n=void 0,i=f},on_move(f){n=f,l=!0}},u=Ma(e,a);return{get is_hovering(){return n},get is_down(){return r},get is_up(){return i},get is_just_down(){return s},get is_double_click(){return o},get has_moved_after_last_down(){return l},update(f){o=void 0,s&&c>0&&(o=s,c=0),c=Na(c,0,f),s=void 0,i=void 0},disconnect(){u()},manual_trigger_down_hook(f){a.on_down(f)}}}const Da=1e-4;class Q{static rotate_point(t,n,r,i,s){let o=Math.cos(r),l=Math.sin(r),c=t-i,a=n-s,u=c*o-a*l,f=c*l+a*o;return u+=i,f+=s,Q.make(u,f)}static from_angle=t=>new Q(Math.cos(t),Math.sin(t));static make=(t,n)=>new Q(t,n);static xy=t=>new Q(t[0],t[1]);static get unit(){return new Q(1,1)}static get zero(){return new Q(0,0)}get xy(){return[this.x,this.y]}get mul_inverse(){return new Q(1/this.x,1/this.y)}get inverse(){return new Q(-this.x,-this.y)}get half(){return new Q(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){if(this.length!==0)return this.scale(1/this.length)}get perpendicular(){return new Q(-this.y,this.x)}get angle(){return Math.atan2(this.y,this.x)}x;y;constructor(t,n){this.x=t,this.y=n}clamp_epsilon(t=Da){return this.length<t?Q.zero:this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}project_to(t){let n=t.length_squared,r=this.dot(t);return Q.make(r*t.x/n,r*t.y/n)}distance(t){return this.sub(t).length}addy(t){return Q.make(this.x,this.y+t)}add_angle(t){return Q.from_angle(this.angle+t)}scale(t){return Q.make(this.x*t,this.y*t)}add(t){return Q.make(this.x+t.x,this.y+t.y)}sub(t){return Q.make(this.x-t.x,this.y-t.y)}mul(t){return Q.make(this.x*t.x,this.y*t.y)}div(t){return Q.make(this.x/t.x,this.y/t.y)}truncate(t){let n=this.length;return n>t?this.scale(t/n):this}}var Ia=M("<i>");const $e=e=>(()=>{var t=Ia();return Z(()=>Nt(t,"data-icon",e.icon)),t})(),Pe={Gear:"",CrossX:"",Gears:"",Delete:"",HeartEmpty:"",HeartFilled:"",DotEmpty:""};var Fa=M("<div class=sortable-list-wrap><ul class=sortable-list>"),qa=M("<div class=sortable-list-dragging>"),Ba=M("<li class=draggable><div class=handle><span>.</span></div><div class=content>");function ja(e){const[t,n]=x(void 0),[r,i]=Dr(()=>e.list),s=$($i(r,P=>({item:P}))),o=$(()=>t()?s().indexOf(t()):-1),l=(P,R)=>{if(P===R)return;let C=s();[C[P],C[R]]=[C[R],C[P]],i(C.slice(0).map(q=>q.item))};let c,a;const u=()=>(a===void 0&&(a=e.portal_selector.getBoundingClientRect()),a);let f,[d,h]=x(void 0);const w=()=>(f===void 0&&(f=E.getBoundingClientRect()),f),p=()=>{let P=u(),R=w(),C=10;return[R.left-P.left,R.bottom-P.top-C,R.width,C]},b=()=>{let P=u(),R=w();return[R.left-P.left,R.top-P.top,R.width,10]},k=()=>(d()===void 0&&h(H.getBoundingClientRect()),d()),_=P=>[P[0]-5,P[1]-5,10,10];Ut(()=>{let P,C=La(j=>{if(c.is_just_down&&(P=c.is_just_down),c.is_hovering){if(Et(p(),_(c.is_hovering))&&(E.scrollTop+=10),Et(b(),_(c.is_hovering))&&(E.scrollTop-=10),Y(c.is_hovering),t()!==void 0){let K=ce(c.is_hovering);K&&l(o(),K[0])}if(P&&Q.make(...c.is_hovering).distance(Q.make(...P))>4){let K=ce(c.is_hovering);if(K){let[ee,y]=K,S=s()[ee];n(S),O(y)}P=void 0}}c.is_up&&(n(void 0),C.stop(),e.set_ordered(s().map(K=>K.item)),e.portal_selector.classList.remove("active")),c.update(j)});c=Ta(e.portal_selector,C.start);const q=()=>{h(void 0),f=void 0,a=void 0};E.addEventListener("scroll",q);let V=new ResizeObserver(q);V.observe(E),je(()=>{c.disconnect(),C.stop(),E.removeEventListener("scroll",q),V.unobserve(E)});const J=$(()=>{k();let j=u();return[...H.querySelectorAll(".draggable")].map(K=>{let ee=K.getBoundingClientRect(),y=[ee.left-j.left,ee.top-j.top];return[y[0],y[1],ee.width,ee.height]})}),ce=j=>{let K=J().findIndex(y=>Et(y,_(j)));if(K===-1)return;let ee=J()[K];return[K,[j[0]-ee[0],j[1]-ee[1]]]}});const[T,O]=x([0,0]),[N,Y]=x([0,0]),re=$(()=>({transform:`translate(${N()[0]-T()[0]}px, ${N()[1]-T()[1]}px)`}));let E,H;const F=P=>{if(c===void 0)return;let R=u(),C=[P.clientX-R.left,P.clientY-R.top];Et(p(),_(C))||Et(b(),_(C))||(c.manual_trigger_down_hook(C),P.preventDefault(),e.portal_selector.classList.add("active"))},D=(P,R)=>Ht(()=>e.children(P,R));return[g(ke,{get when(){return t()},children:P=>g(mr,{get mount(){return e.portal_selector},get children(){var R=qa();return v(R,()=>e.dragging(P().item)),Z(C=>Ei(R,re(),C)),R}})}),(()=>{var P=Fa(),R=P.firstChild;return Le(C=>E=C,P),Le(C=>H=C,R),v(R,g(Gt,{get each(){return s()},children:(C,q)=>(()=>{var V=Ba(),J=V.firstChild,ce=J.firstChild,j=ce.firstChild,K=J.nextSibling;return J.$$pointerdown=F,v(J,g($e,{get icon(){return Pe.DotEmpty}}),ce),v(ce,()=>q()+1,j),v(K,()=>D(C.item,q)()),Z(()=>V.classList.toggle("dragging",o()===q())),V})()})),P})()]}Te(["pointerdown"]);var Ka=M('<div class="dropdown-menu show">'),za=M("<button class=dropdown-menu-toggle-button>");const Ms=e=>{let t,n;const[r,i]=x(!1);fe(()=>{if(r(),n===void 0||t===void 0)return;let c=e.portal_selector.getBoundingClientRect(),a=n.getBoundingClientRect(),u=a.bottom-c.top,f=a.left-c.left;f+200>window.innerWidth&&(f-=200-a.width),t.style.top=`${u}px`,t.style.left=`${f}px`});const s=()=>{i(!1)};je(()=>{window.removeEventListener("resize",s),document.removeEventListener("click",o)}),Ut(()=>{window.addEventListener("resize",s),document.addEventListener("click",o)});function o(c){t===void 0||t.contains(c.target),i(!1)}function l(c){e.portal_selector.classList.contains("active")||c.stopImmediatePropagation(),i(!r())}return fe(()=>{r()?e.portal_selector.classList.add("active"):e.portal_selector.classList.remove("active")}),[g(mr,{get mount(){return e.portal_selector},get children(){return g(ke,{get when(){return r()},get children(){var c=Ka(),a=t;return typeof a=="function"?Le(a,c):t=c,v(c,()=>e.children),c}})}}),(()=>{var c=za();c.$$click=l;var a=n;return typeof a=="function"?Le(a,c):n=c,v(c,()=>e.button),Z(()=>c.classList.toggle("active",!!r())),c})()]};Te(["click"]);var Ua=M("<span class=heart><span class=nb>");const Ha=e=>{const[t,n]=x(!1),[r,i]=Dr(()=>e.is_heart),s=()=>{i(!r()),e.on_heart(r()),n(!0),setTimeout(()=>n(!1),200)};return(()=>{var o=Ua(),l=o.firstChild;return o.$$click=s,v(o,g(ke,{get when(){return r()},get fallback(){return g($e,{get icon(){return Pe.HeartEmpty}})},get children(){return g($e,{get icon(){return Pe.HeartFilled}})}}),l),v(l,()=>e.nb_heart),Z(c=>{var a=!!r(),u=!!t();return a!==c.e&&o.classList.toggle("is-heart",c.e=a),u!==c.t&&o.classList.toggle("beat",c.t=u),c},{e:void 0,t:void 0}),o})()};Te(["click"]);var Wa=M("<button class=action-button>");const xe={Ok:1,Cancel:2,Normal:3},it=e=>{const t=yi(()=>e.action);return(()=>{var n=Wa();return Oe(n,"click",e.onClick,!0),v(n,g(ke,{get when(){return e.waiting},get fallback(){return e.children},children:"..."})),Z(r=>{var i=e.waiting,s=!!e.waiting,o=!!t(xe.Ok),l=!!t(xe.Cancel),c=!!t(xe.Normal);return i!==r.e&&(n.disabled=r.e=i),s!==r.t&&n.classList.toggle("waiting",r.t=s),o!==r.a&&n.classList.toggle("ok",r.a=o),l!==r.o&&n.classList.toggle("cancel",r.o=l),c!==r.i&&n.classList.toggle("normal",r.i=c),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),n})()};Te(["click"]);const wn=(e,t,n=[],r=[])=>{if(e){if(Array.isArray(e))e.forEach(i=>wn(i,t,n,r));else if(typeof e=="function")wn(e.apply(null,n),t,n,r);else{const i=e;(!t||(typeof t=="function"?t(i):i.nodeName===t))&&r.push(i)}return r}};var Xt=M("<div>");const Qt=e=>{const[t,n]=gr(e,["open","children","portal_selector","close_on_click_outside"]),[r,i]=x(!1),[s,o]=x(t.open);fe(()=>o(t.open));const l=d=>o(typeof d=="boolean"?d:h=>!h),c=Ra(()=>wn(t.children,d=>d.className.indexOf("sb-modal-content")!==-1,[{open:s,toggle:l,set_hold_close_outside:i}])??[]),a=$(()=>wn(t.children,d=>d.className.indexOf("sb-modal-content")===-1,[{open:s,toggle:l,set_hold_close_outside:i}]));let u;fe(()=>s()&&u?.focus(),u?.scrollIntoView());const f=()=>Ke(n,{role:"dialog",tabIndex:-1,class:e.class?`sb-modal ${e.class}`:"sb-modal",children:c(),onClick:$(()=>t.close_on_click_outside?d=>{if(r())return;const h=d.target;c().some(w=>w?.contains(h))||l(!1)}:void 0)()});return g(to,{get children(){return[g(zr,{get when(){return!s()},get children(){return a()}}),g(zr,{get when(){return s()},get children(){return[vt(a),g(mr,{get mount(){return t.portal_selector},get children(){var d=Xt(),h=u;return typeof h=="function"?Le(h,d):u=d,lt(d,Ke(f),!1,!1),d}})]}})]}})},Rn=e=>(()=>{var t=Xt();return lt(t,Ke(e,{get class(){return vt(()=>!!e.class)()?`sb-modal-content ${e.class}`:"sb-modal-content"}}),!1,!1),t})(),Ln=e=>(()=>{var t=Xt();return lt(t,Ke(e,{get class(){return vt(()=>!!e.class)()?`sb-modal-header ${e.class}`:"sb-modal-header"}}),!1,!1),t})(),Mn=e=>(()=>{var t=Xt();return lt(t,Ke(e,{get class(){return vt(()=>!!e.class)()?`sb-modal-body ${e.class}`:"sb-modal-body"}}),!1,!1),t})(),Ir=e=>(()=>{var t=Xt();return lt(t,Ke(e,{get class(){return vt(()=>!!e.class)()?`sb-modal-footer ${e.class}`:"sb-modal-footer"}}),!1,!1),t})();var Ga=M("<label class=custom-field><input name=custom-field class=highlighted-text type=text placeholder=_><span class=placeholder>");const Nn=e=>{const t=r=>{e.on_keyup(r.target.value,r.key==="Enter")},n=()=>e.value??"";return(()=>{var r=Ga(),i=r.firstChild,s=i.nextSibling;return Oe(i,"keyup",t),v(s,()=>e.placeholder),Z(()=>Nt(i,"size",e.size??50)),Z(()=>i.value=n()),r})()};var Va=M("<span class=error-line>");const Tn=e=>g(ke,{get when(){return e.error},children:t=>(()=>{var n=Va();return v(n,t),n})()}),Ns="https://api.linechess.com:3300",Dn=(e,t)=>fetch(Ns+e,{...t,credentials:"include"}).then(n=>n.json());async function Xa(e,t={}){return await Dn(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(r=>new Qa(r))}let bn=Dn("/session/init");const Fe=(e,t)=>bn.then(()=>Dn(e,t)),ue=(e,t={})=>bn.then(()=>Xa(e,t));class Qa extends Error{constructor(t){super(t),this.name="FetchError"}}const te=e=>e instanceof Error?A.err(e):typeof e=="object"&&e.errors!==void 0?A.err(e.errors):typeof e=="object"&&e.ok===!0?A.ok(e.data):A.ok(e);function Ya(){return{async logout(){await Fe("/logout"),bn=Dn("/session/init")},get_profile(){return bn.then(te)},undo:function(){return ue("/undo")},set_search_lines_term:function(e){return ue("/search",{term:e})},next_searched_lines_page:function(e){return ue("/search/next-page",{i:e})},next_playlist_page:function(e){return ue("/playlist/next-page",{i:e})},like_line:function(e,t){return ue("/line/like",{id:e,yes:t}).then(te)},like_playlist:function(e,t){return ue("/playlist/like",{id:e,yes:t}).then(te)},edit_playlist:function(e,t){return ue("/playlist/edit",{id:e,body:t}).then(te)},create_playlist:function(e,t){return ue("/playlist/create",{name:e,line:t}).then(te)},delete_playlist:function(e){return ue("/playlist/delete",{id:e}).then(te)},add_line_to_playlist:function(e,t){return ue("/playlist/add",{id:e,line_id:t}).then(te)},delete_line:function(e){return ue("/line/delete",{id:e}).then(te)},edit_line:function(e,t){return ue("/line/edit",{id:e,...t}).then(te)},create_line:function(e,t,n,r){return ue("/line/create",{playlist_id:e,name:t,moves:n,orientation:r}).then(te)},set_ordered_line_slots:function(e,t){return ue("/line/set_ordered",{playlist_id:e,lines:t}).then(te)},get_searched_playlists:function(){return Fe("/playlist/search").then(te)},get_global_recent_playlists:function(){return Fe("/playlist/global/recent").then(te)},get_mine_recent_playlists:function(){return Fe("/playlist/mine/recent").then(te)},get_global_playlists:function(){return Fe("/playlist/global").then(te)},get_mine_playlists:function(){return Fe("/playlist/mine").then(te)},get_liked_playlists:function(){return Fe("/playlist/liked").then(te)},get_selected_playlist_model:function(e){return Fe(`/playlist/selected/${e}`).then(te)},get_working_playlist_model:function(){return Fe("/playlist/selected").then(te)}}}function di(e,t={}){const n=t.storage||globalThis.localStorage,r=t.name||`storage-${eo()}`;if(!n)return[e[0],e[1],null];const i=t.storageOptions,s=t.serialize||JSON.stringify.bind(JSON),o=t.deserialize||JSON.parse.bind(JSON),l=n.getItem(r,i),c=typeof e[0]=="function"?u=>{try{const f=o(u);e[1](()=>f)}catch{}}:u=>{try{const f=o(u);e[1](al(f))}catch{}};let a=!0;if(l instanceof Promise?l.then(u=>a&&u&&c(u)):l&&c(l),typeof t.sync?.[0]=="function"){const u=typeof e[0]=="function"?e[0]:()=>e[0];t.sync[0](f=>{f.key!==r||(f.url||globalThis.location.href)!==globalThis.location.href||f.newValue===s(X(u))||c(f.newValue)})}return[e[0],typeof e[0]=="function"?u=>{const f=e[1](u),d=u!=null?s(f):u;return t.sync?.[1](r,d),d!=null?n.setItem(r,d,i):n.removeItem(r,i),a=!1,f}:(...u)=>{e[1](...u);const f=s(X(()=>e[0]));t.sync?.[1](r,f),n.setItem(r,f,i),a=!1},l]}function Za(e){let t=Ya();const[n,r]=di(x(void 0,{equals:!1}),{name:".linechess.selected_line_id.v1"}),[i,s]=di(x(void 0,{equals:!1}),{name:".linechess.selected_playlist_id.v1"}),[o,l]=x(!0,{equals:!1}),[c,a]=x(!0,{equals:!1}),[u,f]=x(!0,{equals:!1}),[d,h]=x(!0,{equals:!1}),[w,p]=x(!0,{equals:!1}),[b,k]=x(!1,{equals:!1}),[_,T]=x(!1,{equals:!1}),O=ze(async()=>{let y=i(),S;return y===void 0?(S=await t.get_working_playlist_model(),s(S.unwrap().playlist._id),l(!0)):(S=await t.get_selected_playlist_model(y),S.isErr&&(S=await t.get_working_playlist_model(),s(S.unwrap().playlist._id),l(!0))),S.map(W=>{let G=W.lines.find(pe=>pe._id===n())??W.lines[0];r(G?._id)}),S}),N=ze(async()=>o()?t.get_mine_playlists():A.err(new Error("No Fetch Requested"))),Y=ze(async()=>c()?t.get_liked_playlists():A.err(new Error("No Fetch Requested"))),re=ze(async()=>u()?t.get_global_playlists():A.err(new Error("No Fetch Requested"))),E=ze(async()=>d()?t.get_mine_recent_playlists():A.err(new Error("No Fetch Requested"))),H=ze(async()=>w()?t.get_global_recent_playlists():A.err(new Error("No Fetch Requested"))),F=ze(async()=>_()?t.get_searched_playlists():A.err(new Error("No Fetch Requested")));function D(y){j.playlist&&K("playlist","playlist",y)}function P(y){j.global_playlists&&K("global_playlists","list",S=>S._id===y._id,y)}function R(y){j.global_recent_playlists&&K("global_recent_playlists","list",S=>S._id===y._id,y)}function C(y){j.mine_playlists&&K("mine_playlists","list",S=>S._id===y._id,y)}function q(y){j.mine_recent_playlists&&K("mine_recent_playlists","list",S=>S._id===y._id,y)}const[V,J]=x(void 0,{equals:!1}),ce=ze(()=>(V(),t.get_profile()));let[j,K]=Bi({get profile(){return ce()?.unwrap()},get selected_line(){let y=n();return O()?.unwrap().lines.find(S=>S._id===y)},get playlist(){return O()?.unwrap()},get mine_playlists(){let y=N()?.unwrap();return y?{list:y}:void 0},get liked_playlists(){let y=Y()?.unwrap();return y?{list:y}:void 0},get global_playlists(){return re()?.unwrap()},get mine_recent_playlists(){let y=E()?.unwrap();return y?{list:y}:void 0},get global_recent_playlists(){let y=H()?.unwrap();return y?{list:y}:void 0},get searched_playlists(){return F()?.unwrap()}});return[j,{async profile_logout(){await t.logout(),J(),s(void 0),l(!0),a(!0),f(!0),h(!0),p(!0),k(!1),T(!1)},select_line(y){const[,{set_orientation:S,import_UCIs:W}]=e.build;r(y);let G=j.selected_line;G&&(W(G.moves),S(G.orientation))},select_playlist(y){s(y)},create_line:async function(y,S,W){let G=i(),pe=await t.create_line(G,y,S,W);return pe.isErr||await pe.map(De=>{Lt(()=>{De._playlist_id===i()?j.playlist&&K("playlist","lines",j.playlist.lines.length,De):s(De._playlist_id),r(De._id)})}),pe},delete_line:async function(y){let S=await t.delete_line(y);return S.isErr||j.playlist&&(K("playlist","lines",j.playlist.lines.filter(W=>W._id!==y)),n()===y&&r(j.playlist.lines[0]?._id)),S},edit_line:async function(y,S,W,G){return(await t.edit_line(y,{name:S,orientation:W,moves:G})).map(De=>{j.playlist&&K("playlist","lines",Bs=>Bs._id===De._id,De)})},set_ordered_line_slots:async function(y){let S=await t.set_ordered_line_slots(y[0]._playlist_id,y.map(W=>W._id));return j.playlist&&Lt(()=>{y.forEach((W,G)=>{K("playlist","lines",pe=>pe._id===W._id,"slot",G)})}),S.map(()=>{})},add_line_to_playlist:async function(y,S){return(await t.add_line_to_playlist(y,S)).map(G=>{r(S),s(y),f(!0),p(!0),l(!0),h(!0)})},create_playlist:async function(y,S){let W=await t.create_playlist(y,S);return W.map(G=>{s(G._id),f(!0),p(!0),l(!0),h(!0)}),W},delete_playlist:async function(){let y=i();if(y===void 0)return A.err(new Error("No Playlist Selected"));let S=await t.delete_playlist(y);return S.map(W=>{s(void 0),f(!0),p(!0),l(!0),h(!0)}),S.map(()=>{})},edit_playlist:async function(y,S){let W=await t.edit_playlist(y,{name:S});return W.map(G=>{D(G),P(G),R(G),C(G),q(G)}),W.map(()=>{})},like_playlist:async function(y,S){let W=await t.like_playlist(y,S);return a(!0),j.playlist&&j.playlist.playlist._id===y&&K("playlist","playlist","nb_likes",G=>S?G+1:G-1),W.map(()=>{})},next_playlist_page:async function(y){await t.next_playlist_page(y),f(!0)},next_searched_lines_page:async function(y){await t.next_searched_lines_page(y),k(b())},next_searched_playlist_page:async function(y){await t.next_searched_lines_page(y),T(_())},set_search_lines_term:async function(y){await t.set_search_lines_term(y),T(!0),k(!0)},undo:async function(){await t.undo(),s(i()),l(!0),a(!0),f(!0),h(!0),p(!0),k(!1),T(!1)}}]}const Ja=e=>{let[t]=e.openings,[n,r]=x("white"),[i,s]=x(0);const[o,l]=Dr(()=>fi(t.selected_line?.moves.split(" ")??[])),c=$(()=>o()[i()]),a=$(()=>c()?.fen??Tr),u=$(()=>wa(a())),f=$(()=>o().map(O=>O.san)),d=$(()=>c()?.uci),h=$(()=>o().slice(0,i()+1)),w=$(()=>ya(o())),p=$(()=>ba(o())),b=O=>l(fi(O.split(" ")));let k={get orientation(){return n()},get cursor(){return i()},get fen(){return a()},get turn_color(){return u()},get san_moves(){return f()},get last_move_uci(){return d()},get export_PGN(){return w()},get export_UCI(){return p()}};const _=O=>{O<0?s(-1):o()[O]!==void 0&&s(O)};return[k,{flip(){r(ie(n()))},import_UCIs:b,set_orientation:r,add_uci_and_goto_it(O){Lt(()=>{let N=h(),Y=Rs(N,O);l([...N,Y]),s(o().length-1)})},goto_next_step(){_(i()+1)},goto_prev_step(){_(i()-1)},goto_first_step(){_(0)},goto_last_step(){_(o().length-1)},goto_set_cursor(O){_(O)},clear_steps(){l([]),s(0)},delete_after(){l(h())}}]},Ts=pr();function Ds(){return vn(Ts)}function me(){return Ds().openings}function eu(){return Ds().build}function tu(e){let t,n;const[r]=Bi({get openings(){return t},get build(){return n}});return t=Za(r),n=Ja(r),g(Ts.Provider,{value:r,get children(){return e.children}})}var nu=M("<div class=openings><div class=build><h3>Build</h3><div class=board-wrap><div class=board></div></div><div class=board-tools><a>Flip</a></div></div><div class=explore><h3>Explore</h3><div class=line-info-wrap></div><div class=replay-wrap><div class=replay-tools><a></a><a>Clear</a><a>Delete after</a></div></div><div class=error-info>&nbsp;</div><div class=tools><div class=action>"),ru=M("<span class=no-line>No Line Selected"),iu=M("<span class=no-line-to-save>Play an opening line to save it."),su=M("<div class=line-info><div class=playlist-info><span class=name></span>by<span class=author></span></div><span class=line>"),ou=M("<div class=playlist><h3>Playlist</h3><div class=filters><div class=tab>Mine</div><div class=tab>Liked</div><div class=tab>Global</div></div><div class=lists></div><div class=room></div><div class=info></div><div class=lines>"),lu=M("<div class=sortable-list-portal>"),cu=M("<div class=dropdown-menu-portal>"),au=M("<div class=modal-portal>"),uu=M("<span class=no-playlist>Please Select a Playlist"),Fr=M("<ul>"),fu=M("<li class=item-new><div class=icon>+</div><div class=title>Create New Playlist"),du=M("<li class=item><div class=title></div><div class=likes> </div><div class=nb> lines"),hu=M("<span class=no-lines>No Lines here. Let's add some lines."),pu=M("<div class=title>"),Is=M("<ul><li><div>Edit </div></li><li class=red>Delete "),gu=M("<div class=more>"),mu=M("<div class=a-line><span class=name></span><div class=more>"),wu=M("<div class=number2> woop woop!"),bu=M("<h3>Edit Line"),yu=M("<h3>Edit Playlist"),_u=M("<h3>Create New Playlist"),vu=M("<h2>Add To Playlist"),ku=M("<div class=close>"),Cu=M("<div class=add-to-playlist-modal-body><h3>Recent</h3><div class=recent></div><h3>All</h3><div class=all></div><div class=new-playlist-float>");const $u=()=>{let[e,{flip:t,add_uci_and_goto_it:n,goto_next_step:r,goto_prev_step:i,goto_set_cursor:s,clear_steps:o,delete_after:l}]=eu();const c=(E,H)=>{let F=E+H;{let D=xn(e.fen),P=D.turn;D.board.get(Rt(E)).role==="pawn"&&(H[1]==="8"&&P==="white"||H[1]==="1"&&P==="black")&&(F+="q")}n(F)},a=E=>{E<0?i():r()},[u,f]=x(!1),d=$(()=>u()?"Copied!":"Copy"),h=async()=>{await navigator.clipboard.writeText(e.export_PGN),f(!0),await new Promise(E=>setTimeout(E,1e3)),f(!1)};let w;const p=(E,H)=>{w=E},[b,k]=x(void 0),[_,T]=x("",{equals:!1}),O=E=>{k(E),setTimeout(()=>{k(void 0)},2e3)},[N,{create_line:Y}]=me(),re=async()=>{if(w===void 0||w.length<3){O("Opening Line Name must be at least 3 characters long.");return}let E=w,H=e.export_UCI;if(H.split(" ").length<3){O("You should play at least 3 moves.");return}await Y(E,H,e.orientation),T(""),w=""};return(()=>{var E=nu(),H=E.firstChild,F=H.firstChild,D=F.nextSibling,P=D.firstChild,R=D.nextSibling,C=R.firstChild,q=H.nextSibling,V=q.firstChild,J=V.nextSibling,ce=J.nextSibling,j=ce.firstChild,K=j.firstChild,ee=K.nextSibling,y=ee.nextSibling,S=ce.nextSibling;S.firstChild;var W=S.nextSibling,G=W.firstChild;return Oe(P,"wheel",{handleEvent:Ca(a),passive:!1}),v(P,g(ka,{get fen(){return e.fen},play_orig_key:c,get turn_color(){return e.turn_color},get movable_color(){return e.turn_color},get orientation(){return e.orientation},get last_move_uci(){return e.last_move_uci}})),Oe(C,"click",t,!0),v(J,g(ke,{get when(){return N.selected_line},get fallback(){return ru()},children:pe=>g(Pu,{get line(){return pe()},get playlist(){return N.playlist}})})),v(ce,g(Aa,{get fallback(){return iu()},get san_moves(){return e.san_moves},get cursor(){return e.cursor},on_set_cursor:s}),j),K.$$click=h,v(K,d),Oe(ee,"click",o,!0),Oe(y,"click",l,!0),v(S,g(Tn,{get error(){return b()}}),null),v(W,g(Nn,{get value(){return _()},size:30,on_keyup:p,placeholder:"Opening Line Name"}),G),v(G,g(Pa,{meet:!0,onClick:re,children:"Save"}),null),v(G,g(Qt,{close_on_click_outside:!0,get portal_selector(){return document.querySelector(".modal-portal")},children:({toggle:pe,set_hold_close_outside:De})=>g(Du,{toggle:pe,set_hold_close_outside:De})}),null),v(E,g(Eu,{}),null),E})()},Pu=e=>(()=>{var t=su(),n=t.firstChild,r=n.firstChild,i=r.nextSibling,s=i.nextSibling,o=n.nextSibling;return v(r,()=>e.playlist.playlist.name),v(s,()=>e.playlist.playlist.author??"You"),v(o,()=>e.line.name),t})(),Eu=()=>{let[e]=me();const t=$(()=>e.playlist),[n,r]=x("mine"),i=yi(n),s={mine:Ou,liked:Au,global:Su};return[(()=>{var o=ou(),l=o.firstChild,c=l.nextSibling,a=c.firstChild,u=a.nextSibling,f=u.nextSibling,d=c.nextSibling,h=d.nextSibling,w=h.nextSibling,p=w.nextSibling;return a.$$click=b=>r("mine"),u.$$click=b=>r("liked"),f.$$click=b=>r("global"),v(d,g(Eo,{get component(){return s[n()]}})),v(w,g(ke,{get when(){return t()},get fallback(){return uu()},children:b=>g(Ru,{get playlist(){return b().playlist}})})),v(p,g(ke,{get when(){return t()},children:b=>g(xu,{get lines(){return b().lines}})})),Z(b=>{var k=!!i("mine"),_=!!i("liked"),T=!!i("global");return k!==b.e&&a.classList.toggle("active",b.e=k),_!==b.t&&u.classList.toggle("active",b.t=_),T!==b.a&&f.classList.toggle("active",b.a=T),b},{e:void 0,t:void 0,a:void 0}),o})(),lu(),cu(),au()]},Su=()=>{let[e]=me();const t=$(()=>e.global_playlists?.list??[]);return(()=>{var n=Fr();return v(n,g(Gt,{get each(){return t()},children:r=>g(qr,{item:r})})),n})()},Au=()=>{let[e]=me();const t=$(()=>e.liked_playlists?.list);return(()=>{var n=Fr();return v(n,g(Gt,{get each(){return t()},children:r=>g(qr,{item:r})})),n})()},Ou=()=>{let[e]=me();const t=$(()=>e.mine_playlists?.list);return(()=>{var n=Fr();return v(n,g(Qt,{close_on_click_outside:!0,get portal_selector(){return document.querySelector(".modal-portal")},children:({open:r,toggle:i})=>[(()=>{var s=fu();return s.$$click=()=>i(!0),s})(),g(Fs,{open:r,toggle:i})]}),null),v(n,g(Gt,{get each(){return t()},children:r=>g(qr,{item:r})}),null),n})()},qr=e=>{const[t,{select_playlist:n}]=me(),r=$(()=>e.item),i=$(()=>t.playlist?.playlist._id===e.item._id);Ut(()=>{qs(i,s,"lists")});let s;return(()=>{var o=du(),l=o.firstChild,c=l.nextSibling,a=c.firstChild,u=c.nextSibling,f=u.firstChild;o.$$click=()=>n(e.item._id);var d=s;return typeof d=="function"?Le(d,o):s=o,v(l,()=>r().name),v(c,()=>r().nb_likes,a),v(c,g($e,{get icon(){return Pe.HeartFilled}}),null),v(u,()=>r().nb_lines,f),Z(()=>o.classList.toggle("active",!!i())),o})()},xu=e=>{let[,{set_ordered_line_slots:t}]=me();const n=$(()=>e.lines.slice(0).sort((r,i)=>r.slot-i.slot));return g(ke,{get when(){return n()},get fallback(){return hu()},children:r=>g(ja,{set_ordered:t,children:Lu,dragging:Mu,get portal_selector(){return document.querySelector(".sortable-list-portal")},get list(){return r()}})})},Ru=e=>{const[,{like_playlist:t,delete_playlist:n}]=me(),[r,i]=x(!1,{equals:!1});return[(()=>{var s=pu();return v(s,()=>e.playlist.name),s})(),(()=>{var s=gu();return v(s,g(Ha,{get nb_heart(){return e.playlist.nb_likes},get is_heart(){return e.playlist.have_liked},on_heart:o=>t(e.playlist._id,o)}),null),v(s,g(Ms,{get portal_selector(){return document.querySelector(".dropdown-menu-portal")},get button(){return g($e,{get icon(){return Pe.Gear}})},get children(){var o=Is(),l=o.firstChild,c=l.firstChild;c.firstChild;var a=l.nextSibling;return a.firstChild,c.$$click=()=>i(!0),v(c,g($e,{get icon(){return Pe.Gears}}),null),Oe(a,"click",n,!0),v(a,g($e,{get icon(){return Pe.Delete}}),null),o}}),null),v(s,g(Qt,{close_on_click_outside:!0,get open(){return r()},get portal_selector(){return document.querySelector(".modal-portal")},children:({open:o,toggle:l})=>g(Tu,{get playlist(){return e.playlist},toggle:l,open:o})}),null),s})()]},Lu=e=>{const[t,{select_line:n,delete_line:r}]=me(),[i,s]=x(!1,{equals:!1}),o=$(()=>t.selected_line===e);let l;Ut(()=>{qs(o,l,"sortable-list-wrap")});const c=()=>{n(e._id)};return(()=>{var a=mu(),u=a.firstChild,f=u.nextSibling;a.$$click=c;var d=l;return typeof d=="function"?Le(d,a):l=a,v(u,()=>e.name),v(f,g(Ms,{get portal_selector(){return document.querySelector(".dropdown-menu-portal")},get button(){return g($e,{get icon(){return Pe.Gear}})},get children(){var h=Is(),w=h.firstChild,p=w.firstChild;p.firstChild;var b=w.nextSibling;return b.firstChild,p.$$click=()=>s(!0),v(p,g($e,{get icon(){return Pe.Gears}}),null),b.$$click=()=>r(e._id),v(b,g($e,{get icon(){return Pe.Delete}}),null),h}})),v(a,g(Qt,{close_on_click_outside:!0,get open(){return i()},get portal_selector(){return document.querySelector(".modal-portal")},children:({open:h,toggle:w})=>g(Nu,{line:e,open:h,toggle:w})}),null),Z(()=>a.classList.toggle("active",!!o())),a})()},Mu=e=>(()=>{var t=wu(),n=t.firstChild;return v(t,()=>e.name,n),t})(),Nu=e=>{let[t,n]=x(void 0);const[,{edit_line:r}]=me();let[i,s]=x("");const o=(c,a)=>{s(c),a&&l()},l=()=>{if(i().length<3){n("Line Name must be at least 3 characters long.");return}n(void 0),r(e.line._id,i()),e.toggle(!1)};return fe(st(e.open,c=>{c||(n(void 0),s(""))})),g(Rn,{get children(){return[g(Ln,{get children(){return bu()}}),g(Mn,{get children(){return[g(Tn,{get error(){return t()}}),g(Nn,{get value(){return i()},placeholder:"Line Name",on_keyup:o})]}}),g(Ir,{get children(){return[g(it,{get action(){return xe.Cancel},onClick:()=>e.toggle(!1),children:"Cancel"}),g(it,{get action(){return xe.Ok},onClick:l,children:"Ok"})]}})]}})},Tu=e=>{let[t,n]=x(void 0);const[,{edit_playlist:r}]=me();let[i,s]=x("");const o=(c,a)=>{s(c),a&&l()},l=()=>{if(i().length<3){n("Playlist Name must be at least 3 characters long.");return}n(void 0),r(e.playlist._id,i()),e.toggle(!1)};return fe(st(e.open,c=>{c||(n(void 0),s(""))})),g(Rn,{get children(){return[g(Ln,{get children(){return yu()}}),g(Mn,{get children(){return[g(Tn,{get error(){return t()}}),g(Nn,{get value(){return i()},placeholder:"Playlist Name",on_keyup:o})]}}),g(Ir,{get children(){return[g(it,{get action(){return xe.Cancel},onClick:()=>e.toggle(!1),children:"Cancel"}),g(it,{get action(){return xe.Ok},onClick:l,children:"Ok"})]}})]}})},Fs=e=>{let[t,n]=x(void 0),[r,i]=x(!1),[,{create_playlist:s}]=me(),[o,l]=x("");const c=async(u,f)=>{l(u),f&&a()},a=async()=>{if(o().length<3){n("Playlist Name must be at least 3 characters long.");return}i(!0),n(void 0);let u=await s(o());u.isOk?e.toggle(!1):u.isErr&&n(u.error.message??"Something went wrong."),i(!1)};return fe(st(e.open,u=>{u||(n(void 0),i(!1),l(""))})),g(Rn,{get children(){return[g(Ln,{get children(){return _u()}}),g(Mn,{get children(){return[g(Nn,{get value(){return o()},placeholder:"Playlist Name",on_keyup:c}),g(Tn,{get error(){return t()}})]}}),g(Ir,{get children(){return[g(it,{get action(){return xe.Cancel},onClick:()=>e.toggle(!1),children:"Cancel"}),g(it,{get waiting(){return r()},get action(){return xe.Ok},onClick:()=>a(),children:"Create"})]}})]}})},Du=e=>{const t=n=>(fe(()=>{e.set_hold_close_outside(n.open())}),je(()=>{e.set_hold_close_outside(!1)}),[g(it,{get action(){return xe.Normal},onClick:()=>n.toggle(!0),children:"+ New Playlist"}),g(Fs,{get open(){return n.open},get toggle(){return n.toggle}})]);return g(Rn,{get children(){return[g(Ln,{get children(){return[vu(),(()=>{var n=ku();return n.$$click=()=>e.toggle(!1),v(n,g($e,{get icon(){return Pe.CrossX}})),n})()]}}),g(Mn,{get children(){var n=Cu(),r=n.firstChild,i=r.nextSibling,s=i.nextSibling,o=s.nextSibling,l=o.nextSibling;return v(l,g(Qt,{close_on_click_outside:!0,get portal_selector(){return document.querySelector(".modal-portal")},children:({open:c,toggle:a})=>g(t,{toggle:a,open:c})})),n}})]}})},qs=(e,t,n)=>{const r=()=>{let i=t.parentElement;for(;i!==void 0;){if(i?.classList.contains(n))return i;i=i?.parentElement}return i};fe(st(e,i=>{if(t!==void 0&&i){const a=r();if(!a)return;let u=a,f=t;var s=u.getBoundingClientRect(),o={height:u.clientHeight,width:u.clientWidth},l=f.getBoundingClientRect(),c=l.top>=s.top&&l.bottom<=s.top+o.height;c||a.scroll({top:t.offsetTop,behavior:"smooth"})}}))};Te(["click"]);var Iu=M("<div class=challenges><div class=skills><h3>Skills</h3></div><div class=boards><h3>Leaderboards");const Fu=()=>Iu();var qu=M("<div class=main-wrap>"),Bu=M("<small class=com>.com"),ju=M("<main class=main><h1></h1><p> Explore, Build, and Share opening lines.</p><p> Complete Challenges on a unique Skill Tree. </p><p> Compete on the Leaderboards. </p><p> Free, Open Source, No Ads, No Trackers.</p><p>For the  of Chess</p><section class=section-openings><h2>Openings</h2></section><section class=section-challenges><h2>Challenges"),Ku=M("<footer><!><!>"),zu=M("<p><small> to make your data publicly available."),Uu=M("<p>Welcome from Lichess, <!>! <small><a>Logout.");const Hu=kn(()=>Cn(()=>import("./MainLegal-DbPSbOIJ.js"),__vite__mapDeps([0,1]))),Wu=kn(()=>Cn(()=>import("./Main404-D3nc6tj9.js"),[])),Gu=kn(()=>Cn(()=>import("./MainAbout-DQHX5Iwq.js"),__vite__mapDeps([2,1]))),Vu=kn(()=>Cn(()=>import("./MainContact-Dq4fH2YA.js"),__vite__mapDeps([3,4,1])));function Xu(){return g(rl,{root:Qu,get children(){return[g(Ct,{path:"/",component:Yu}),g(Ct,{path:"/about",component:Gu}),g(Ct,{path:"/legal",component:Hu}),g(Ct,{path:"/contact",component:Vu}),g(Ct,{path:"*",component:Wu})]}})}function Qu(e){return(()=>{var t=qu();return v(t,g(tu,{get children(){return e.children}})),t})()}function Yu(){const[e,{profile_logout:t}]=me();return[(()=>{var n=ju(),r=n.firstChild,i=r.nextSibling,s=i.nextSibling,o=s.nextSibling,l=o.nextSibling,c=l.nextSibling,a=c.nextSibling;a.firstChild;var u=a.nextSibling;return u.firstChild,v(r,g(dt,{class:"title",href:"/",get children(){return["LineChess",Bu()]}})),v(n,g(ke,{get when(){return e.profile?.lichess_username},get fallback(){return(()=>{var f=zu(),d=f.firstChild,h=d.firstChild;return v(d,g(dt,{href:`${Ns}/auth/lichess`,children:"Login with Lichess"}),h),f})()},children:f=>(()=>{var d=Uu(),h=d.firstChild,w=h.nextSibling,p=w.nextSibling,b=p.nextSibling,k=b.firstChild;return v(d,f,w),Oe(k,"click",t,!0),d})()}),a),v(a,g($u,{}),null),v(u,g(Fu,{}),null),n})(),(()=>{var n=Ku(),r=n.firstChild,i=r.nextSibling,s=i.nextSibling,o=s.nextSibling;return o.nextSibling,v(n,g(dt,{href:"/",children:"LineChess.com"}),r),v(n,g(dt,{href:"/about",children:"About"}),i),v(n,g(dt,{href:"/legal",children:"Legal"}),o),v(n,g(dt,{href:"/contact",children:"Contact"}),null),n})()]}Te(["click"]);const Zu=document.getElementById("root");ho(()=>g(Xu,{}),Zu);export{dt as A,x as a,$ as b,g as c,Z as d,Te as e,v as i,M as t};
