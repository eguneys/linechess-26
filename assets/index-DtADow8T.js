const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/MainLegal-CHb4rmpJ.js","assets/MainLegal-CZOPaPYE.css","assets/MainAbout-y_45SMR-.js","assets/MainContact-B-K_AJCw.js","assets/MainContact-BM86F0VK.css"])))=>i.map(i=>d[i]);
(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))r(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(i){if(i.ep)return;i.ep=!0;const o=n(i);fetch(i.href,o)}})();const D={context:void 0,registry:void 0,effects:void 0,done:!1,getContextId(){return oi(this.context.count)},getNextContextId(){return oi(this.context.count++)}};function oi(e){const t=String(e),n=t.length-1;return D.context.id+(n?String.fromCharCode(96+n):"")+t}function Ge(e){D.context=e}const Ni=!1,Di=(e,t)=>e===t,xe=Symbol("solid-proxy"),Fi=typeof Proxy=="function",ar=Symbol("solid-track"),bn={equals:Di};let zt=null,Ui=Gi;const pe=1,Wt=2,qi={owned:null,cleanups:null,context:null,owner:null},Zn={};var G=null;let R=null,us=null,J=null,ue=null,oe=null,In=0;function ct(e,t){const n=J,r=G,i=e.length===0,o=t===void 0?r:t,s=i?qi:{owned:null,cleanups:null,context:o?o.context:null,owner:o},l=i?e:()=>e(()=>te(()=>Ye(s)));G=s,J=null;try{return ve(l,!0)}finally{J=n,G=r}}function q(e,t){t=t?Object.assign({},bn,t):bn;const n={value:e,observers:null,observerSlots:null,comparator:t.equals||void 0},r=i=>(typeof i=="function"&&(R&&R.running&&R.sources.has(n)?i=i(n.tValue):i=i(n.value)),Ki(n,i));return[zi.bind(n),r]}function si(e,t,n){const r=Tt(e,t,!0,pe);yt(r)}function re(e,t,n){const r=Tt(e,t,!1,pe);yt(r)}function ge(e,t,n){Ui=ys;const r=Tt(e,t,!1,pe),i=ft&&mt(ft);i&&(r.suspense=i),(!n||!n.render)&&(r.user=!0),oe?oe.push(r):yt(r)}function I(e,t,n){n=n?Object.assign({},bn,n):bn;const r=Tt(e,t,!0,0);return r.observers=null,r.observerSlots=null,r.comparator=n.equals||void 0,yt(r),zi.bind(r)}function fs(e){return e&&typeof e=="object"&&"then"in e}function ji(e,t,n){let r,i,o;typeof t=="function"?(r=e,i=t,o={}):(r=!0,i=e,o=t||{});let s=null,l=Zn,a=null,c=!1,u=!1,f="initialValue"in o,d=typeof r=="function"&&I(r);const p=new Set,[w,y]=(o.storage||q)(o.initialValue),[S,O]=q(void 0),[P,j]=q(void 0,{equals:!1}),[F,H]=q(f?"ready":"unresolved");D.context&&(a=D.getNextContextId(),o.ssrLoadFrom==="initial"?l=o.initialValue:D.load&&D.has(a)&&(l=D.load(a)));function Y(B,L,z,x){return s===B&&(s=null,x!==void 0&&(f=!0),(B===l||L===l)&&o.onHydrated&&queueMicrotask(()=>o.onHydrated(x,{value:L})),l=Zn,R&&B&&c?(R.promises.delete(B),c=!1,ve(()=>{R.running=!0,ie(L,z)},!1)):ie(L,z)),L}function ie(B,L){ve(()=>{L===void 0&&y(()=>B),H(L!==void 0?"errored":f?"ready":"unresolved"),O(L);for(const z of p.keys())z.decrement();p.clear()},!1)}function N(){const B=ft&&mt(ft),L=w(),z=S();if(z!==void 0&&!s)throw z;return J&&!J.user&&B&&si(()=>{P(),s&&(B.resolved&&R&&c?R.promises.add(s):p.has(B)||(B.increment(),p.add(B)))}),L}function Q(B=!0){if(B!==!1&&u)return;u=!1;const L=d?d():r;if(c=R&&R.running,L==null||L===!1){Y(s,te(w));return}R&&s&&R.promises.delete(s);let z;const x=l!==Zn?l:te(()=>{try{return i(L,{value:w(),refetching:B})}catch(h){z=h}});if(z!==void 0){Y(s,void 0,wn(z),L);return}else if(!fs(x))return Y(s,x,void 0,L),x;return s=x,"v"in x?(x.s===1?Y(s,x.v,void 0,L):Y(s,void 0,wn(x.v),L),x):(u=!0,queueMicrotask(()=>u=!1),ve(()=>{H(f?"refreshing":"pending"),j()},!1),x.then(h=>Y(x,h,void 0,L),h=>Y(x,void 0,wn(h),L)))}Object.defineProperties(N,{state:{get:()=>F()},error:{get:()=>S()},loading:{get(){const B=F();return B==="pending"||B==="refreshing"}},latest:{get(){if(!f)return N();const B=S();if(B&&!s)throw B;return w()}}});let ee=G;return d?si(()=>(ee=G,Q(!1))):Q(!1),[N,{refetch:B=>Nn(ee,()=>Q(B)),mutate:y}]}function Bi(e,t=Di,n){const r=new Map,i=Tt(o=>{const s=e();for(const[l,a]of r.entries())if(t(l,s)!==t(l,o))for(const c of a.values())c.state=pe,c.pure?ue.push(c):oe.push(c);return s},void 0,!0,pe);return yt(i),o=>{const s=J;if(s){let l;(l=r.get(o))?l.add(s):r.set(o,l=new Set([s])),Ne(()=>{l.delete(s),!l.size&&r.delete(o)})}return t(o,R&&R.running&&R.sources.has(i)?i.tValue:i.value)}}function Vt(e){return ve(e,!1)}function te(e){if(J===null)return e();const t=J;J=null;try{return e()}finally{J=t}}function gt(e,t,n){const r=Array.isArray(e);let i,o=n&&n.defer;return s=>{let l;if(r){l=Array(e.length);for(let c=0;c<e.length;c++)l[c]=e[c]()}else l=e();if(o)return o=!1,s;const a=te(()=>t(l,i,s));return i=l,a}}function ln(e){ge(()=>te(e))}function Ne(e){return G===null||(G.cleanups===null?G.cleanups=[e]:G.cleanups.push(e)),e}function ds(e,t){zt||(zt=Symbol("error")),G=Tt(void 0,void 0,!0),G.context={...G.context,[zt]:[t]},R&&R.running&&R.sources.add(G);try{return e()}catch(n){un(n)}finally{G=G.owner}}function cr(){return J}function Qt(){return G}function Nn(e,t){const n=G,r=J;G=e,J=null;try{return ve(t,!0)}catch(i){un(i)}finally{G=n,J=r}}function hs(e){if(R&&R.running)return e(),R.done;const t=J,n=G;return Promise.resolve().then(()=>{J=t,G=n;let r;return ft&&(r=R||(R={sources:new Set,effects:[],promises:new Set,disposed:new Set,queue:new Set,running:!0}),r.done||(r.done=new Promise(i=>r.resolve=i)),r.running=!0),ve(e,!1),J=G=null,r?r.done:void 0})}const[Tf,li]=q(!1);function ps(e){oe.push.apply(oe,e),e.length=0}function an(e,t){const n=Symbol("context");return{id:n,Provider:ws(n),defaultValue:e}}function mt(e){let t;return G&&G.context&&(t=G.context[e.id])!==void 0?t:e.defaultValue}function cn(e){const t=I(e),n=I(()=>ur(t()));return n.toArray=()=>{const r=n();return Array.isArray(r)?r:r!=null?[r]:[]},n}let ft;function gs(){return ft||(ft=an())}function zi(){const e=R&&R.running;if(this.sources&&(e?this.tState:this.state))if((e?this.tState:this.state)===pe)yt(this);else{const t=ue;ue=null,ve(()=>kn(this),!1),ue=t}if(J){const t=this.observers?this.observers.length:0;J.sources?(J.sources.push(this),J.sourceSlots.push(t)):(J.sources=[this],J.sourceSlots=[t]),this.observers?(this.observers.push(J),this.observerSlots.push(J.sources.length-1)):(this.observers=[J],this.observerSlots=[J.sources.length-1])}return e&&R.sources.has(this)?this.tValue:this.value}function Ki(e,t,n){let r=R&&R.running&&R.sources.has(e)?e.tValue:e.value;if(!e.comparator||!e.comparator(r,t)){if(R){const i=R.running;(i||!n&&R.sources.has(e))&&(R.sources.add(e),e.tValue=t),i||(e.value=t)}else e.value=t;e.observers&&e.observers.length&&ve(()=>{for(let i=0;i<e.observers.length;i+=1){const o=e.observers[i],s=R&&R.running;s&&R.disposed.has(o)||((s?!o.tState:!o.state)&&(o.pure?ue.push(o):oe.push(o),o.observers&&Hi(o)),s?o.tState=pe:o.state=pe)}if(ue.length>1e6)throw ue=[],new Error},!1)}return t}function yt(e){if(!e.fn)return;Ye(e);const t=In;ai(e,R&&R.running&&R.sources.has(e)?e.tValue:e.value,t),R&&!R.running&&R.sources.has(e)&&queueMicrotask(()=>{ve(()=>{R&&(R.running=!0),J=G=e,ai(e,e.tValue,t),J=G=null},!1)})}function ai(e,t,n){let r;const i=G,o=J;J=G=e;try{r=e.fn(t)}catch(s){return e.pure&&(R&&R.running?(e.tState=pe,e.tOwned&&e.tOwned.forEach(Ye),e.tOwned=void 0):(e.state=pe,e.owned&&e.owned.forEach(Ye),e.owned=null)),e.updatedAt=n+1,un(s)}finally{J=o,G=i}(!e.updatedAt||e.updatedAt<=n)&&(e.updatedAt!=null&&"observers"in e?Ki(e,r,!0):R&&R.running&&e.pure?(R.sources.add(e),e.tValue=r):e.value=r,e.updatedAt=n)}function Tt(e,t,n,r=pe,i){const o={fn:e,state:r,updatedAt:null,owned:null,sources:null,sourceSlots:null,cleanups:null,value:t,owner:G,context:G?G.context:null,pure:n};return R&&R.running&&(o.state=0,o.tState=r),G===null||G!==qi&&(R&&R.running&&G.pure?G.tOwned?G.tOwned.push(o):G.tOwned=[o]:G.owned?G.owned.push(o):G.owned=[o]),o}function vn(e){const t=R&&R.running;if((t?e.tState:e.state)===0)return;if((t?e.tState:e.state)===Wt)return kn(e);if(e.suspense&&te(e.suspense.inFallback))return e.suspense.effects.push(e);const n=[e];for(;(e=e.owner)&&(!e.updatedAt||e.updatedAt<In);){if(t&&R.disposed.has(e))return;(t?e.tState:e.state)&&n.push(e)}for(let r=n.length-1;r>=0;r--){if(e=n[r],t){let i=e,o=n[r+1];for(;(i=i.owner)&&i!==o;)if(R.disposed.has(i))return}if((t?e.tState:e.state)===pe)yt(e);else if((t?e.tState:e.state)===Wt){const i=ue;ue=null,ve(()=>kn(e,n[0]),!1),ue=i}}}function ve(e,t){if(ue)return e();let n=!1;t||(ue=[]),oe?n=!0:oe=[],In++;try{const r=e();return ms(n),r}catch(r){n||(oe=null),ue=null,un(r)}}function ms(e){if(ue&&(Gi(ue),ue=null),e)return;let t;if(R){if(!R.promises.size&&!R.queue.size){const r=R.sources,i=R.disposed;oe.push.apply(oe,R.effects),t=R.resolve;for(const o of oe)"tState"in o&&(o.state=o.tState),delete o.tState;R=null,ve(()=>{for(const o of i)Ye(o);for(const o of r){if(o.value=o.tValue,o.owned)for(let s=0,l=o.owned.length;s<l;s++)Ye(o.owned[s]);o.tOwned&&(o.owned=o.tOwned),delete o.tValue,delete o.tOwned,o.tState=0}li(!1)},!1)}else if(R.running){R.running=!1,R.effects.push.apply(R.effects,oe),oe=null,li(!0);return}}const n=oe;oe=null,n.length&&ve(()=>Ui(n),!1),t&&t()}function Gi(e){for(let t=0;t<e.length;t++)vn(e[t])}function ys(e){let t,n=0;for(t=0;t<e.length;t++){const r=e[t];r.user?e[n++]=r:vn(r)}if(D.context){if(D.count){D.effects||(D.effects=[]),D.effects.push(...e.slice(0,n));return}Ge()}for(D.effects&&(D.done||!D.count)&&(e=[...D.effects,...e],n+=D.effects.length,delete D.effects),t=0;t<n;t++)vn(e[t])}function kn(e,t){const n=R&&R.running;n?e.tState=0:e.state=0;for(let r=0;r<e.sources.length;r+=1){const i=e.sources[r];if(i.sources){const o=n?i.tState:i.state;o===pe?i!==t&&(!i.updatedAt||i.updatedAt<In)&&vn(i):o===Wt&&kn(i,t)}}}function Hi(e){const t=R&&R.running;for(let n=0;n<e.observers.length;n+=1){const r=e.observers[n];(t?!r.tState:!r.state)&&(t?r.tState=Wt:r.state=Wt,r.pure?ue.push(r):oe.push(r),r.observers&&Hi(r))}}function Ye(e){let t;if(e.sources)for(;e.sources.length;){const n=e.sources.pop(),r=e.sourceSlots.pop(),i=n.observers;if(i&&i.length){const o=i.pop(),s=n.observerSlots.pop();r<i.length&&(o.sourceSlots[s]=r,i[r]=o,n.observerSlots[r]=s)}}if(e.tOwned){for(t=e.tOwned.length-1;t>=0;t--)Ye(e.tOwned[t]);delete e.tOwned}if(R&&R.running&&e.pure)Wi(e,!0);else if(e.owned){for(t=e.owned.length-1;t>=0;t--)Ye(e.owned[t]);e.owned=null}if(e.cleanups){for(t=e.cleanups.length-1;t>=0;t--)e.cleanups[t]();e.cleanups=null}R&&R.running?e.tState=0:e.state=0}function Wi(e,t){if(t||(e.tState=0,R.disposed.add(e)),e.owned)for(let n=0;n<e.owned.length;n++)Wi(e.owned[n])}function wn(e){return e instanceof Error?e:new Error(typeof e=="string"?e:"Unknown error",{cause:e})}function ci(e,t,n){try{for(const r of t)r(e)}catch(r){un(r,n&&n.owner||null)}}function un(e,t=G){const n=zt&&t&&t.context&&t.context[zt],r=wn(e);if(!n)throw r;oe?oe.push({fn(){ci(r,n,t)},state:pe}):ci(r,n,t)}function ur(e){if(typeof e=="function"&&!e.length)return ur(e());if(Array.isArray(e)){const t=[];for(let n=0;n<e.length;n++){const r=ur(e[n]);Array.isArray(r)?t.push.apply(t,r):t.push(r)}return t}return e}function ws(e,t){return function(r){let i;return re(()=>i=te(()=>(G.context={...G.context,[e]:r.value},cn(()=>r.children))),void 0),i}}const _s=Symbol("fallback");function ui(e){for(let t=0;t<e.length;t++)e[t]()}function Vi(e,t,n={}){let r=[],i=[],o=[],s=0,l=t.length>1?[]:null;return Ne(()=>ui(o)),()=>{let a=e()||[],c=a.length,u,f;return a[ar],te(()=>{let p,w,y,S,O,P,j,F,H;if(c===0)s!==0&&(ui(o),o=[],r=[],i=[],s=0,l&&(l=[])),n.fallback&&(r=[_s],i[0]=ct(Y=>(o[0]=Y,n.fallback())),s=1);else if(s===0){for(i=new Array(c),f=0;f<c;f++)r[f]=a[f],i[f]=ct(d);s=c}else{for(y=new Array(c),S=new Array(c),l&&(O=new Array(c)),P=0,j=Math.min(s,c);P<j&&r[P]===a[P];P++);for(j=s-1,F=c-1;j>=P&&F>=P&&r[j]===a[F];j--,F--)y[F]=i[j],S[F]=o[j],l&&(O[F]=l[j]);for(p=new Map,w=new Array(F+1),f=F;f>=P;f--)H=a[f],u=p.get(H),w[f]=u===void 0?-1:u,p.set(H,f);for(u=P;u<=j;u++)H=r[u],f=p.get(H),f!==void 0&&f!==-1?(y[f]=i[u],S[f]=o[u],l&&(O[f]=l[u]),f=w[f],p.set(H,f)):o[u]();for(f=P;f<c;f++)f in y?(i[f]=y[f],o[f]=S[f],l&&(l[f]=O[f],l[f](f))):i[f]=ct(d);i=i.slice(0,s=c),r=a.slice(0)}return i});function d(p){if(o[f]=p,l){const[w,y]=q(f);return l[f]=y,t(a[f],w)}return t(a[f])}}}function _(e,t){return te(()=>e(t||{}))}function yn(){return!0}const fr={get(e,t,n){return t===xe?n:e.get(t)},has(e,t){return t===xe?!0:e.has(t)},set:yn,deleteProperty:yn,getOwnPropertyDescriptor(e,t){return{configurable:!0,enumerable:!0,get(){return e.get(t)},set:yn,deleteProperty:yn}},ownKeys(e){return e.keys()}};function er(e){return(e=typeof e=="function"?e():e)?e:{}}function bs(){for(let e=0,t=this.length;e<t;++e){const n=this[e]();if(n!==void 0)return n}}function We(...e){let t=!1;for(let s=0;s<e.length;s++){const l=e[s];t=t||!!l&&xe in l,e[s]=typeof l=="function"?(t=!0,I(l)):l}if(Fi&&t)return new Proxy({get(s){for(let l=e.length-1;l>=0;l--){const a=er(e[l])[s];if(a!==void 0)return a}},has(s){for(let l=e.length-1;l>=0;l--)if(s in er(e[l]))return!0;return!1},keys(){const s=[];for(let l=0;l<e.length;l++)s.push(...Object.keys(er(e[l])));return[...new Set(s)]}},fr);const n={},r=Object.create(null);for(let s=e.length-1;s>=0;s--){const l=e[s];if(!l)continue;const a=Object.getOwnPropertyNames(l);for(let c=a.length-1;c>=0;c--){const u=a[c];if(u==="__proto__"||u==="constructor")continue;const f=Object.getOwnPropertyDescriptor(l,u);if(!r[u])r[u]=f.get?{enumerable:!0,configurable:!0,get:bs.bind(n[u]=[f.get.bind(l)])}:f.value!==void 0?f:void 0;else{const d=n[u];d&&(f.get?d.push(f.get.bind(l)):f.value!==void 0&&d.push(()=>f.value))}}}const i={},o=Object.keys(r);for(let s=o.length-1;s>=0;s--){const l=o[s],a=r[l];a&&a.get?Object.defineProperty(i,l,a):i[l]=a?a.value:void 0}return i}function Tr(e,...t){const n=t.length;if(Fi&&xe in e){const i=n>1?t.flat():t[0],o=t.map(s=>new Proxy({get(l){return s.includes(l)?e[l]:void 0},has(l){return s.includes(l)&&l in e},keys(){return s.filter(l=>l in e)}},fr));return o.push(new Proxy({get(s){return i.includes(s)?void 0:e[s]},has(s){return i.includes(s)?!1:s in e},keys(){return Object.keys(e).filter(s=>!i.includes(s))}},fr)),o}const r=[];for(let i=0;i<=n;i++)r[i]={};for(const i of Object.getOwnPropertyNames(e)){let o=n;for(let a=0;a<t.length;a++)if(t[a].includes(i)){o=a;break}const s=Object.getOwnPropertyDescriptor(e,i);!s.get&&!s.set&&s.enumerable&&s.writable&&s.configurable?r[o][i]=s.value:Object.defineProperty(r[o],i,s)}return r}function Dn(e){let t,n;const r=i=>{const o=D.context;if(o){const[l,a]=q();D.count||(D.count=0),D.count++,(n||(n=e())).then(c=>{!D.done&&Ge(o),D.count--,a(()=>c.default),Ge()}),t=l}else if(!t){const[l]=ji(()=>(n||(n=e())).then(a=>a.default));t=l}let s;return I(()=>(s=t())?te(()=>{if(!o||D.done)return s(i);const l=D.context;Ge(o);const a=s(i);return Ge(l),a}):"")};return r.preload=()=>n||((n=e()).then(i=>t=()=>i.default),n),r}let vs=0;function ks(){return D.context?D.getNextContextId():`cl-${vs++}`}const Qi=e=>`Stale read from <${e}>.`;function fn(e){const t="fallback"in e&&{fallback:()=>e.fallback};return I(Vi(()=>e.each,e.children,t||void 0))}function ke(e){const t=e.keyed,n=I(()=>e.when,void 0,void 0),r=t?n:I(n,void 0,{equals:(i,o)=>!i==!o});return I(()=>{const i=r();if(i){const o=e.children;return typeof o=="function"&&o.length>0?te(()=>o(t?i:()=>{if(!te(r))throw Qi("Show");return n()})):o}return e.fallback},void 0,void 0)}function Es(e){const t=cn(()=>e.children),n=I(()=>{const r=t(),i=Array.isArray(r)?r:[r];let o=()=>{};for(let s=0;s<i.length;s++){const l=s,a=i[s],c=o,u=I(()=>c()?void 0:a.when,void 0,void 0),f=a.keyed?u:I(u,void 0,{equals:(d,p)=>!d==!p});o=()=>c()||(f()?[l,u,a]:void 0)}return o});return I(()=>{const r=n()();if(!r)return e.fallback;const[i,o,s]=r,l=s.children;return typeof l=="function"&&l.length>0?te(()=>l(s.keyed?o():()=>{if(te(n)()?.[0]!==i)throw Qi("Match");return o()})):l},void 0,void 0)}function fi(e){return e}const Cs=an();function Ss(e){let t=0,n,r,i,o,s;const[l,a]=q(!1),c=gs(),u={increment:()=>{++t===1&&a(!0)},decrement:()=>{--t===0&&a(!1)},inFallback:l,effects:[],resolved:!1},f=Qt();if(D.context&&D.load){const w=D.getContextId();let y=D.load(w);if(y&&(typeof y!="object"||y.s!==1?i=y:D.gather(w)),i&&i!=="$$f"){const[S,O]=q(void 0,{equals:!1});o=S,i.then(()=>{if(D.done)return O();D.gather(w),Ge(r),O(),Ge()},P=>{s=P,O()})}}const d=mt(Cs);d&&(n=d.register(u.inFallback));let p;return Ne(()=>p&&p()),_(c.Provider,{value:u,get children(){return I(()=>{if(s)throw s;if(r=D.context,o)return o(),o=void 0;r&&i==="$$f"&&Ge();const w=I(()=>e.children);return I(y=>{const S=u.inFallback(),{showContent:O=!0,showFallback:P=!0}=n?n():{};if((!S||i&&i!=="$$f")&&O)return u.resolved=!0,p&&p(),p=r=i=void 0,ps(u.effects),w();if(P)return p?y:ct(j=>(p=j,r&&(Ge({id:r.id+"F",count:0}),r=void 0),e.fallback),f)})})}})}const As=["allowfullscreen","async","alpha","autofocus","autoplay","checked","controls","default","disabled","formnovalidate","hidden","indeterminate","inert","ismap","loop","multiple","muted","nomodule","novalidate","open","playsinline","readonly","required","reversed","seamless","selected","adauctionheaders","browsingtopics","credentialless","defaultchecked","defaultmuted","defaultselected","defer","disablepictureinpicture","disableremoteplayback","preservespitch","shadowrootclonable","shadowrootcustomelementregistry","shadowrootdelegatesfocus","shadowrootserializable","sharedstoragewritable"],Ps=new Set(["className","value","readOnly","noValidate","formNoValidate","isMap","noModule","playsInline","adAuctionHeaders","allowFullscreen","browsingTopics","defaultChecked","defaultMuted","defaultSelected","disablePictureInPicture","disableRemotePlayback","preservesPitch","shadowRootClonable","shadowRootCustomElementRegistry","shadowRootDelegatesFocus","shadowRootSerializable","sharedStorageWritable",...As]),$s=new Set(["innerHTML","textContent","innerText","children"]),Os=Object.assign(Object.create(null),{className:"class",htmlFor:"for"}),Ts=Object.assign(Object.create(null),{class:"className",novalidate:{$:"noValidate",FORM:1},formnovalidate:{$:"formNoValidate",BUTTON:1,INPUT:1},ismap:{$:"isMap",IMG:1},nomodule:{$:"noModule",SCRIPT:1},playsinline:{$:"playsInline",VIDEO:1},readonly:{$:"readOnly",INPUT:1,TEXTAREA:1},adauctionheaders:{$:"adAuctionHeaders",IFRAME:1},allowfullscreen:{$:"allowFullscreen",IFRAME:1},browsingtopics:{$:"browsingTopics",IMG:1},defaultchecked:{$:"defaultChecked",INPUT:1},defaultmuted:{$:"defaultMuted",AUDIO:1,VIDEO:1},defaultselected:{$:"defaultSelected",OPTION:1},disablepictureinpicture:{$:"disablePictureInPicture",VIDEO:1},disableremoteplayback:{$:"disableRemotePlayback",AUDIO:1,VIDEO:1},preservespitch:{$:"preservesPitch",AUDIO:1,VIDEO:1},shadowrootclonable:{$:"shadowRootClonable",TEMPLATE:1},shadowrootdelegatesfocus:{$:"shadowRootDelegatesFocus",TEMPLATE:1},shadowrootserializable:{$:"shadowRootSerializable",TEMPLATE:1},sharedstoragewritable:{$:"sharedStorageWritable",IFRAME:1,IMG:1}});function Rs(e,t){const n=Ts[e];return typeof n=="object"?n[t]?n.$:void 0:n}const xs=new Set(["beforeinput","click","dblclick","contextmenu","focusin","focusout","input","keydown","keyup","mousedown","mousemove","mouseout","mouseover","mouseup","pointerdown","pointermove","pointerout","pointerover","pointerup","touchend","touchmove","touchstart"]),Ls=new Set(["altGlyph","altGlyphDef","altGlyphItem","animate","animateColor","animateMotion","animateTransform","circle","clipPath","color-profile","cursor","defs","desc","ellipse","feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence","filter","font","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignObject","g","glyph","glyphRef","hkern","image","line","linearGradient","marker","mask","metadata","missing-glyph","mpath","path","pattern","polygon","polyline","radialGradient","rect","set","stop","svg","switch","symbol","text","textPath","tref","tspan","use","view","vkern"]),Ms={xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace"},Rt=e=>I(()=>e());function Is(e,t,n){let r=n.length,i=t.length,o=r,s=0,l=0,a=t[i-1].nextSibling,c=null;for(;s<i||l<o;){if(t[s]===n[l]){s++,l++;continue}for(;t[i-1]===n[o-1];)i--,o--;if(i===s){const u=o<r?l?n[l-1].nextSibling:n[o-l]:a;for(;l<o;)e.insertBefore(n[l++],u)}else if(o===l)for(;s<i;)(!c||!c.has(t[s]))&&t[s].remove(),s++;else if(t[s]===n[o-1]&&n[l]===t[i-1]){const u=t[--i].nextSibling;e.insertBefore(n[l++],t[s++].nextSibling),e.insertBefore(n[--o],u),t[i]=n[o]}else{if(!c){c=new Map;let f=l;for(;f<o;)c.set(n[f],f++)}const u=c.get(t[s]);if(u!=null)if(l<u&&u<o){let f=s,d=1,p;for(;++f<i&&f<o&&!((p=c.get(t[f]))==null||p!==u+d);)d++;if(d>u-l){const w=t[s];for(;l<u;)e.insertBefore(n[l++],w)}else e.replaceChild(n[l++],t[s++])}else s++;else t[s++].remove()}}}const di="_$DX_DELEGATE";function Ns(e,t,n,r={}){let i;return ct(o=>{i=o,t===document?e():M(t,e(),t.firstChild?null:void 0,n)},r.owner),()=>{i(),t.textContent=""}}function K(e,t,n,r){let i;const o=()=>{const l=document.createElement("template");return l.innerHTML=e,l.content.firstChild},s=()=>(i||(i=o())).cloneNode(!0);return s.cloneNode=s,s}function qe(e,t=window.document){const n=t[di]||(t[di]=new Set);for(let r=0,i=e.length;r<i;r++){const o=e[r];n.has(o)||(n.add(o),t.addEventListener(o,Ks))}}function Jt(e,t,n){_t(e)||(n==null?e.removeAttribute(t):e.setAttribute(t,n))}function Ds(e,t,n,r){_t(e)||(r==null?e.removeAttributeNS(t,n):e.setAttributeNS(t,n,r))}function Fs(e,t,n){_t(e)||(n?e.setAttribute(t,""):e.removeAttribute(t))}function Us(e,t){_t(e)||(t==null?e.removeAttribute("class"):e.className=t)}function Oe(e,t,n,r){if(r)Array.isArray(n)?(e[`$$${t}`]=n[0],e[`$$${t}Data`]=n[1]):e[`$$${t}`]=n;else if(Array.isArray(n)){const i=n[0];e.addEventListener(t,n[0]=o=>i.call(e,n[1],o))}else e.addEventListener(t,n,typeof n!="function"&&n)}function qs(e,t,n={}){const r=Object.keys(t||{}),i=Object.keys(n);let o,s;for(o=0,s=i.length;o<s;o++){const l=i[o];!l||l==="undefined"||t[l]||(hi(e,l,!1),delete n[l])}for(o=0,s=r.length;o<s;o++){const l=r[o],a=!!t[l];!l||l==="undefined"||n[l]===a||!a||(hi(e,l,!0),n[l]=a)}return n}function Ji(e,t,n){if(!t)return n?Jt(e,"style"):t;const r=e.style;if(typeof t=="string")return r.cssText=t;typeof n=="string"&&(r.cssText=n=void 0),n||(n={}),t||(t={});let i,o;for(o in n)t[o]==null&&r.removeProperty(o),delete n[o];for(o in t)i=t[o],i!==n[o]&&(r.setProperty(o,i),n[o]=i);return n}function wt(e,t={},n,r){const i={};return r||re(()=>i.children=Xt(e,t.children,i.children)),re(()=>typeof t.ref=="function"&&De(t.ref,e)),re(()=>js(e,t,n,!0,i,!0)),i}function De(e,t,n){return te(()=>e(t,n))}function M(e,t,n,r){if(n!==void 0&&!r&&(r=[]),typeof t!="function")return Xt(e,t,r,n);re(i=>Xt(e,t(),i,n),r)}function js(e,t,n,r,i={},o=!1){t||(t={});for(const s in i)if(!(s in t)){if(s==="children")continue;i[s]=pi(e,s,null,i[s],n,o,t)}for(const s in t){if(s==="children")continue;const l=t[s];i[s]=pi(e,s,l,i[s],n,o,t)}}function Bs(e){let t,n;return!_t()||!(t=D.registry.get(n=Gs()))?e():(D.completed&&D.completed.add(t),D.registry.delete(n),t)}function _t(e){return!!D.context&&!D.done&&(!e||e.isConnected)}function zs(e){return e.toLowerCase().replace(/-([a-z])/g,(t,n)=>n.toUpperCase())}function hi(e,t,n){const r=t.trim().split(/\s+/);for(let i=0,o=r.length;i<o;i++)e.classList.toggle(r[i],n)}function pi(e,t,n,r,i,o,s){let l,a,c,u,f;if(t==="style")return Ji(e,n,r);if(t==="classList")return qs(e,n,r);if(n===r)return r;if(t==="ref")o||n(e);else if(t.slice(0,3)==="on:"){const d=t.slice(3);r&&e.removeEventListener(d,r,typeof r!="function"&&r),n&&e.addEventListener(d,n,typeof n!="function"&&n)}else if(t.slice(0,10)==="oncapture:"){const d=t.slice(10);r&&e.removeEventListener(d,r,!0),n&&e.addEventListener(d,n,!0)}else if(t.slice(0,2)==="on"){const d=t.slice(2).toLowerCase(),p=xs.has(d);if(!p&&r){const w=Array.isArray(r)?r[0]:r;e.removeEventListener(d,w)}(p||n)&&(Oe(e,d,n,p),p&&qe([d]))}else if(t.slice(0,5)==="attr:")Jt(e,t.slice(5),n);else if(t.slice(0,5)==="bool:")Fs(e,t.slice(5),n);else if((f=t.slice(0,5)==="prop:")||(c=$s.has(t))||!i&&((u=Rs(t,e.tagName))||(a=Ps.has(t)))||(l=e.nodeName.includes("-")||"is"in s)){if(f)t=t.slice(5),a=!0;else if(_t(e))return n;t==="class"||t==="className"?Us(e,n):l&&!a&&!c?e[zs(t)]=n:e[u||t]=n}else{const d=i&&t.indexOf(":")>-1&&Ms[t.split(":")[0]];d?Ds(e,d,t,n):Jt(e,Os[t]||t,n)}return n}function Ks(e){if(D.registry&&D.events&&D.events.find(([a,c])=>c===e))return;let t=e.target;const n=`$$${e.type}`,r=e.target,i=e.currentTarget,o=a=>Object.defineProperty(e,"target",{configurable:!0,value:a}),s=()=>{const a=t[n];if(a&&!t.disabled){const c=t[`${n}Data`];if(c!==void 0?a.call(t,c,e):a.call(t,e),e.cancelBubble)return}return t.host&&typeof t.host!="string"&&!t.host._$host&&t.contains(e.target)&&o(t.host),!0},l=()=>{for(;s()&&(t=t._$host||t.parentNode||t.host););};if(Object.defineProperty(e,"currentTarget",{configurable:!0,get(){return t||document}}),D.registry&&!D.done&&(D.done=_$HY.done=!0),e.composedPath){const a=e.composedPath();o(a[0]);for(let c=0;c<a.length-2&&(t=a[c],!!s());c++){if(t._$host){t=t._$host,l();break}if(t.parentNode===i)break}}else l();o(r)}function Xt(e,t,n,r,i){const o=_t(e);if(o){!n&&(n=[...e.childNodes]);let a=[];for(let c=0;c<n.length;c++){const u=n[c];u.nodeType===8&&u.data.slice(0,2)==="!$"?u.remove():a.push(u)}n=a}for(;typeof n=="function";)n=n();if(t===n)return n;const s=typeof t,l=r!==void 0;if(e=l&&n[0]&&n[0].parentNode||e,s==="string"||s==="number"){if(o||s==="number"&&(t=t.toString(),t===n))return n;if(l){let a=n[0];a&&a.nodeType===3?a.data!==t&&(a.data=t):a=document.createTextNode(t),n=Et(e,n,r,a)}else n!==""&&typeof n=="string"?n=e.firstChild.data=t:n=e.textContent=t}else if(t==null||s==="boolean"){if(o)return n;n=Et(e,n,r)}else{if(s==="function")return re(()=>{let a=t();for(;typeof a=="function";)a=a();n=Xt(e,a,n,r)}),()=>n;if(Array.isArray(t)){const a=[],c=n&&Array.isArray(n);if(dr(a,t,n,i))return re(()=>n=Xt(e,a,n,r,!0)),()=>n;if(o){if(!a.length)return n;if(r===void 0)return n=[...e.childNodes];let u=a[0];if(u.parentNode!==e)return n;const f=[u];for(;(u=u.nextSibling)!==r;)f.push(u);return n=f}if(a.length===0){if(n=Et(e,n,r),l)return n}else c?n.length===0?gi(e,a,r):Is(e,n,a):(n&&Et(e),gi(e,a));n=a}else if(t.nodeType){if(o&&t.parentNode)return n=l?[t]:t;if(Array.isArray(n)){if(l)return n=Et(e,n,r,t);Et(e,n,null,t)}else n==null||n===""||!e.firstChild?e.appendChild(t):e.replaceChild(t,e.firstChild);n=t}}return n}function dr(e,t,n,r){let i=!1;for(let o=0,s=t.length;o<s;o++){let l=t[o],a=n&&n[e.length],c;if(!(l==null||l===!0||l===!1))if((c=typeof l)=="object"&&l.nodeType)e.push(l);else if(Array.isArray(l))i=dr(e,l,a)||i;else if(c==="function")if(r){for(;typeof l=="function";)l=l();i=dr(e,Array.isArray(l)?l:[l],Array.isArray(a)?a:[a])||i}else e.push(l),i=!0;else{const u=String(l);a&&a.nodeType===3&&a.data===u?e.push(a):e.push(document.createTextNode(u))}}return i}function gi(e,t,n=null){for(let r=0,i=t.length;r<i;r++)e.insertBefore(t[r],n)}function Et(e,t,n,r){if(n===void 0)return e.textContent="";const i=r||document.createTextNode("");if(t.length){let o=!1;for(let s=t.length-1;s>=0;s--){const l=t[s];if(i!==l){const a=l.parentNode===e;!o&&!s?a?e.replaceChild(i,l):e.insertBefore(i,n):a&&l.remove()}else o=!0}}else e.insertBefore(i,n);return[i]}function Gs(){return D.getNextContextId()}const Hs=!1,Ws="http://www.w3.org/2000/svg";function Xi(e,t=!1,n=void 0){return t?document.createElementNS(Ws,e):document.createElement(e,{is:n})}function Rr(e){const{useShadow:t}=e,n=document.createTextNode(""),r=()=>e.mount||document.body,i=Qt();let o,s=!!D.context;return ge(()=>{s&&(Qt().user=s=!1),o||(o=Nn(i,()=>I(()=>e.children)));const l=r();if(l instanceof HTMLHeadElement){const[a,c]=q(!1),u=()=>c(!0);ct(f=>M(l,()=>a()?f():o(),null)),Ne(u)}else{const a=Xi(e.isSVG?"g":"div",e.isSVG),c=t&&a.attachShadow?a.attachShadow({mode:"open"}):a;Object.defineProperty(a,"_$host",{get(){return n.parentNode},configurable:!0}),M(c,o),l.appendChild(a),e.ref&&e.ref(a),Ne(()=>l.removeChild(a))}},void 0,{render:!s}),n}function Vs(e,t){const n=I(e);return I(()=>{const r=n();switch(typeof r){case"function":return te(()=>r(t));case"string":const i=Ls.has(r),o=D.context?Bs():Xi(r,i,te(()=>t.is));return wt(o,t,i),o}})}function Qs(e){const[,t]=Tr(e,["component"]);return Vs(()=>e.component,t)}const Js="modulepreload",Xs=function(e){return"/"+e},mi={},Fn=function(t,n,r){let i=Promise.resolve();if(n&&n.length>0){let a=function(c){return Promise.all(c.map(u=>Promise.resolve(u).then(f=>({status:"fulfilled",value:f}),f=>({status:"rejected",reason:f}))))};document.getElementsByTagName("link");const s=document.querySelector("meta[property=csp-nonce]"),l=s?.nonce||s?.getAttribute("nonce");i=a(n.map(c=>{if(c=Xs(c),c in mi)return;mi[c]=!0;const u=c.endsWith(".css"),f=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${f}`))return;const d=document.createElement("link");if(d.rel=u?"stylesheet":Js,u||(d.as="script"),d.crossOrigin="",d.href=c,l&&d.setAttribute("nonce",l),document.head.appendChild(d),u)return new Promise((p,w)=>{d.addEventListener("load",p),d.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(s){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=s,window.dispatchEvent(l),!l.defaultPrevented)throw s}return i.then(s=>{for(const l of s||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})};function Yi(){let e=new Set;function t(i){return e.add(i),()=>e.delete(i)}let n=!1;function r(i,o){if(n)return!(n=!1);const s={to:i,options:o,defaultPrevented:!1,preventDefault:()=>s.defaultPrevented=!0};for(const l of e)l.listener({...s,from:l.location,retry:a=>{a&&(n=!0),l.navigate(i,{...o,resolve:!1})}});return!s.defaultPrevented}return{subscribe:t,confirm:r}}let hr;function xr(){(!window.history.state||window.history.state._depth==null)&&window.history.replaceState({...window.history.state,_depth:window.history.length-1},""),hr=window.history.state._depth}xr();function Ys(e){return{...e,_depth:window.history.state&&window.history.state._depth}}function Zs(e,t){let n=!1;return()=>{const r=hr;xr();const i=r==null?null:hr-r;if(n){n=!1;return}i&&t(i)?(n=!0,window.history.go(-i)):e()}}const el=/^(?:[a-z0-9]+:)?\/\//i,tl=/^\/+|(\/)\/+$/g,Zi="http://sr";function ut(e,t=!1){const n=e.replace(tl,"$1");return n?t||/^[?#]/.test(n)?n:"/"+n:""}function _n(e,t,n){if(el.test(t))return;const r=ut(e),i=n&&ut(n);let o="";return!i||t.startsWith("/")?o=r:i.toLowerCase().indexOf(r.toLowerCase())!==0?o=r+i:o=i,(o||"/")+ut(t,!o)}function nl(e,t){if(e==null)throw new Error(t);return e}function rl(e,t){return ut(e).replace(/\/*(\*.*)?$/g,"")+ut(t)}function eo(e){const t={};return e.searchParams.forEach((n,r)=>{r in t?Array.isArray(t[r])?t[r].push(n):t[r]=[t[r],n]:t[r]=n}),t}function il(e,t,n){const[r,i]=e.split("/*",2),o=r.split("/").filter(Boolean),s=o.length;return l=>{const a=l.split("/").filter(Boolean),c=a.length-s;if(c<0||c>0&&i===void 0&&!t)return null;const u={path:s?"":"/",params:{}},f=d=>n===void 0?void 0:n[d];for(let d=0;d<s;d++){const p=o[d],w=p[0]===":",y=w?a[d]:a[d].toLowerCase(),S=w?p.slice(1):p.toLowerCase();if(w&&tr(y,f(S)))u.params[S]=y;else if(w||!tr(y,S))return null;u.path+=`/${y}`}if(i){const d=c?a.slice(-c).join("/"):"";if(tr(d,f(i)))u.params[i]=d;else return null}return u}}function tr(e,t){const n=r=>r===e;return t===void 0?!0:typeof t=="string"?n(t):typeof t=="function"?t(e):Array.isArray(t)?t.some(n):t instanceof RegExp?t.test(e):!1}function ol(e){const[t,n]=e.pattern.split("/*",2),r=t.split("/").filter(Boolean);return r.reduce((i,o)=>i+(o.startsWith(":")?2:3),r.length-(n===void 0?0:1))}function to(e){const t=new Map,n=Qt();return new Proxy({},{get(r,i){return t.has(i)||Nn(n,()=>t.set(i,I(()=>e()[i]))),t.get(i)()},getOwnPropertyDescriptor(){return{enumerable:!0,configurable:!0}},ownKeys(){return Reflect.ownKeys(e())},has(r,i){return i in e()}})}function no(e){let t=/(\/?\:[^\/]+)\?/.exec(e);if(!t)return[e];let n=e.slice(0,t.index),r=e.slice(t.index+t[0].length);const i=[n,n+=t[1]];for(;t=/^(\/\:[^\/]+)\?/.exec(r);)i.push(n+=t[1]),r=r.slice(t[0].length);return no(r).reduce((o,s)=>[...o,...i.map(l=>l+s)],[])}const sl=100,ro=an(),Lr=an(),Mr=()=>nl(mt(ro),"<A> and 'use' router primitives can be only used inside a Route."),ll=()=>mt(Lr)||Mr().base,al=e=>{const t=ll();return I(()=>t.resolvePath(e()))},cl=e=>{const t=Mr();return I(()=>{const n=e();return n!==void 0?t.renderPath(n):n})},ul=()=>Mr().location;function fl(e,t=""){const{component:n,preload:r,load:i,children:o,info:s}=e,l=!o||Array.isArray(o)&&!o.length,a={key:e,component:n,preload:r||i,info:s};return io(e.path).reduce((c,u)=>{for(const f of no(u)){const d=rl(t,f);let p=l?d:d.split("/*",1)[0];p=p.split("/").map(w=>w.startsWith(":")||w.startsWith("*")?w:encodeURIComponent(w)).join("/"),c.push({...a,originalPath:u,pattern:p,matcher:il(p,!l,e.matchFilters)})}return c},[])}function dl(e,t=0){return{routes:e,score:ol(e[e.length-1])*1e4-t,matcher(n){const r=[];for(let i=e.length-1;i>=0;i--){const o=e[i],s=o.matcher(n);if(!s)return null;r.unshift({...s,route:o})}return r}}}function io(e){return Array.isArray(e)?e:[e]}function oo(e,t="",n=[],r=[]){const i=io(e);for(let o=0,s=i.length;o<s;o++){const l=i[o];if(l&&typeof l=="object"){l.hasOwnProperty("path")||(l.path="");const a=fl(l,t);for(const c of a){n.push(c);const u=Array.isArray(l.children)&&l.children.length===0;if(l.children&&!u)oo(l.children,c.pattern,n,r);else{const f=dl([...n],r.length);r.push(f)}n.pop()}}}return n.length?r:r.sort((o,s)=>s.score-o.score)}function nr(e,t){for(let n=0,r=e.length;n<r;n++){const i=e[n].matcher(t);if(i)return i}return[]}function hl(e,t,n){const r=new URL(Zi),i=I(u=>{const f=e();try{return new URL(f,r)}catch{return console.error(`Invalid path ${f}`),u}},r,{equals:(u,f)=>u.href===f.href}),o=I(()=>i().pathname),s=I(()=>i().search,!0),l=I(()=>i().hash),a=()=>"",c=gt(s,()=>eo(i()));return{get pathname(){return o()},get search(){return s()},get hash(){return l()},get state(){return t()},get key(){return a()},query:n?n(c):to(c)}}let st;function pl(){return st}function gl(e,t,n,r={}){const{signal:[i,o],utils:s={}}=e,l=s.parsePath||(x=>x),a=s.renderPath||(x=>x),c=s.beforeLeave||Yi(),u=_n("",r.base||"");if(u===void 0)throw new Error(`${u} is not a valid base path`);u&&!i().value&&o({value:u,replace:!0,scroll:!1});const[f,d]=q(!1);let p;const w=(x,h)=>{h.value===y()&&h.state===O()||(p===void 0&&d(!0),st=x,p=h,hs(()=>{p===h&&(S(p.value),P(p.state),H[1](g=>g.filter(v=>v.pending)))}).finally(()=>{p===h&&Vt(()=>{st=void 0,x==="navigate"&&L(p),d(!1),p=void 0})}))},[y,S]=q(i().value),[O,P]=q(i().state),j=hl(y,O,s.queryWrapper),F=[],H=q([]),Y=I(()=>typeof r.transformUrl=="function"?nr(t(),r.transformUrl(j.pathname)):nr(t(),j.pathname)),ie=()=>{const x=Y(),h={};for(let g=0;g<x.length;g++)Object.assign(h,x[g].params);return h},N=s.paramsWrapper?s.paramsWrapper(ie,t):to(ie),Q={pattern:u,path:()=>u,outlet:()=>null,resolvePath(x){return _n(u,x)}};return re(gt(i,x=>w("native",x),{defer:!0})),{base:Q,location:j,params:N,isRouting:f,renderPath:a,parsePath:l,navigatorFactory:B,matches:Y,beforeLeave:c,preloadRoute:z,singleFlight:r.singleFlight===void 0?!0:r.singleFlight,submissions:H};function ee(x,h,g){te(()=>{if(typeof h=="number"){h&&(s.go?s.go(h):console.warn("Router integration does not support relative routing"));return}const v=!h||h[0]==="?",{replace:b,resolve:A,scroll:$,state:m}={replace:!1,resolve:!v,scroll:!0,...g},C=A?x.resolvePath(h):_n(v&&j.pathname||"",h);if(C===void 0)throw new Error(`Path '${h}' is not a routable path`);if(F.length>=sl)throw new Error("Too many redirects");const k=y();(C!==k||m!==O())&&(Hs||c.confirm(C,g)&&(F.push({value:k,replace:b,scroll:$,state:O()}),w("navigate",{value:C,state:m})))})}function B(x){return x=x||mt(Lr)||Q,(h,g)=>ee(x,h,g)}function L(x){const h=F[0];h&&(o({...x,replace:h.replace,scroll:h.scroll}),F.length=0)}function z(x,h){const g=nr(t(),x.pathname),v=st;st="preload";for(let b in g){const{route:A,params:$}=g[b];A.component&&A.component.preload&&A.component.preload();const{preload:m}=A;h&&m&&Nn(n(),()=>m({params:$,location:{pathname:x.pathname,search:x.search,hash:x.hash,query:eo(x),state:null,key:""},intent:"preload"}))}st=v}}function ml(e,t,n,r){const{base:i,location:o,params:s}=e,{pattern:l,component:a,preload:c}=r().route,u=I(()=>r().path);a&&a.preload&&a.preload();const f=c?c({params:s,location:o,intent:st||"initial"}):void 0;return{parent:t,pattern:l,path:u,outlet:()=>a?_(a,{params:s,location:o,data:f,get children(){return n()}}):n(),resolvePath(p){return _n(i.path(),p,u())}}}const yl=e=>t=>{const{base:n}=t,r=cn(()=>t.children),i=I(()=>oo(r(),t.base||""));let o;const s=gl(e,i,()=>o,{base:n,singleFlight:t.singleFlight,transformUrl:t.transformUrl});return e.create&&e.create(s),_(ro.Provider,{value:s,get children(){return _(wl,{routerState:s,get root(){return t.root},get preload(){return t.rootPreload||t.rootLoad},get children(){return[Rt(()=>(o=Qt())&&null),_(_l,{routerState:s,get branches(){return i()}})]}})}})};function wl(e){const t=e.routerState.location,n=e.routerState.params,r=I(()=>e.preload&&te(()=>{e.preload({params:n,location:t,intent:pl()||"initial"})}));return _(ke,{get when(){return e.root},keyed:!0,get fallback(){return e.children},children:i=>_(i,{params:n,location:t,get data(){return r()},get children(){return e.children}})})}function _l(e){const t=[];let n;const r=I(gt(e.routerState.matches,(i,o,s)=>{let l=o&&i.length===o.length;const a=[];for(let c=0,u=i.length;c<u;c++){const f=o&&o[c],d=i[c];s&&f&&d.route.key===f.route.key?a[c]=s[c]:(l=!1,t[c]&&t[c](),ct(p=>{t[c]=p,a[c]=ml(e.routerState,a[c-1]||e.routerState.base,yi(()=>r()[c+1]),()=>{const w=e.routerState.matches();return w[c]??w[0]})}))}return t.splice(i.length).forEach(c=>c()),s&&l?s:(n=a[0],a)}));return yi(()=>r()&&n)()}const yi=e=>()=>_(ke,{get when(){return e()},keyed:!0,children:t=>_(Lr.Provider,{value:t,get children(){return t.outlet()}})}),Dt=e=>{const t=cn(()=>e.children);return We(e,{get children(){return t()}})};function bl([e,t],n,r){return[e,r?i=>t(r(i)):t]}function vl(e){let t=!1;const n=i=>typeof i=="string"?{value:i}:i,r=bl(q(n(e.get()),{equals:(i,o)=>i.value===o.value&&i.state===o.state}),void 0,i=>(!t&&e.set(i),D.registry&&!D.done&&(D.done=!0),i));return e.init&&Ne(e.init((i=e.get())=>{t=!0,r[1](n(i)),t=!1})),yl({signal:r,create:e.create,utils:e.utils})}function kl(e,t,n){return e.addEventListener(t,n),()=>e.removeEventListener(t,n)}function El(e,t){const n=e&&document.getElementById(e);n?n.scrollIntoView():t&&window.scrollTo(0,0)}const Cl=new Map;function Sl(e=!0,t=!1,n="/_server",r){return i=>{const o=i.base.path(),s=i.navigatorFactory(i.base);let l,a;function c(y){return y.namespaceURI==="http://www.w3.org/2000/svg"}function u(y){if(y.defaultPrevented||y.button!==0||y.metaKey||y.altKey||y.ctrlKey||y.shiftKey)return;const S=y.composedPath().find(Y=>Y instanceof Node&&Y.nodeName.toUpperCase()==="A");if(!S||t&&!S.hasAttribute("link"))return;const O=c(S),P=O?S.href.baseVal:S.href;if((O?S.target.baseVal:S.target)||!P&&!S.hasAttribute("state"))return;const F=(S.getAttribute("rel")||"").split(/\s+/);if(S.hasAttribute("download")||F&&F.includes("external"))return;const H=O?new URL(P,document.baseURI):new URL(P);if(!(H.origin!==window.location.origin||o&&H.pathname&&!H.pathname.toLowerCase().startsWith(o.toLowerCase())))return[S,H]}function f(y){const S=u(y);if(!S)return;const[O,P]=S,j=i.parsePath(P.pathname+P.search+P.hash),F=O.getAttribute("state");y.preventDefault(),s(j,{resolve:!1,replace:O.hasAttribute("replace"),scroll:!O.hasAttribute("noscroll"),state:F?JSON.parse(F):void 0})}function d(y){const S=u(y);if(!S)return;const[O,P]=S;r&&(P.pathname=r(P.pathname)),i.preloadRoute(P,O.getAttribute("preload")!=="false")}function p(y){clearTimeout(l);const S=u(y);if(!S)return a=null;const[O,P]=S;a!==O&&(r&&(P.pathname=r(P.pathname)),l=setTimeout(()=>{i.preloadRoute(P,O.getAttribute("preload")!=="false"),a=O},20))}function w(y){if(y.defaultPrevented)return;let S=y.submitter&&y.submitter.hasAttribute("formaction")?y.submitter.getAttribute("formaction"):y.target.getAttribute("action");if(!S)return;if(!S.startsWith("https://action/")){const P=new URL(S,Zi);if(S=i.parsePath(P.pathname+P.search),!S.startsWith(n))return}if(y.target.method.toUpperCase()!=="POST")throw new Error("Only POST forms are supported for Actions");const O=Cl.get(S);if(O){y.preventDefault();const P=new FormData(y.target,y.submitter);O.call({r:i,f:y.target},y.target.enctype==="multipart/form-data"?P:new URLSearchParams(P))}}qe(["click","submit"]),document.addEventListener("click",f),e&&(document.addEventListener("mousemove",p,{passive:!0}),document.addEventListener("focusin",d,{passive:!0}),document.addEventListener("touchstart",d,{passive:!0})),document.addEventListener("submit",w),Ne(()=>{document.removeEventListener("click",f),e&&(document.removeEventListener("mousemove",p),document.removeEventListener("focusin",d),document.removeEventListener("touchstart",d)),document.removeEventListener("submit",w)})}}function Al(e){const t=()=>{const r=window.location.pathname.replace(/^\/+/,"/")+window.location.search,i=window.history.state&&window.history.state._depth&&Object.keys(window.history.state).length===1?void 0:window.history.state;return{value:r+window.location.hash,state:i}},n=Yi();return vl({get:t,set({value:r,replace:i,scroll:o,state:s}){i?window.history.replaceState(Ys(s),"",r):window.history.pushState(s,"",r),El(decodeURIComponent(window.location.hash.slice(1)),o),xr()},init:r=>kl(window,"popstate",Zs(r,i=>{if(i)return!n.confirm(i);{const o=t();return!n.confirm(o.value,{state:o.state})}})),create:Sl(e.preload,e.explicitLinks,e.actionBase,e.transformUrl),utils:{go:r=>window.history.go(r),beforeLeave:n}})(e)}var Pl=K("<a>");function Ft(e){e=We({inactiveClass:"inactive",activeClass:"active"},e);const[,t]=Tr(e,["href","state","class","activeClass","inactiveClass","end"]),n=al(()=>e.href),r=cl(n),i=ul(),o=I(()=>{const s=n();if(s===void 0)return[!1,!1];const l=ut(s.split(/[?#]/,1)[0]).toLowerCase(),a=decodeURI(ut(i.pathname).toLowerCase());return[e.end?l===a:a.startsWith(l+"/")||a===l,l===a]});return(()=>{var s=Pl();return wt(s,We(t,{get href(){return r()||e.href},get state(){return JSON.stringify(e.state)},get classList(){return{...e.class&&{[e.class]:!0},[e.inactiveClass]:!o()[0],[e.activeClass]:o()[0],...t.classList}},link:"",get"aria-current"(){return o()[1]?"page":void 0}}),!1,!1),s})()}const pr=Symbol("store-raw"),Pt=Symbol("store-node"),Ke=Symbol("store-has"),so=Symbol("store-self");function lo(e){let t=e[xe];if(!t&&(Object.defineProperty(e,xe,{value:t=new Proxy(e,Tl)}),!Array.isArray(e))){const n=Object.keys(e),r=Object.getOwnPropertyDescriptors(e);for(let i=0,o=n.length;i<o;i++){const s=n[i];r[s].get&&Object.defineProperty(e,s,{enumerable:r[s].enumerable,get:r[s].get.bind(t)})}}return t}function Ze(e){let t;return e!=null&&typeof e=="object"&&(e[xe]||!(t=Object.getPrototypeOf(e))||t===Object.prototype||Array.isArray(e))}function Ot(e,t=new Set){let n,r,i,o;if(n=e!=null&&e[pr])return n;if(!Ze(e)||t.has(e))return e;if(Array.isArray(e)){Object.isFrozen(e)?e=e.slice(0):t.add(e);for(let s=0,l=e.length;s<l;s++)i=e[s],(r=Ot(i,t))!==i&&(e[s]=r)}else{Object.isFrozen(e)?e=Object.assign({},e):t.add(e);const s=Object.keys(e),l=Object.getOwnPropertyDescriptors(e);for(let a=0,c=s.length;a<c;a++)o=s[a],!l[o].get&&(i=e[o],(r=Ot(i,t))!==i&&(e[o]=r))}return e}function En(e,t){let n=e[t];return n||Object.defineProperty(e,t,{value:n=Object.create(null)}),n}function Yt(e,t,n){if(e[t])return e[t];const[r,i]=q(n,{equals:!1,internal:!0});return r.$=i,e[t]=r}function $l(e,t){const n=Reflect.getOwnPropertyDescriptor(e,t);return!n||n.get||!n.configurable||t===xe||t===Pt||(delete n.value,delete n.writable,n.get=()=>e[xe][t]),n}function ao(e){cr()&&Yt(En(e,Pt),so)()}function Ol(e){return ao(e),Reflect.ownKeys(e)}const Tl={get(e,t,n){if(t===pr)return e;if(t===xe)return n;if(t===ar)return ao(e),n;const r=En(e,Pt),i=r[t];let o=i?i():e[t];if(t===Pt||t===Ke||t==="__proto__")return o;if(!i){const s=Object.getOwnPropertyDescriptor(e,t);cr()&&(typeof o!="function"||e.hasOwnProperty(t))&&!(s&&s.get)&&(o=Yt(r,t,o)())}return Ze(o)?lo(o):o},has(e,t){return t===pr||t===xe||t===ar||t===Pt||t===Ke||t==="__proto__"?!0:(cr()&&Yt(En(e,Ke),t)(),t in e)},set(){return!0},deleteProperty(){return!0},ownKeys:Ol,getOwnPropertyDescriptor:$l};function Se(e,t,n,r=!1){if(!r&&e[t]===n)return;const i=e[t],o=e.length;n===void 0?(delete e[t],e[Ke]&&e[Ke][t]&&i!==void 0&&e[Ke][t].$()):(e[t]=n,e[Ke]&&e[Ke][t]&&i===void 0&&e[Ke][t].$());let s=En(e,Pt),l;if((l=Yt(s,t,i))&&l.$(()=>n),Array.isArray(e)&&e.length!==o){for(let a=e.length;a<o;a++)(l=s[a])&&l.$();(l=Yt(s,"length",o))&&l.$(e.length)}(l=s[so])&&l.$()}function co(e,t){const n=Object.keys(t);for(let r=0;r<n.length;r+=1){const i=n[r];Se(e,i,t[i])}}function Rl(e,t){if(typeof t=="function"&&(t=t(e)),t=Ot(t),Array.isArray(t)){if(e===t)return;let n=0,r=t.length;for(;n<r;n++){const i=t[n];e[n]!==i&&Se(e,n,i)}Se(e,"length",r)}else co(e,t)}function Bt(e,t,n=[]){let r,i=e;if(t.length>1){r=t.shift();const s=typeof r,l=Array.isArray(e);if(Array.isArray(r)){for(let a=0;a<r.length;a++)Bt(e,[r[a]].concat(t),n);return}else if(l&&s==="function"){for(let a=0;a<e.length;a++)r(e[a],a)&&Bt(e,[a].concat(t),n);return}else if(l&&s==="object"){const{from:a=0,to:c=e.length-1,by:u=1}=r;for(let f=a;f<=c;f+=u)Bt(e,[f].concat(t),n);return}else if(t.length>1){Bt(e[r],t,[r].concat(n));return}i=e[r],n=[r].concat(n)}let o=t[0];typeof o=="function"&&(o=o(i,n),o===i)||r===void 0&&o==null||(o=Ot(o),r===void 0||Ze(i)&&Ze(o)&&!Array.isArray(o)?co(i,o):Se(e,r,o))}function Ir(...[e,t]){const n=Ot(e||{}),r=Array.isArray(n),i=lo(n);function o(...s){Vt(()=>{r&&s.length===1?Rl(n,s[0]):Bt(n,s)})}return[i,o]}const gr=Symbol("store-root");function St(e,t,n,r,i){const o=t[n];if(e===o)return;const s=Array.isArray(e);if(n!==gr&&(!Ze(e)||!Ze(o)||s!==Array.isArray(o)||i&&e[i]!==o[i])){Se(t,n,e);return}if(s){if(e.length&&o.length&&(!r||i&&e[0]&&e[0][i]!=null)){let c,u,f,d,p,w,y,S;for(f=0,d=Math.min(o.length,e.length);f<d&&(o[f]===e[f]||i&&o[f]&&e[f]&&o[f][i]&&o[f][i]===e[f][i]);f++)St(e[f],o,f,r,i);const O=new Array(e.length),P=new Map;for(d=o.length-1,p=e.length-1;d>=f&&p>=f&&(o[d]===e[p]||i&&o[d]&&e[p]&&o[d][i]&&o[d][i]===e[p][i]);d--,p--)O[p]=o[d];if(f>p||f>d){for(u=f;u<=p;u++)Se(o,u,e[u]);for(;u<e.length;u++)Se(o,u,O[u]),St(e[u],o,u,r,i);o.length>e.length&&Se(o,"length",e.length);return}for(y=new Array(p+1),u=p;u>=f;u--)w=e[u],S=i&&w?w[i]:w,c=P.get(S),y[u]=c===void 0?-1:c,P.set(S,u);for(c=f;c<=d;c++)w=o[c],S=i&&w?w[i]:w,u=P.get(S),u!==void 0&&u!==-1&&(O[u]=o[c],u=y[u],P.set(S,u));for(u=f;u<e.length;u++)u in O?(Se(o,u,O[u]),St(e[u],o,u,r,i)):Se(o,u,e[u])}else for(let c=0,u=e.length;c<u;c++)St(e[c],o,c,r,i);o.length>e.length&&Se(o,"length",e.length);return}const l=Object.keys(e);for(let c=0,u=l.length;c<u;c++)St(e[l[c]],o,l[c],r,i);const a=Object.keys(o);for(let c=0,u=a.length;c<u;c++)e[a[c]]===void 0&&Se(o,a[c],void 0)}function xl(e,t={}){const{merge:n,key:r="id"}=t,i=Ot(e);return o=>{if(!Ze(o)||!Ze(i))return i;const s=St(i,{[gr]:o},gr,n,r);return s===void 0?o:s}}function ze(e,t){let n,r=()=>!n||n.state==="unresolved"?void 0:n.latest;[n]=ji(()=>Ll(e,ds(()=>te(r),()=>{})),o=>o);const i=(()=>n());return Object.defineProperty(i,"latest",{get(){return n.latest}}),i}class Ce{static all(){return new Ce}static allSettled(){return new Ce}static any(){return new Ce}static race(){return new Ce}static reject(){return new Ce}static resolve(){return new Ce}catch(){return new Ce}then(){return new Ce}finally(){return new Ce}}function Ll(e,t){if(!D.context)return e(t);const n=fetch,r=Promise;try{return window.fetch=()=>new Ce,Promise=Ce,e(t)}finally{window.fetch=n,Promise=r}}const Ml=["white","black"],Cn=["a","b","c","d","e","f","g","h"],Sn=["1","2","3","4","5","6","7","8"],Il=[...Sn].reverse(),Un=Cn.flatMap(e=>Sn.map(t=>e+t)),Fe=e=>e.every(t=>t>=0&&t<=7)?Un[8*e[0]+e[1]]:void 0,it=e=>Fe(e),X=e=>[e.charCodeAt(0)-97,e.charCodeAt(1)-49],uo=Un.map(X),Nl=Un.map((e,t)=>({key:e,pos:uo[t]}));function fo(e){let t;const n=()=>(t===void 0&&(t=e()),t);return n.clear=()=>{t=void 0},n}const Dl=()=>{let e;return{start(){e=performance.now()},cancel(){e=void 0},stop(){if(!e)return 0;const t=performance.now()-e;return e=void 0,t}}},qn=e=>e==="white"?"black":"white",Zt=(e,t)=>(e[0]-t[0])**2+(e[1]-t[1])**2,An=(e,t)=>e.role===t.role&&e.color===t.color,Fl=(e,t)=>e[0]===t[0]&&e[1]===t[1],dn=e=>(t,n)=>[(n?t[0]:7-t[0])*e.width/8,(n?7-t[1]:t[1])*e.height/8],Le=(e,t)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px)`},ho=(e,t,n=1)=>{e.style.transform=`translate(${t[0]}px,${t[1]}px) scale(${n})`},Nr=(e,t)=>{e.style.visibility=t?"visible":"hidden"},bt=e=>{if(e.clientX||e.clientX===0)return[e.clientX,e.clientY];if(e.targetTouches?.[0])return[e.targetTouches[0].clientX,e.targetTouches[0].clientY]},Ul=fo(()=>!("ontouchstart"in window)&&["macintosh","firefox"].every(e=>navigator.userAgent.toLowerCase().includes(e))),po=e=>e.button===2&&!(e.ctrlKey&&Ul()),He=(e,t)=>{const n=document.createElement(e);return t&&(n.className=t),n};function go(e,t,n){const r=X(e);return t||(r[0]=7-r[0],r[1]=7-r[1]),[n.left+n.width*r[0]/8+n.width/16,n.top+n.height*(7-r[1])/8+n.height/16]}const Ue=(e,t)=>Math.abs(e-t),Dr=(e,t,n,r)=>Ue(e,n)*Ue(t,r)===2,Fr=(e,t,n,r)=>e===n!=(t===r),Ur=(e,t,n,r)=>Ue(e,n)===Ue(t,r)&&e!==n,mo=(e,t,n,r)=>Fr(e,t,n,r)||Ur(e,t,n,r),yo=(e,t,n,r)=>Math.max(Ue(e,n),Ue(t,r))===1,wo=(e,t,n,r,i)=>Ue(e,n)===1&&r===t+(i?1:-1),_o=(e,t,n,r,i)=>{const o=i?1:-1;return e===n&&(r===t+o||r===t+2*o&&(i?t<=1:t>=6))},jn=(e,t,n,r)=>{const i=n-e,o=r-t;if(i&&o&&Math.abs(i)!==Math.abs(o))return[];const s=Math.sign(i),l=Math.sign(o),a=[];let c=e+s,u=t+l;for(;c!==n||u!==r;)a.push([c,u]),c+=s,u+=l;return a.map(Fe).filter(f=>f!==void 0)},ql=e=>{const t=X(e),n=[];return t[0]>0&&n.push([t[0]-1,t[1]]),t[0]<7&&n.push([t[0]+1,t[1]]),n.map(Fe).filter(r=>r!==void 0)},Pn=(e,t)=>{const n=X(e);return n[1]+=t,Fe(n)},xt=e=>e.friendlies.has(e.dest.key),jl=e=>e.enemies.has(e.dest.key),bo=(e,t,n)=>jn(...e,...t).some(r=>n.has(r)),vo=(e,t,n)=>{const r=n.enemies.get(e);if(r?.role!=="pawn")return!1;const i=r.color==="white"?1:-1,o=X(e),s=X(t);return _o(...o,...s,r.color==="white")&&!bo(o,[s[0],s[1]+i],n.allPieces)},Bl=(e,t,n)=>{const r=n.enemies.get(e);return r?.role==="pawn"&&wo(...X(e),...X(t),r.color==="white")&&(n.friendlies.has(t)||zn(Pn(t,r.color==="white"?-1:1),n.friendlies,n.enemies,n.lastMove))},zl=e=>[...e.enemies.keys()].some(t=>vo(t,e.dest.key,e)),mr=(e,t)=>{const n=e.dest.pos;return[...e.enemies].some(([r,i])=>{const o=X(r);return!t?.includes(i.role)&&(i.role==="pawn"&&wo(...o,...n,i.color==="white")||i.role==="knight"&&Dr(...o,...n)||i.role==="bishop"&&Ur(...o,...n)||i.role==="rook"&&Fr(...o,...n)||i.role==="queen"&&mo(...o,...n)||i.role==="king"&&yo(...o,...n))&&(!["bishop","rook","queen"].includes(i.role)||!bo(o,n,e.allPieces))})},Bn=e=>xt(e)&&(zn(e.dest.key,e.friendlies,e.enemies,e.lastMove)||mr(e)),zn=(e,t,n,r)=>{if(!e||r&&e!==r[1])return!1;const i=X(e),o=t.get(e);return o?.role==="pawn"&&i[1]===(o.color==="white"?3:4)&&(!r||Ue(X(r[0])[1],i[1])===2)&&[1,-1].some(s=>{const l=Fe([i[0]+s,i[1]]);return!!l&&n.get(l)?.role==="pawn"})},Kl=(e,t)=>{if(e.unrestrictedPremoves)return!0;const n=jn(...e.orig.pos,...e.dest.pos);t&&n.push(e.dest.key);const r=n.filter(s=>e.friendlies.has(s));if(!r.length)return!0;const i=r[0],o=Pn(i,e.color==="white"?-1:1);return r.length===1&&zn(i,e.friendlies,e.enemies,e.lastMove)&&!!o&&!n.includes(o)},Gl=(e,t)=>{if(e.unrestrictedPremoves)return!0;const n=jn(...e.orig.pos,...e.dest.pos);t&&n.push(e.dest.key);const r=n.filter(u=>e.enemies.has(u));if(r.length>1)return!1;if(!r.length)return!0;const i=r[0],o=e.enemies.get(i);if(!o||o.role!=="pawn")return!0;const s=o.color==="white"?1:-1,l=Pn(i,s),a=l?[...ql(l).filter(u=>Bl(i,u,e)),...[l,Pn(l,s)].filter(u=>!!u).filter(u=>vo(i,u,e))]:[],c=[...n,e.orig.key];return a.some(u=>!c.includes(u))},qr=(e,t)=>Kl(e,t)&&Gl(e,t),Hl=e=>{const t=e.color==="white"?1:-1;return Ue(e.orig.pos[0],e.dest.pos[0])>1?!1:Ue(e.orig.pos[0],e.dest.pos[0])?e.dest.pos[1]!==e.orig.pos[1]+t?!1:e.unrestrictedPremoves||jl(e)?!0:xt(e)?mr(e):zl(e)||zn(Fe([e.dest.pos[0],e.dest.pos[1]+t]),e.friendlies,e.enemies,e.lastMove)||mr(e,["pawn"]):_o(...e.orig.pos,...e.dest.pos,e.color==="white")&&qr(e,!0)},Wl=e=>Dr(...e.orig.pos,...e.dest.pos)&&(e.unrestrictedPremoves||!xt(e)||Bn(e)),ko=e=>Ur(...e.orig.pos,...e.dest.pos)&&qr(e,!1)&&(e.unrestrictedPremoves||!xt(e)||Bn(e)),Eo=e=>Fr(...e.orig.pos,...e.dest.pos)&&qr(e,!1)&&(e.unrestrictedPremoves||!xt(e)||Bn(e)),Vl=e=>ko(e)||Eo(e),Ql=e=>yo(...e.orig.pos,...e.dest.pos)&&(e.unrestrictedPremoves||!xt(e)||Bn(e))||e.canCastle&&e.orig.pos[1]===e.dest.pos[1]&&e.orig.pos[1]===(e.color==="white"?0:7)&&(e.orig.pos[0]===4&&(e.dest.pos[0]===2&&e.rookFilesFriendlies.includes(0)||e.dest.pos[0]===6&&e.rookFilesFriendlies.includes(7))||e.rookFilesFriendlies.includes(e.dest.pos[0]))&&(e.unrestrictedPremoves||jn(...e.orig.pos,e.dest.pos[0]>e.orig.pos[0]?7:1,e.dest.pos[1]).map(t=>e.allPieces.get(t)).every(t=>!t||An(t,{role:"rook",color:e.color}))),Jl={pawn:Hl,knight:Wl,bishop:ko,rook:Eo,queen:Vl,king:Ql};function Co(e,t){const n=e.pieces,r=e.premovable.castle,i=!!e.premovable.unrestrictedPremoves,o=n.get(t);if(!o||o.color===e.turnColor)return[];const s=o.color,l=new Map([...n].filter(([d,p])=>p.color===s)),a=new Map([...n].filter(([d,p])=>p.color===qn(s))),c={key:t,pos:X(t)},u=d=>Jl[o.role](d)&&e.premovable.additionalPremoveRequirements(d),f={orig:c,role:o.role,allPieces:n,friendlies:l,enemies:a,unrestrictedPremoves:i,color:s,canCastle:r,rookFilesFriendlies:Array.from(n).filter(([d,p])=>d[1]===(s==="white"?"1":"8")&&p.color===s&&p.role==="rook").map(([d])=>X(d)[0]),lastMove:e.lastMove};return Nl.filter(d=>u({...f,dest:d})).map(d=>d.key)}function me(e,...t){e&&setTimeout(()=>e(...t),1)}function Xl(e){e.orientation=qn(e.orientation),e.animation.current=e.draggable.current=e.selected=void 0}function Yl(e,t){for(const[n,r]of t)r?e.pieces.set(n,r):e.pieces.delete(n)}function Zl(e,t){if(e.check=void 0,t===!0&&(t=e.turnColor),t)for(const[n,r]of e.pieces)r.role==="king"&&r.color===t&&(e.check=n)}function ea(e,t,n,r){nt(e),e.premovable.current=[t,n],me(e.premovable.events.set,t,n,r)}function tt(e){e.premovable.current&&(e.premovable.current=void 0,me(e.premovable.events.unset))}function ta(e,t,n){tt(e),e.predroppable.current={role:t,key:n},me(e.predroppable.events.set,t,n)}function nt(e){const t=e.predroppable;t.current&&(t.current=void 0,me(t.events.unset))}function na(e,t,n){if(!e.autoCastle)return!1;const r=e.pieces.get(t);if(!r||r.role!=="king")return!1;const i=X(t),o=X(n);if(i[1]!==0&&i[1]!==7||i[1]!==o[1])return!1;i[0]===4&&!e.pieces.has(n)&&(o[0]===6?n=it([7,o[1]]):o[0]===2&&(n=it([0,o[1]])));const s=e.pieces.get(n);return!s||s.color!==r.color||s.role!=="rook"?!1:(e.pieces.delete(t),e.pieces.delete(n),i[0]<o[0]?(e.pieces.set(it([6,o[1]]),r),e.pieces.set(it([5,o[1]]),s)):(e.pieces.set(it([2,o[1]]),r),e.pieces.set(it([3,o[1]]),s)),!0)}function So(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);if(t===n||!r)return!1;const o=i&&i.color!==r.color?i:void 0;return n===e.selected&&Ae(e),me(e.events.move,t,n,o),na(e,t,n)||(e.pieces.set(n,r),e.pieces.delete(t)),e.lastMove=[t,n],e.check=void 0,me(e.events.change),o||!0}function jr(e,t,n,r){if(e.pieces.has(n))if(r)e.pieces.delete(n);else return!1;return me(e.events.dropNewPiece,t,n),e.pieces.set(n,t),e.lastMove=[n],e.check=void 0,me(e.events.change),e.movable.dests=void 0,e.turnColor=qn(e.turnColor),!0}function Ao(e,t,n){const r=So(e,t,n);return r&&(e.movable.dests=void 0,e.turnColor=qn(e.turnColor),e.animation.current=void 0),r}function Po(e,t,n){if(Br(e,t,n)){const r=Ao(e,t,n);if(r){const i=e.hold.stop();Ae(e);const o={premove:!1,ctrlKey:e.stats.ctrlKey,holdTime:i};return r!==!0&&(o.captured=r),me(e.movable.events.after,t,n,o),!0}}else if(ia(e,t,n))return ea(e,t,n,{ctrlKey:e.stats.ctrlKey}),Ae(e),!0;return Ae(e),!1}function $o(e,t,n,r){const i=e.pieces.get(t);i&&(ra(e,t,n)||r)?(e.pieces.delete(t),jr(e,i,n,r),me(e.movable.events.afterNewPiece,i.role,n,{premove:!1,predrop:!1})):i&&oa(e,t,n)?ta(e,i.role,n):(tt(e),nt(e)),e.pieces.delete(t),Ae(e)}function yr(e,t,n){if(me(e.events.select,t),e.selected){if(e.selected===t&&!e.draggable.enabled){Ae(e),e.hold.cancel();return}else if((e.selectable.enabled||n)&&e.selected!==t&&Po(e,e.selected,t)){e.stats.dragged=!1;return}}(e.selectable.enabled||e.draggable.enabled)&&(To(e,t)||zr(e,t))&&(Oo(e,t),e.hold.start())}function Oo(e,t){e.selected=t,zr(e,t)?e.premovable.customDests||(e.premovable.dests=Co(e,t)):e.premovable.dests=void 0}function Ae(e){e.selected=void 0,e.premovable.dests=void 0,e.hold.cancel()}function To(e,t){const n=e.pieces.get(t);return!!n&&(e.movable.color==="both"||e.movable.color===n.color&&e.turnColor===n.color)}const Br=(e,t,n)=>t!==n&&To(e,t)&&(e.movable.free||!!e.movable.dests?.get(t)?.includes(n));function ra(e,t,n){const r=e.pieces.get(t);return!!r&&(t===n||!e.pieces.has(n))&&(e.movable.color==="both"||e.movable.color===r.color&&e.turnColor===r.color)}function zr(e,t){const n=e.pieces.get(t);return!!n&&e.premovable.enabled&&e.movable.color===n.color&&e.turnColor!==n.color}const ia=(e,t,n)=>t!==n&&zr(e,t)&&(e.premovable.customDests?.get(t)??Co(e,t)).includes(n);function oa(e,t,n){const r=e.pieces.get(t),i=e.pieces.get(n);return!!r&&(!i||i.color!==e.movable.color)&&e.predroppable.enabled&&(r.role!=="pawn"||n[1]!=="1"&&n[1]!=="8")&&e.movable.color===r.color&&e.turnColor!==r.color}function sa(e,t){const n=e.pieces.get(t);return!!n&&e.draggable.enabled&&(e.movable.color==="both"||e.movable.color===n.color&&(e.turnColor===n.color||e.premovable.enabled))}function la(e){const t=e.premovable.current;if(!t)return!1;const n=t[0],r=t[1];let i=!1;if(Br(e,n,r)){const o=Ao(e,n,r);if(o){const s={premove:!0};o!==!0&&(s.captured=o),me(e.movable.events.after,n,r,s),i=!0}}return tt(e),i}function aa(e,t){const n=e.predroppable.current;let r=!1;if(!n)return!1;if(t(n)){const i={role:n.role,color:e.movable.color};jr(e,i,n.key)&&(me(e.movable.events.afterNewPiece,n.role,n.key,{premove:!1,predrop:!0}),r=!0)}return nt(e),r}function Kr(e){tt(e),nt(e),Ae(e)}function wi(e){e.movable.color=e.movable.dests=e.animation.current=void 0,Kr(e)}function vt(e,t,n){let r=Math.floor(8*(e[0]-n.left)/n.width);t||(r=7-r);let i=7-Math.floor(8*(e[1]-n.top)/n.height);return t||(i=7-i),r>=0&&r<8&&i>=0&&i<8?Fe([r,i]):void 0}function ca(e,t,n,r){const i=X(e),o=uo.filter(c=>Fl(i,c)||mo(i[0],i[1],c[0],c[1])||Dr(i[0],i[1],c[0],c[1])),l=o.map(c=>go(it(c),n,r)).map(c=>Zt(t,c)),[,a]=l.reduce((c,u,f)=>c[0]<u?c:[u,f],[l[0],0]);return Fe(o[a])}const ye=e=>e.orientation==="white",Ro="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",ua={p:"pawn",r:"rook",n:"knight",b:"bishop",q:"queen",k:"king"},fa={pawn:"p",rook:"r",knight:"n",bishop:"b",queen:"q",king:"k"};function xo(e){e==="start"&&(e=Ro);const t=new Map;let n=7,r=0;for(const i of e)switch(i){case" ":case"[":return t;case"/":if(--n,n<0)return t;r=0;break;case"~":{const o=Fe([r-1,n]),s=o&&t.get(o);s&&(s.promoted=!0);break}default:{const o=i.charCodeAt(0);if(o<57)r+=o-48;else{const s=i.toLowerCase(),l=Fe([r,n]);l&&t.set(l,{role:ua[s],color:i===s?"black":"white"}),++r}}}return t}function da(e){return Il.map(t=>Cn.map(n=>{const r=e.get(n+t);if(r){let i=fa[r.role];return r.color==="white"&&(i=i.toUpperCase()),r.promoted&&(i+="~"),i}else return"1"}).join("")).join("/").replace(/1{2,}/g,t=>t.length.toString())}function Lo(e,t){t.animation&&(Gr(e.animation,t.animation),(e.animation.duration||0)<70&&(e.animation.enabled=!1))}function Mo(e,t){if(t.movable?.dests&&(e.movable.dests=void 0),t.drawable?.autoShapes&&(e.drawable.autoShapes=[]),Gr(e,t),t.fen&&(e.pieces=xo(t.fen),e.drawable.shapes=t.drawable?.shapes||[]),"check"in t&&Zl(e,t.check||!1),"lastMove"in t&&!t.lastMove?e.lastMove=void 0:t.lastMove&&(e.lastMove=t.lastMove),e.selected&&Oo(e,e.selected),Lo(e,t),!e.movable.rookCastle&&e.movable.dests){const n=e.movable.color==="white"?"1":"8",r="e"+n,i=e.movable.dests.get(r),o=e.pieces.get(r);if(!i||!o||o.role!=="king")return;e.movable.dests.set(r,i.filter(s=>!(s==="a"+n&&i.includes("c"+n))&&!(s==="h"+n&&i.includes("g"+n))))}}function Gr(e,t){for(const n in t)n==="__proto__"||n==="constructor"||!Object.prototype.hasOwnProperty.call(t,n)||(Object.prototype.hasOwnProperty.call(e,n)&&_i(e[n])&&_i(t[n])?Gr(e[n],t[n]):e[n]=t[n])}function _i(e){if(typeof e!="object"||e===null)return!1;const t=Object.getPrototypeOf(e);return t===Object.prototype||t===null}const ot=(e,t)=>t.animation.enabled?ga(e,t):Je(e,t);function Je(e,t){const n=e(t);return t.dom.redraw(),n}const rr=(e,t)=>({key:e,pos:X(e),piece:t}),ha=(e,t)=>t.sort((n,r)=>Zt(e.pos,n.pos)-Zt(e.pos,r.pos))[0];function pa(e,t){const n=new Map,r=[],i=new Map,o=[],s=[],l=new Map;let a,c,u;for(const[f,d]of e)l.set(f,rr(f,d));for(const f of Un)a=t.pieces.get(f),c=l.get(f),a?c?An(a,c.piece)||(o.push(c),s.push(rr(f,a))):s.push(rr(f,a)):c&&o.push(c);for(const f of s)c=ha(f,o.filter(d=>An(f.piece,d.piece))),c&&(u=[c.pos[0]-f.pos[0],c.pos[1]-f.pos[1]],n.set(f.key,u.concat(u)),r.push(c.key));for(const f of o)r.includes(f.key)||i.set(f.key,f.piece);return{anims:n,fadings:i}}function Io(e,t){const n=e.animation.current;if(n===void 0){e.dom.destroyed||e.dom.redrawNow();return}const r=1-(t-n.start)*n.frequency;if(r<=0)e.animation.current=void 0,e.dom.redrawNow();else{const i=ma(r);for(const o of n.plan.anims.values())o[2]=o[0]*i,o[3]=o[1]*i;e.dom.redrawNow(!0),requestAnimationFrame((o=performance.now())=>Io(e,o))}}function ga(e,t){const n=new Map(t.pieces),r=e(t),i=pa(n,t);if(i.anims.size||i.fadings.size){const o=t.animation.current&&t.animation.current.start;t.animation.current={start:performance.now(),frequency:1/t.animation.duration,plan:i},o||Io(t,performance.now())}else t.dom.redraw();return r}const ma=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,ya=["green","red","blue","yellow"];function wa(e,t){if(t.touches&&t.touches.length>1)return;t.stopPropagation(),t.preventDefault(),t.ctrlKey?Ae(e):Kr(e);const n=bt(t),r=vt(n,ye(e),e.dom.bounds());r&&(e.drawable.current={orig:r,pos:n,brush:ka(t),snapToValidMove:e.drawable.defaultSnapToValidMove},No(e))}function No(e){requestAnimationFrame(()=>{const t=e.drawable.current;if(t){const n=vt(t.pos,ye(e),e.dom.bounds());n||(t.snapToValidMove=!1);const r=t.snapToValidMove?ca(t.orig,t.pos,ye(e),e.dom.bounds()):n;r!==t.mouseSq&&(t.mouseSq=r,t.dest=r!==t.orig?r:void 0,e.dom.redrawNow()),No(e)}})}function _a(e,t){e.drawable.current&&(e.drawable.current.pos=bt(t))}function ba(e){const t=e.drawable.current;t&&(t.mouseSq&&Ea(e.drawable,t),Do(e))}function Do(e){e.drawable.current&&(e.drawable.current=void 0,e.dom.redraw())}function va(e){e.drawable.shapes.length&&(e.drawable.shapes=[],e.dom.redraw(),Uo(e.drawable))}const wr=(e,t)=>e.orig===t.orig&&e.dest===t.dest,Fo=(e,t)=>e.brush===t.brush;function ka(e){const t=(e.shiftKey||e.ctrlKey)&&po(e),n=e.altKey||e.metaKey||e.getModifierState?.("AltGraph");return ya[(t?1:0)+(n?2:0)]}function Ea(e,t){const n=e.shapes.find(r=>wr(r,t));n&&(e.shapes=e.shapes.filter(r=>!wr(r,t))),(!n||!Fo(n,t))&&e.shapes.push({orig:t.orig,dest:t.dest,brush:t.brush}),Uo(e)}function Uo(e){e.onChange&&e.onChange(e.shapes)}function Ca(e,t){if(!(e.trustAllEvents||t.isTrusted)||t.buttons!==void 0&&t.buttons>1||t.touches&&t.touches.length>1)return;const n=e.dom.bounds(),r=bt(t),i=vt(r,ye(e),n);if(!i)return;const o=e.pieces.get(i),s=e.selected;if(!s&&e.drawable.enabled&&(e.drawable.eraseOnMovablePieceClick||!o||o.color!==e.turnColor)&&va(e),t.cancelable!==!1&&(!t.touches||e.blockTouchScroll||o||s||Sa(e,r)))t.preventDefault();else if(t.touches)return;const l=!!e.premovable.current,a=!!e.predroppable.current;e.stats.ctrlKey=t.ctrlKey,e.selected&&Br(e,e.selected,i)?ot(f=>yr(f,i),e):yr(e,i);const c=e.selected===i,u=jo(e,i);if(o&&u&&c&&sa(e,i)){e.draggable.current={orig:i,piece:o,origPos:r,pos:r,started:e.draggable.autoDistance&&e.stats.dragged,element:u,previouslySelected:s,originTarget:t.target,keyHasChanged:!1},u.cgDragging=!0,u.classList.add("dragging");const f=e.dom.elements.ghost;f&&(f.className=`ghost ${o.color} ${o.role}`,Le(f,dn(n)(X(i),ye(e))),Nr(f,!0)),Hr(e)}else l&&tt(e),a&&nt(e);e.dom.redraw()}function Sa(e,t){const n=ye(e),r=e.dom.bounds(),i=Math.pow(e.touchIgnoreRadius*r.width/16,2)*2;for(const o of e.pieces.keys()){const s=go(o,n,r);if(Zt(s,t)<=i)return!0}return!1}function Aa(e,t,n,r){e.pieces.set("a0",t),e.dom.redraw();const o=bt(n);e.draggable.current={orig:"a0",piece:t,origPos:o,pos:o,started:!0,element:()=>jo(e,"a0"),originTarget:n.target,newPiece:!0,force:!!r,keyHasChanged:!1},Hr(e)}function Hr(e){requestAnimationFrame(()=>{const t=e.draggable.current;if(!t)return;e.animation.current?.plan.anims.has(t.orig)&&(e.animation.current=void 0);const n=e.pieces.get(t.orig);if(!n||!An(n,t.piece))$n(e);else if(!t.started&&Zt(t.pos,t.origPos)>=Math.pow(e.draggable.distance,2)&&(t.started=!0),t.started){if(typeof t.element=="function"){const i=t.element();if(!i)return;i.cgDragging=!0,i.classList.add("dragging"),t.element=i}const r=e.dom.bounds();Le(t.element,[t.pos[0]-r.left-r.width/16,t.pos[1]-r.top-r.height/16]),t.keyHasChanged||(t.keyHasChanged=t.orig!==vt(t.pos,ye(e),r))}Hr(e)})}function Pa(e,t){e.draggable.current&&(!t.touches||t.touches.length<2)&&(e.draggable.current.pos=bt(t))}function $a(e,t){const n=e.draggable.current;if(!n)return;if(t.type==="touchend"&&t.cancelable!==!1&&t.preventDefault(),t.type==="touchend"&&n.originTarget!==t.target&&!n.newPiece){e.draggable.current=void 0;return}tt(e),nt(e);const r=bt(t)||n.pos,i=vt(r,ye(e),e.dom.bounds());i&&n.started&&n.orig!==i?n.newPiece?$o(e,n.orig,i,n.force):(e.stats.ctrlKey=t.ctrlKey,Po(e,n.orig,i)&&(e.stats.dragged=!0)):n.newPiece?e.pieces.delete(n.orig):e.draggable.deleteOnDropOff&&!i&&(e.pieces.delete(n.orig),me(e.events.change)),(n.orig===n.previouslySelected||n.keyHasChanged)&&(n.orig===i||!i)?Ae(e):e.selectable.enabled||Ae(e),qo(e),e.draggable.current=void 0,e.dom.redraw()}function $n(e){const t=e.draggable.current;t&&(t.newPiece&&e.pieces.delete(t.orig),e.draggable.current=void 0,Ae(e),qo(e),e.dom.redraw())}function qo(e){const t=e.dom.elements;t.ghost&&Nr(t.ghost,!1)}function jo(e,t){let n=e.dom.elements.board.firstChild;for(;n;){if(n.cgKey===t&&n.tagName==="PIECE")return n;n=n.nextSibling}}function Oa(e,t){e.exploding={stage:1,keys:t},e.dom.redraw(),setTimeout(()=>{bi(e,2),setTimeout(()=>bi(e,void 0),120)},120)}function bi(e,t){e.exploding&&(t?e.exploding.stage=t:e.exploding=void 0,e.dom.redraw())}function Ta(e,t){function n(){Xl(e),t()}return{set(r){r.orientation&&r.orientation!==e.orientation&&n(),Lo(e,r),(r.fen?ot:Je)(i=>Mo(i,r),e)},state:e,getFen:()=>da(e.pieces),toggleOrientation:n,setPieces(r){ot(i=>Yl(i,r),e)},selectSquare(r,i){r?ot(o=>yr(o,r,i),e):e.selected&&(Ae(e),e.dom.redraw())},move(r,i){ot(o=>So(o,r,i),e)},newPiece(r,i){ot(o=>jr(o,r,i),e)},playPremove(){if(e.premovable.current){if(ot(la,e))return!0;e.dom.redraw()}return!1},playPredrop(r){if(e.predroppable.current){const i=aa(e,r);return e.dom.redraw(),i}return!1},cancelPremove(){Je(tt,e)},cancelPredrop(){Je(nt,e)},cancelMove(){Je(r=>{Kr(r),$n(r)},e)},stop(){Je(r=>{wi(r),$n(r)},e)},explode(r){Oa(e,r)},setAutoShapes(r){Je(i=>i.drawable.autoShapes=r,e)},setShapes(r){Je(i=>i.drawable.shapes=r.slice(),e)},getKeyAtDomPos(r){return vt(r,ye(e),e.dom.bounds())},redrawAll:t,dragNewPiece(r,i,o){Aa(e,r,i,o)},destroy(){wi(e),e.dom.unbind&&e.dom.unbind(),e.dom.destroyed=!0}}}function Ra(){return{pieces:xo(Ro),orientation:"white",turnColor:"white",coordinates:!0,coordinatesOnSquares:!1,ranksPosition:"right",autoCastle:!0,viewOnly:!1,disableContextMenu:!1,addPieceZIndex:!1,blockTouchScroll:!1,touchIgnoreRadius:1,pieceKey:!1,trustAllEvents:!1,highlight:{lastMove:!0,check:!0},animation:{enabled:!0,duration:200},movable:{free:!0,color:"both",showDests:!0,events:{},rookCastle:!0},premovable:{enabled:!0,showDests:!0,castle:!0,additionalPremoveRequirements:e=>!0,events:{}},predroppable:{enabled:!1,events:{}},draggable:{enabled:!0,distance:3,autoDistance:!0,showGhost:!0,deleteOnDropOff:!1},dropmode:{active:!1},selectable:{enabled:!0},stats:{dragged:!("ontouchstart"in window)},events:{},drawable:{enabled:!0,visible:!0,defaultSnapToValidMove:!0,eraseOnMovablePieceClick:!0,shapes:[],autoShapes:[],brushes:{green:{key:"g",color:"#15781B",opacity:1,lineWidth:10},red:{key:"r",color:"#882020",opacity:1,lineWidth:10},blue:{key:"b",color:"#003088",opacity:1,lineWidth:10},yellow:{key:"y",color:"#e68f00",opacity:1,lineWidth:10},paleBlue:{key:"pb",color:"#003088",opacity:.4,lineWidth:15},paleGreen:{key:"pg",color:"#15781B",opacity:.4,lineWidth:15},paleRed:{key:"pr",color:"#882020",opacity:.4,lineWidth:15},paleGrey:{key:"pgr",color:"#4a4a4a",opacity:.35,lineWidth:15},purple:{key:"purple",color:"#68217a",opacity:.65,lineWidth:10},pink:{key:"pink",color:"#ee2080",opacity:.5,lineWidth:10},white:{key:"white",color:"white",opacity:1,lineWidth:10},paleWhite:{key:"pwhite",color:"white",opacity:.6,lineWidth:10}},prevSvgHash:""},hold:Dl()}}function xa(){const e=fe("defs"),t=he(fe("filter"),{id:"cg-filter-blur"});return t.appendChild(he(fe("feGaussianBlur"),{stdDeviation:"0.013"})),e.appendChild(t),e}function La(e,t){const n=e.drawable,r=n.current,i=r&&r.mouseSq?r:void 0,o=new Map,s=e.dom.bounds(),l=n.autoShapes.filter(f=>!f.piece);for(const f of n.shapes.concat(l).concat(i?[i]:[])){if(!f.dest)continue;const d=o.get(f.dest)??new Set,p=Tn(On(X(f.orig),e.orientation),s),w=Tn(On(X(f.dest),e.orientation),s);d.add(br(p,w)),o.set(f.dest,d)}const a=[],c=i?n.shapes.findIndex(f=>wr(f,i)&&Fo(f,i)):-1;for(const[f,d]of n.shapes.concat(l).entries()){const p=c!==-1&&c===f;a.push({shape:d,current:!1,pendingErase:p,hash:vi(d,_r(d.dest,o),!1,s,p)})}i&&c===-1&&a.push({shape:i,current:!0,hash:vi(i,_r(i.dest,o),!0,s,!1),pendingErase:!1});const u=a.map(f=>f.hash).join(";");u!==e.drawable.prevSvgHash&&(e.drawable.prevSvgHash=u,Ma(n,a,t),Ia(a,t,f=>Fa(e,f,n.brushes,o,s)))}function Ma(e,t,n){for(const r of[n.shapes,n.shapesBelow]){const i=r.querySelector("defs"),o=t.filter(c=>r===n.shapesBelow==!!c.shape.below),s=new Map;for(const c of o.filter(u=>u.shape.dest&&u.shape.brush)){const u=Bo(e.brushes[c.shape.brush],c.shape.modifiers),{key:f,color:d}=zo(c.shape);f&&d&&s.set(f,{key:f,color:d,opacity:1,lineWidth:1}),s.set(u.key,u)}const l=new Set;let a=i.firstElementChild;for(;a;)l.add(a.getAttribute("cgKey")),a=a.nextElementSibling;for(const[c,u]of s.entries())l.has(c)||i.appendChild(ja(u))}}function Ia(e,t,n){for(const[r,i]of[[t.shapes,t.custom],[t.shapesBelow,t.customBelow]]){const[o,s]=[r,i].map(c=>c.querySelector("g")),l=e.filter(c=>r===t.shapesBelow==!!c.shape.below),a=new Map;for(const c of l)a.set(c.hash,!1);for(const c of[o,s]){const u=[];let f=c.firstElementChild,d;for(;f;)d=f.getAttribute("cgHash"),a.has(d)?a.set(d,!0):u.push(f),f=f.nextElementSibling;for(const p of u)c.removeChild(p)}for(const c of l.filter(u=>!a.get(u.hash)))for(const u of n(c))u.isCustom?s.appendChild(u.el):o.appendChild(u.el)}}function vi({orig:e,dest:t,brush:n,piece:r,modifiers:i,customSvg:o,label:s,below:l},a,c,u,f){return[u.width,u.height,c,f&&"pendingErase",e,t,n,a&&"-",r&&Na(r),i&&Da(i),o&&`custom-${ki(o.html)},${o.center?.[0]??"o"}`,s&&`label-${ki(s.text)}`,l&&"below"].filter(d=>d).join(",")}function Na(e){return[e.color,e.role,e.scale].filter(t=>t).join(",")}function Da(e){return[e.lineWidth,e.hilite].filter(t=>t).join(",")}function ki(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)>>>0;return t.toString()}function Fa(e,{shape:t,current:n,pendingErase:r,hash:i},o,s,l){const a=Tn(On(X(t.orig),e.orientation),l),c=t.dest?Tn(On(X(t.dest),e.orientation),l):a,u=t.brush&&Bo(o[t.brush],t.modifiers),f=s.get(t.dest),d=[];if(u){const p=he(fe("g"),{cgHash:i});d.push({el:p}),a[0]!==c[0]||a[1]!==c[1]?p.appendChild(qa(t,u,a,c,n,_r(t.dest,s),r)):p.appendChild(Ua(o[t.brush],a,n,l,r))}if(t.label){const p=t.label;p.fill??(p.fill=t.brush&&o[t.brush].color);const w=t.brush?void 0:"tr";d.push({el:Ba(p,i,a,c,f,w),isCustom:!0})}if(t.customSvg){const p=t.customSvg.center??"orig",[w,y]=p==="label"?Go(a,c,f).map(O=>O-.5):p==="dest"?c:a,S=he(fe("g"),{transform:`translate(${w},${y})`,cgHash:i});S.innerHTML=`<svg width="1" height="1" viewBox="0 0 100 100">${t.customSvg.html}</svg>`,d.push({el:S,isCustom:!0})}return d}function Ua(e,t,n,r,i){const o=za(),s=(r.width+r.height)/(4*Math.max(r.width,r.height));return he(fe("circle"),{stroke:e.color,"stroke-width":o[n?0:1],fill:"none",opacity:Ko(e,n,i),cx:t[0],cy:t[1],r:s-o[1]/2})}function qa(e,t,n,r,i,o,s){function l(u){const f=Ga(o&&!i),d=r[0]-n[0],p=r[1]-n[1],w=Math.atan2(p,d),y=Math.cos(w)*f,S=Math.sin(w)*f,O=zo(e);return he(fe("line"),{stroke:u?O.color:t.color,"stroke-width":Ka(t,i)*(u?1.14:1),"stroke-linecap":"round","marker-end":`url(#arrowhead-${u?O.key:t.key})`,opacity:e.modifiers?.hilite&&!s?1:Ko(t,i,s),x1:n[0],y1:n[1],x2:r[0]-y,y2:r[1]-S})}if(!e.modifiers?.hilite)return l(!1);const a=he(fe("g"),{opacity:t.opacity}),c=he(fe("g"),{filter:"url(#cg-filter-blur)"});return c.appendChild(Ha(n,r)),c.appendChild(l(!0)),a.appendChild(c),a.appendChild(l(!1)),a}function ja(e){const t=he(fe("marker"),{id:"arrowhead-"+e.key,orient:"auto",overflow:"visible",markerWidth:4,markerHeight:4,refX:e.key.startsWith("hilite")?1.86:2.05,refY:2});return t.appendChild(he(fe("path"),{d:"M0,0 V4 L3,2 Z",fill:e.color})),t.setAttribute("cgKey",e.key),t}function Ba(e,t,n,r,i,o){const l=.4*.75**e.text.length,a=Go(n,r,i),c=o==="tr"?.4:0,u=he(fe("g"),{transform:`translate(${a[0]+c},${a[1]-c})`,cgHash:t});u.appendChild(he(fe("circle"),{r:.4/2,"fill-opacity":o?1:.8,"stroke-opacity":o?1:.7,"stroke-width":.03,fill:e.fill??"#666",stroke:"white"}));const f=he(fe("text"),{"font-size":l,"font-family":"Noto Sans","text-anchor":"middle",fill:"white",y:.13*.75**e.text.length});return f.innerHTML=e.text,u.appendChild(f),u}function On(e,t){return t==="white"?e:[7-e[0],7-e[1]]}function _r(e,t){return(e&&t.has(e)&&t.get(e).size>1)===!0}function fe(e){return document.createElementNS("http://www.w3.org/2000/svg",e)}function he(e,t){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e.setAttribute(n,t[n]);return e}function Bo(e,t){return t?{color:e.color,opacity:Math.round(e.opacity*10)/10,lineWidth:Math.round(t.lineWidth||e.lineWidth),key:[e.key,t.lineWidth].filter(n=>n).join("")}:e}function za(){return[3/64,4/64]}function Ka(e,t){return(e.lineWidth||10)*(t?.85:1)/64}function zo(e){const t=e.modifiers?.hilite;return{key:t&&`hilite-${t.replace("#","")}`,color:t}}function Ko(e,t,n){return(e.opacity||1)*(n?.6:t?.9:1)}function Ga(e){return(e?20:10)/64}function Tn(e,t){const n=Math.min(1,t.width/t.height),r=Math.min(1,t.height/t.width);return[(e[0]-3.5)*n,(3.5-e[1])*r]}function Ha(e,t){const n={from:[Math.floor(Math.min(e[0],t[0])),Math.floor(Math.min(e[1],t[1]))],to:[Math.ceil(Math.max(e[0],t[0])),Math.ceil(Math.max(e[1],t[1]))]};return he(fe("rect"),{x:n.from[0],y:n.from[1],width:n.to[0]-n.from[0],height:n.to[1]-n.from[1],fill:"none",stroke:"none"})}function br(e,t,n=!0){const r=Math.atan2(t[1]-e[1],t[0]-e[0])+Math.PI;return n?(Math.round(r*8/Math.PI)+16)%16:r}function Wa(e,t){return Math.sqrt([e[0]-t[0],e[1]-t[1]].reduce((n,r)=>n+r*r,0))}function Go(e,t,n){let r=Wa(e,t);const i=br(e,t,!1);if(n&&(r-=33/64,n.size>1)){r-=10/64;const o=br(e,t);(n.has((o+1)%16)||n.has((o+15)%16))&&o&1&&(r-=.4)}return[e[0]-Math.cos(i)*r,e[1]-Math.sin(i)*r].map(o=>o+.5)}function Va(e,t){e.innerHTML="",e.classList.add("cg-wrap");for(const u of Ml)e.classList.toggle("orientation-"+u,t.orientation===u);e.classList.toggle("manipulable",!t.viewOnly);const n=He("cg-container");e.appendChild(n);const r=He("cg-board");n.appendChild(r);let i,o,s,l,a;if(t.drawable.visible&&([i,o]=["cg-shapes-below","cg-shapes"].map(u=>Ei(u,!0)),[s,l]=["cg-custom-below","cg-custom-svgs"].map(u=>Ei(u,!1)),a=He("cg-auto-pieces"),n.appendChild(i),n.appendChild(s),n.appendChild(o),n.appendChild(l),n.appendChild(a)),t.coordinates){const u=t.orientation==="black"?" black":"",f=t.ranksPosition==="left"?" left":"";if(t.coordinatesOnSquares){const d=t.orientation==="white"?p=>p+1:p=>8-p;Cn.forEach((p,w)=>n.appendChild(ir(Sn.map(y=>p+y),"squares rank"+d(w)+u+f)))}else n.appendChild(ir(Sn,"ranks"+u+f)),n.appendChild(ir(Cn,"files"+u))}let c;return t.draggable.enabled&&t.draggable.showGhost&&(c=He("piece","ghost"),Nr(c,!1),n.appendChild(c)),{board:r,container:n,wrap:e,ghost:c,shapes:o,shapesBelow:i,custom:l,customBelow:s,autoPieces:a}}function Ei(e,t){const n=he(fe("svg"),{class:e,viewBox:t?"-4 -4 8 8":"-3.5 -3.5 8 8",preserveAspectRatio:"xMidYMid slice"});return t&&n.appendChild(xa()),n.appendChild(fe("g")),n}function ir(e,t){const n=He("coords",t);let r;for(const i of e)r=He("coord"),r.textContent=i,n.appendChild(r);return n}function Qa(e,t){if(!e.dropmode.active)return;tt(e),nt(e);const n=e.dropmode.piece;if(n){e.pieces.set("a0",n);const r=bt(t),i=r&&vt(r,ye(e),e.dom.bounds());i&&$o(e,"a0",i)}e.dom.redraw()}function Ja(e,t){const n=e.dom.elements.board;if("ResizeObserver"in window&&new ResizeObserver(t).observe(e.dom.elements.wrap),(e.disableContextMenu||e.drawable.enabled)&&n.addEventListener("contextmenu",i=>i.preventDefault()),e.viewOnly)return;const r=Ya(e);n.addEventListener("touchstart",r,{passive:!1}),n.addEventListener("mousedown",r,{passive:!1})}function Xa(e,t){const n=[];if("ResizeObserver"in window||n.push(Ut(document.body,"chessground.resize",t)),!e.viewOnly){const r=Ci(e,Pa,_a),i=Ci(e,$a,ba);for(const s of["touchmove","mousemove"])n.push(Ut(document,s,r));for(const s of["touchend","mouseup"])n.push(Ut(document,s,i));const o=()=>e.dom.bounds.clear();n.push(Ut(document,"scroll",o,{capture:!0,passive:!0})),n.push(Ut(window,"resize",o,{passive:!0}))}return()=>n.forEach(r=>r())}function Ut(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}const Ya=e=>t=>{e.draggable.current?$n(e):e.drawable.current?Do(e):t.shiftKey||po(t)?e.drawable.enabled&&wa(e,t):e.viewOnly||(e.dropmode.active?Qa(e,t):Ca(e,t))},Ci=(e,t,n)=>r=>{e.drawable.current?e.drawable.enabled&&n(e,r):e.viewOnly||t(e,r)};function Za(e){const t=ye(e),n=dn(e.dom.bounds()),r=e.dom.elements.board,i=e.pieces,o=e.animation.current,s=o?o.plan.anims:new Map,l=o?o.plan.fadings:new Map,a=e.draggable.current,c=tc(e),u=new Set,f=new Set,d=new Map,p=new Map;let w,y,S,O,P,j,F,H,Y,ie;for(y=r.firstChild;y;){if(w=y.cgKey,Ho(y))if(S=i.get(w),P=s.get(w),j=l.get(w),O=y.cgPiece,y.cgDragging&&(!a||a.orig!==w)&&(y.classList.remove("dragging"),Le(y,n(X(w),t)),y.cgDragging=!1),!j&&y.cgFading&&(y.cgFading=!1,y.classList.remove("fading")),S){if(P&&y.cgAnimating&&O===qt(S)){const N=X(w);N[0]+=P[2],N[1]+=P[3],y.classList.add("anim"),Le(y,n(N,t))}else y.cgAnimating&&(y.cgAnimating=!1,y.classList.remove("anim"),Le(y,n(X(w),t)),e.addPieceZIndex&&(y.style.zIndex=or(X(w),t)));O===qt(S)&&(!j||!y.cgFading)?u.add(w):j&&O===qt(j)?(y.classList.add("fading"),y.cgFading=!0):sr(d,O,y)}else sr(d,O,y);else if(Wo(y)){const N=y.className;c.get(w)===N?f.add(w):sr(p,N,y)}y=y.nextSibling}for(const[N,Q]of c)if(!f.has(N)){Y=p.get(Q),ie=Y&&Y.pop();const ee=n(X(N),t);if(ie)ie.cgKey=N,Le(ie,ee);else{const B=He("square",Q);B.cgKey=N,Le(B,ee),r.insertBefore(B,r.firstChild)}}for(const[N,Q]of i)if(P=s.get(N),!u.has(N))if(F=d.get(qt(Q)),H=F&&F.pop(),H){H.cgKey=N,H.cgFading&&(H.classList.remove("fading"),H.cgFading=!1);const ee=X(N);e.addPieceZIndex&&(H.style.zIndex=or(ee,t)),P&&(H.cgAnimating=!0,H.classList.add("anim"),ee[0]+=P[2],ee[1]+=P[3]),Le(H,n(ee,t))}else{const ee=qt(Q),B=He("piece",ee),L=X(N);B.cgPiece=ee,B.cgKey=N,P&&(B.cgAnimating=!0,L[0]+=P[2],L[1]+=P[3]),Le(B,n(L,t)),e.addPieceZIndex&&(B.style.zIndex=or(L,t)),r.appendChild(B)}for(const N of d.values())Ai(e,N);for(const N of p.values())Ai(e,N)}function ec(e){const t=ye(e),n=dn(e.dom.bounds());let r=e.dom.elements.board.firstChild;for(;r;)(Ho(r)&&!r.cgAnimating||Wo(r))&&Le(r,n(X(r.cgKey),t)),r=r.nextSibling}function Si(e){const t=e.dom.elements.wrap.getBoundingClientRect(),n=e.dom.elements.container,r=t.height/t.width,i=Math.floor(t.width*window.devicePixelRatio/8)*8/window.devicePixelRatio,o=i*r;n.style.width=i+"px",n.style.height=o+"px",e.dom.bounds.clear(),e.addDimensionsCssVarsTo?.style.setProperty("---cg-width",i+"px"),e.addDimensionsCssVarsTo?.style.setProperty("---cg-height",o+"px")}const Ho=e=>e.tagName==="PIECE",Wo=e=>e.tagName==="SQUARE";function Ai(e,t){for(const n of t)e.dom.elements.board.removeChild(n)}function or(e,t){const r=e[1];return`${t?10-r:3+r}`}const qt=e=>`${e.color} ${e.role}`;function tc(e){const t=new Map;if(e.lastMove&&e.highlight.lastMove)for(const i of e.lastMove)Be(t,i,"last-move");if(e.check&&e.highlight.check&&Be(t,e.check,"check"),e.selected&&(Be(t,e.selected,"selected"),e.movable.showDests)){const i=e.movable.dests?.get(e.selected);if(i)for(const s of i)Be(t,s,"move-dest"+(e.pieces.has(s)?" oc":""));const o=e.premovable.customDests?.get(e.selected)??e.premovable.dests;if(o)for(const s of o)Be(t,s,"premove-dest"+(e.pieces.has(s)?" oc":""))}const n=e.premovable.current;if(n)for(const i of n)Be(t,i,"current-premove");else e.predroppable.current&&Be(t,e.predroppable.current.key,"current-premove");const r=e.exploding;if(r)for(const i of r.keys)Be(t,i,"exploding"+r.stage);return e.highlight.custom&&e.highlight.custom.forEach((i,o)=>{Be(t,o,i)}),t}function Be(e,t,n){const r=e.get(t);r?e.set(t,`${r} ${n}`):e.set(t,n)}function sr(e,t,n){const r=e.get(t);r?r.push(n):e.set(t,[n])}function nc(e,t,n){const r=new Map,i=[];for(const l of e)r.set(l.hash,!1);let o=t.firstElementChild,s;for(;o;)s=o.getAttribute("cgHash"),r.has(s)?r.set(s,!0):i.push(o),o=o.nextElementSibling;for(const l of i)t.removeChild(l);for(const l of e)r.get(l.hash)||t.appendChild(n(l))}function rc(e,t){const r=e.drawable.autoShapes.filter(i=>i.piece).map(i=>({shape:i,hash:sc(i),current:!1,pendingErase:!1}));nc(r,t,i=>oc(e,i,e.dom.bounds()))}function ic(e){const t=ye(e),n=dn(e.dom.bounds());let r=e.dom.elements.autoPieces?.firstChild;for(;r;)ho(r,n(X(r.cgKey),t),r.cgScale),r=r.nextSibling}function oc(e,{shape:t,hash:n},r){const i=t.orig,o=t.piece?.role,s=t.piece?.color,l=t.piece?.scale,a=He("piece",`${o} ${s}`);return a.setAttribute("cgHash",n),a.cgKey=i,a.cgScale=l,ho(a,dn(r)(X(i),ye(e)),l),a}const sc=e=>[e.orig,e.piece?.role,e.piece?.color,e.piece?.scale].join(",");function lc(e,t){const n=Ra();Mo(n,t||{});function r(){const i="dom"in n?n.dom.unbind:void 0,o=Va(e,n),s=fo(()=>o.board.getBoundingClientRect()),l=u=>{Za(c),o.autoPieces&&rc(c,o.autoPieces),!u&&o.shapes&&La(c,o)},a=()=>{Si(c),ec(c),o.autoPieces&&ic(c)},c=n;return c.dom={elements:o,bounds:s,redraw:ac(l),redrawNow:l,unbind:i},c.drawable.prevSvgHash="",Si(c),l(!1),Ja(c,a),i||(c.dom.unbind=Xa(c,a)),c.events.insert&&c.events.insert(o),c}return Ta(r(),r)}function ac(e){let t=!1;return()=>{t||(t=!0,requestAnimationFrame(()=>{e(),t=!1}))}}const Rn=["a","b","c","d","e","f","g","h"],Vo=["1","2","3","4","5","6","7","8"],dt=["white","black"],$e=["pawn","knight","bishop","rook","queen","king"],cc=["a","h"],xn=e=>"role"in e,V=e=>e!==void 0,ae=e=>e==="white"?"black":"white",ht=e=>e>>3,be=e=>e&7,vr=(e,t)=>0<=e&&e<8&&0<=t&&t<8?e+8*t:void 0,Kt=e=>{switch(e){case"pawn":return"p";case"knight":return"n";case"bishop":return"b";case"rook":return"r";case"queen":return"q";case"king":return"k"}};function kr(e){switch(e.toLowerCase()){case"p":return"pawn";case"n":return"knight";case"b":return"bishop";case"r":return"rook";case"q":return"queen";case"k":return"king";default:return}}function Gt(e){if(e.length===2)return vr(e.charCodeAt(0)-97,e.charCodeAt(1)-49)}const en=e=>Rn[be(e)]+Vo[ht(e)],uc=e=>{if(e[1]==="@"&&e.length===4){const t=kr(e[0]),n=Gt(e.slice(2));if(t&&V(n))return{role:t,to:n}}else if(e.length===4||e.length===5){const t=Gt(e.slice(0,2)),n=Gt(e.slice(2,4));let r;if(e.length===5&&(r=kr(e[4]),!r))return;if(V(t)&&V(n))return{from:t,to:n,promotion:r}}},Wr=(e,t)=>e==="white"?t==="a"?2:6:t==="a"?58:62,Vr=(e,t)=>e==="white"?t==="a"?3:5:t==="a"?59:61,fc=(e,t)=>{const n=new Map,r=e.ctx();for(const[i,o]of e.allDests(r))if(o.nonEmpty()){const s=Array.from(o,en);i===r.king&&be(i)===4&&(o.has(0)?s.push("c1"):o.has(56)&&s.push("c8"),o.has(7)?s.push("g1"):o.has(63)&&s.push("g8")),n.set(en(i),s)}return n};function dc(e){let t=0;return n=>{t+=n.deltaY*(n.deltaMode?40:1),Math.abs(t)>=4?(e(n,!0),t=0):e(n,!1)}}const Pi=e=>(e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),Math.imul(e+(e>>>4)&252645135,16843009)>>24),Er=e=>(e=e>>>8&16711935|(e&16711935)<<8,e>>>16&65535|(e&65535)<<16),$i=e=>(e=e>>>1&1431655765|(e&1431655765)<<1,e=e>>>2&858993459|(e&858993459)<<2,e=e>>>4&252645135|(e&252645135)<<4,Er(e));class E{constructor(t,n){this.lo=t|0,this.hi=n|0}static fromSquare(t){return t>=32?new E(0,1<<t-32):new E(1<<t,0)}static fromRank(t){return new E(255,0).shl64(8*t)}static fromFile(t){return new E(16843009<<t,16843009<<t)}static empty(){return new E(0,0)}static full(){return new E(4294967295,4294967295)}static corners(){return new E(129,2164260864)}static center(){return new E(402653184,24)}static backranks(){return new E(255,4278190080)}static backrank(t){return t==="white"?new E(255,0):new E(0,4278190080)}static lightSquares(){return new E(1437226410,1437226410)}static darkSquares(){return new E(2857740885,2857740885)}complement(){return new E(~this.lo,~this.hi)}xor(t){return new E(this.lo^t.lo,this.hi^t.hi)}union(t){return new E(this.lo|t.lo,this.hi|t.hi)}intersect(t){return new E(this.lo&t.lo,this.hi&t.hi)}diff(t){return new E(this.lo&~t.lo,this.hi&~t.hi)}intersects(t){return this.intersect(t).nonEmpty()}isDisjoint(t){return this.intersect(t).isEmpty()}supersetOf(t){return t.diff(this).isEmpty()}subsetOf(t){return this.diff(t).isEmpty()}shr64(t){return t>=64?E.empty():t>=32?new E(this.hi>>>t-32,0):t>0?new E(this.lo>>>t^this.hi<<32-t,this.hi>>>t):this}shl64(t){return t>=64?E.empty():t>=32?new E(0,this.lo<<t-32):t>0?new E(this.lo<<t,this.hi<<t^this.lo>>>32-t):this}bswap64(){return new E(Er(this.hi),Er(this.lo))}rbit64(){return new E($i(this.hi),$i(this.lo))}minus64(t){const n=this.lo-t.lo,r=(n&t.lo&1)+(t.lo>>>1)+(n>>>1)>>>31;return new E(n,this.hi-(t.hi+r))}equals(t){return this.lo===t.lo&&this.hi===t.hi}size(){return Pi(this.lo)+Pi(this.hi)}isEmpty(){return this.lo===0&&this.hi===0}nonEmpty(){return this.lo!==0||this.hi!==0}has(t){return(t>=32?this.hi&1<<t-32:this.lo&1<<t)!==0}set(t,n){return n?this.with(t):this.without(t)}with(t){return t>=32?new E(this.lo,this.hi|1<<t-32):new E(this.lo|1<<t,this.hi)}without(t){return t>=32?new E(this.lo,this.hi&~(1<<t-32)):new E(this.lo&~(1<<t),this.hi)}toggle(t){return t>=32?new E(this.lo,this.hi^1<<t-32):new E(this.lo^1<<t,this.hi)}last(){if(this.hi!==0)return 63-Math.clz32(this.hi);if(this.lo!==0)return 31-Math.clz32(this.lo)}first(){if(this.lo!==0)return 31-Math.clz32(this.lo&-this.lo);if(this.hi!==0)return 63-Math.clz32(this.hi&-this.hi)}withoutFirst(){return this.lo!==0?new E(this.lo&this.lo-1,this.hi):new E(0,this.hi&this.hi-1)}moreThanOne(){return this.hi!==0&&this.lo!==0||(this.lo&this.lo-1)!==0||(this.hi&this.hi-1)!==0}singleSquare(){return this.moreThanOne()?void 0:this.last()}*[Symbol.iterator](){let t=this.lo,n=this.hi;for(;t!==0;){const r=31-Math.clz32(t&-t);t^=1<<r,yield r}for(;n!==0;){const r=31-Math.clz32(n&-n);n^=1<<r,yield 32+r}}*reversed(){let t=this.lo,n=this.hi;for(;n!==0;){const r=31-Math.clz32(n);n^=1<<r,yield 32+r}for(;t!==0;){const r=31-Math.clz32(t);t^=1<<r,yield r}}}const Ln=(e,t)=>{let n=E.empty();for(const r of t){const i=e+r;0<=i&&i<64&&Math.abs(be(e)-be(i))<=2&&(n=n.with(i))}return n},et=e=>{const t=[];for(let n=0;n<64;n++)t[n]=e(n);return t},hc=et(e=>Ln(e,[-9,-8,-7,-1,1,7,8,9])),pc=et(e=>Ln(e,[-17,-15,-10,-6,6,10,15,17])),gc={white:et(e=>Ln(e,[7,9])),black:et(e=>Ln(e,[-7,-9]))},Qr=e=>hc[e],Jr=e=>pc[e],Kn=(e,t)=>gc[e][t],Cr=et(e=>E.fromFile(be(e)).without(e)),Sr=et(e=>E.fromRank(ht(e)).without(e)),Ar=et(e=>{const t=new E(134480385,2151686160),n=8*(ht(e)-be(e));return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),Pr=et(e=>{const t=new E(270549120,16909320),n=8*(ht(e)+be(e)-7);return(n>=0?t.shl64(n):t.shr64(-n)).without(e)}),$r=(e,t,n)=>{let r=n.intersect(t),i=r.bswap64();return r=r.minus64(e),i=i.minus64(e.bswap64()),r.xor(i.bswap64()).intersect(t)},mc=(e,t)=>$r(E.fromSquare(e),Cr[e],t),yc=(e,t)=>{const n=Sr[e];let r=t.intersect(n),i=r.rbit64();return r=r.minus64(E.fromSquare(e)),i=i.minus64(E.fromSquare(63-e)),r.xor(i.rbit64()).intersect(n)},tn=(e,t)=>{const n=E.fromSquare(e);return $r(n,Ar[e],t).xor($r(n,Pr[e],t))},nn=(e,t)=>mc(e,t).xor(yc(e,t)),Qo=(e,t)=>tn(e,t).xor(nn(e,t)),Jo=(e,t)=>{const n=E.fromSquare(t);return Sr[e].intersects(n)?Sr[e].with(e):Pr[e].intersects(n)?Pr[e].with(e):Ar[e].intersects(n)?Ar[e].with(e):Cr[e].intersects(n)?Cr[e].with(e):E.empty()},rn=(e,t)=>Jo(e,t).intersect(E.full().shl64(e).xor(E.full().shl64(t))).withoutFirst();class $t{constructor(){}static default(){const t=new $t;return t.reset(),t}reset(){this.occupied=new E(65535,4294901760),this.promoted=E.empty(),this.white=new E(65535,0),this.black=new E(0,4294901760),this.pawn=new E(65280,16711680),this.knight=new E(66,1107296256),this.bishop=new E(36,603979776),this.rook=new E(129,2164260864),this.queen=new E(8,134217728),this.king=new E(16,268435456)}static empty(){const t=new $t;return t.clear(),t}clear(){this.occupied=E.empty(),this.promoted=E.empty();for(const t of dt)this[t]=E.empty();for(const t of $e)this[t]=E.empty()}clone(){const t=new $t;t.occupied=this.occupied,t.promoted=this.promoted;for(const n of dt)t[n]=this[n];for(const n of $e)t[n]=this[n];return t}getColor(t){if(this.white.has(t))return"white";if(this.black.has(t))return"black"}getRole(t){for(const n of $e)if(this[n].has(t))return n}get(t){const n=this.getColor(t);if(!n)return;const r=this.getRole(t),i=this.promoted.has(t);return{color:n,role:r,promoted:i}}take(t){const n=this.get(t);return n&&(this.occupied=this.occupied.without(t),this[n.color]=this[n.color].without(t),this[n.role]=this[n.role].without(t),n.promoted&&(this.promoted=this.promoted.without(t))),n}set(t,n){const r=this.take(t);return this.occupied=this.occupied.with(t),this[n.color]=this[n.color].with(t),this[n.role]=this[n.role].with(t),n.promoted&&(this.promoted=this.promoted.with(t)),r}has(t){return this.occupied.has(t)}*[Symbol.iterator](){for(const t of this.occupied)yield[t,this.get(t)]}pieces(t,n){return this[t].intersect(this[n])}rooksAndQueens(){return this.rook.union(this.queen)}bishopsAndQueens(){return this.bishop.union(this.queen)}steppers(){return this.knight.union(this.pawn).union(this.king)}sliders(){return this.bishop.union(this.rook).union(this.queen)}kingOf(t){return this.pieces(t,"king").singleSquare()}}class Me{constructor(){}static empty(){const t=new Me;for(const n of $e)t[n]=0;return t}static fromBoard(t,n){const r=new Me;for(const i of $e)r[i]=t.pieces(n,i).size();return r}clone(){const t=new Me;for(const n of $e)t[n]=this[n];return t}equals(t){return $e.every(n=>this[n]===t[n])}add(t){const n=new Me;for(const r of $e)n[r]=this[r]+t[r];return n}subtract(t){const n=new Me;for(const r of $e)n[r]=this[r]-t[r];return n}nonEmpty(){return $e.some(t=>this[t]>0)}isEmpty(){return!this.nonEmpty()}hasPawns(){return this.pawn>0}hasNonPawns(){return this.knight>0||this.bishop>0||this.rook>0||this.queen>0||this.king>0}size(){return this.pawn+this.knight+this.bishop+this.rook+this.queen+this.king}}class lt{constructor(t,n){this.white=t,this.black=n}static empty(){return new lt(Me.empty(),Me.empty())}static fromBoard(t){return new lt(Me.fromBoard(t,"white"),Me.fromBoard(t,"black"))}clone(){return new lt(this.white.clone(),this.black.clone())}equals(t){return this.white.equals(t.white)&&this.black.equals(t.black)}add(t){return new lt(this.white.add(t.white),this.black.add(t.black))}subtract(t){return new lt(this.white.subtract(t.white),this.black.subtract(t.black))}count(t){return this.white[t]+this.black[t]}size(){return this.white.size()+this.black.size()}isEmpty(){return this.white.isEmpty()&&this.black.isEmpty()}nonEmpty(){return!this.isEmpty()}hasPawns(){return this.white.hasPawns()||this.black.hasPawns()}hasNonPawns(){return this.white.hasNonPawns()||this.black.hasNonPawns()}}class on{constructor(t,n){this.white=t,this.black=n}static default(){return new on(3,3)}clone(){return new on(this.white,this.black)}equals(t){return this.white===t.white&&this.black===t.black}}class Xo{unwrap(t,n){const r=this._chain(i=>U.ok(t?t(i):i),i=>n?U.ok(n(i)):U.err(i));if(r.isErr)throw r.error;return r.value}map(t,n){return this._chain(r=>U.ok(t(r)),r=>U.err(n?n(r):r))}chain(t,n){return this._chain(t,n??(r=>U.err(r)))}}class wc extends Xo{constructor(t){super(),this.value=t,this.isOk=!0,this.isErr=!1}_chain(t,n){return t(this.value)}}class _c extends Xo{constructor(t){super(),this.error=t,this.isOk=!1,this.isErr=!0}_chain(t,n){return n(this.error)}}var U;(function(e){function t(i){return new wc(i)}e.ok=t;function n(i){return new _c(i||new Error)}e.err=n;function r(i){if(Array.isArray(i)){const l=[];for(let a=0;a<i.length;a++){const c=i[a];if(c.isErr)return c;l.push(c.value)}return e.ok(l)}const o={},s=Object.keys(i);for(let l=0;l<s.length;l++){const a=i[s[l]];if(a.isErr)return a;o[s[l]]=a.value}return e.ok(o)}e.all=r})(U||(U={}));var Xe;(function(e){e.Empty="ERR_EMPTY",e.OppositeCheck="ERR_OPPOSITE_CHECK",e.PawnsOnBackrank="ERR_PAWNS_ON_BACKRANK",e.Kings="ERR_KINGS",e.Variant="ERR_VARIANT"})(Xe||(Xe={}));class Ct extends Error{}const bc=(e,t,n,r)=>n[t].intersect(nn(e,r).intersect(n.rooksAndQueens()).union(tn(e,r).intersect(n.bishopsAndQueens())).union(Jr(e).intersect(n.knight)).union(Qr(e).intersect(n.king)).union(Kn(ae(t),e).intersect(n.pawn)));class at{constructor(){}static default(){const t=new at;return t.castlingRights=E.corners(),t.rook={white:{a:0,h:7},black:{a:56,h:63}},t.path={white:{a:new E(14,0),h:new E(96,0)},black:{a:new E(0,234881024),h:new E(0,1610612736)}},t}static empty(){const t=new at;return t.castlingRights=E.empty(),t.rook={white:{a:void 0,h:void 0},black:{a:void 0,h:void 0}},t.path={white:{a:E.empty(),h:E.empty()},black:{a:E.empty(),h:E.empty()}},t}clone(){const t=new at;return t.castlingRights=this.castlingRights,t.rook={white:{a:this.rook.white.a,h:this.rook.white.h},black:{a:this.rook.black.a,h:this.rook.black.h}},t.path={white:{a:this.path.white.a,h:this.path.white.h},black:{a:this.path.black.a,h:this.path.black.h}},t}add(t,n,r,i){const o=Wr(t,n),s=Vr(t,n);this.castlingRights=this.castlingRights.with(i),this.rook[t][n]=i,this.path[t][n]=rn(i,s).with(s).union(rn(r,o).with(o)).without(r).without(i)}static fromSetup(t){const n=at.empty(),r=t.castlingRights.intersect(t.board.rook);for(const i of dt){const o=E.backrank(i),s=t.board.kingOf(i);if(!V(s)||!o.has(s))continue;const l=r.intersect(t.board[i]).intersect(o),a=l.first();V(a)&&a<s&&n.add(i,"a",s,a);const c=l.last();V(c)&&s<c&&n.add(i,"h",s,c)}return n}discardRook(t){if(this.castlingRights.has(t)){this.castlingRights=this.castlingRights.without(t);for(const n of dt)for(const r of cc)this.rook[n][r]===t&&(this.rook[n][r]=void 0)}}discardColor(t){this.castlingRights=this.castlingRights.diff(E.backrank(t)),this.rook[t].a=void 0,this.rook[t].h=void 0}}class vc{constructor(t){this.rules=t}reset(){this.board=$t.default(),this.pockets=void 0,this.turn="white",this.castles=at.default(),this.epSquare=void 0,this.remainingChecks=void 0,this.halfmoves=0,this.fullmoves=1}setupUnchecked(t){this.board=t.board.clone(),this.board.promoted=E.empty(),this.pockets=void 0,this.turn=t.turn,this.castles=at.fromSetup(t),this.epSquare=kc(this,t.epSquare),this.remainingChecks=void 0,this.halfmoves=t.halfmoves,this.fullmoves=t.fullmoves}kingAttackers(t,n,r){return bc(t,n,this.board,r)}playCaptureAt(t,n){this.halfmoves=0,n.role==="rook"&&this.castles.discardRook(t),this.pockets&&this.pockets[ae(n.color)][n.promoted?"pawn":n.role]++}ctx(){const t=this.isVariantEnd(),n=this.board.kingOf(this.turn);if(!V(n))return{king:n,blockers:E.empty(),checkers:E.empty(),variantEnd:t,mustCapture:!1};const r=nn(n,E.empty()).intersect(this.board.rooksAndQueens()).union(tn(n,E.empty()).intersect(this.board.bishopsAndQueens())).intersect(this.board[ae(this.turn)]);let i=E.empty();for(const s of r){const l=rn(n,s).intersect(this.board.occupied);l.moreThanOne()||(i=i.union(l))}const o=this.kingAttackers(n,ae(this.turn),this.board.occupied);return{king:n,blockers:i,checkers:o,variantEnd:t,mustCapture:!1}}clone(){var t,n;const r=new this.constructor;return r.board=this.board.clone(),r.pockets=(t=this.pockets)===null||t===void 0?void 0:t.clone(),r.turn=this.turn,r.castles=this.castles.clone(),r.epSquare=this.epSquare,r.remainingChecks=(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),r.halfmoves=this.halfmoves,r.fullmoves=this.fullmoves,r}validate(){if(this.board.occupied.isEmpty())return U.err(new Ct(Xe.Empty));if(this.board.king.size()!==2)return U.err(new Ct(Xe.Kings));if(!V(this.board.kingOf(this.turn)))return U.err(new Ct(Xe.Kings));const t=this.board.kingOf(ae(this.turn));return V(t)?this.kingAttackers(t,this.turn,this.board.occupied).nonEmpty()?U.err(new Ct(Xe.OppositeCheck)):E.backranks().intersects(this.board.pawn)?U.err(new Ct(Xe.PawnsOnBackrank)):U.ok(void 0):U.err(new Ct(Xe.Kings))}dropDests(t){return E.empty()}dests(t,n){if(n=n||this.ctx(),n.variantEnd)return E.empty();const r=this.board.get(t);if(!r||r.color!==this.turn)return E.empty();let i,o;if(r.role==="pawn"){i=Kn(this.turn,t).intersect(this.board[ae(this.turn)]);const s=this.turn==="white"?8:-8,l=t+s;if(0<=l&&l<64&&!this.board.occupied.has(l)){i=i.with(l);const a=this.turn==="white"?t<16:t>=48,c=l+s;a&&!this.board.occupied.has(c)&&(i=i.with(c))}V(this.epSquare)&&Cc(this,t,n)&&(o=E.fromSquare(this.epSquare))}else r.role==="bishop"?i=tn(t,this.board.occupied):r.role==="knight"?i=Jr(t):r.role==="rook"?i=nn(t,this.board.occupied):r.role==="queen"?i=Qo(t,this.board.occupied):i=Qr(t);if(i=i.diff(this.board[this.turn]),V(n.king)){if(r.role==="king"){const s=this.board.occupied.without(t);for(const l of i)this.kingAttackers(l,ae(this.turn),s).nonEmpty()&&(i=i.without(l));return i.union(Oi(this,"a",n)).union(Oi(this,"h",n))}if(n.checkers.nonEmpty()){const s=n.checkers.singleSquare();if(!V(s))return E.empty();i=i.intersect(rn(s,n.king).with(s))}n.blockers.has(t)&&(i=i.intersect(Jo(t,n.king)))}return o&&(i=i.union(o)),i}isVariantEnd(){return!1}variantOutcome(t){}hasInsufficientMaterial(t){return this.board[t].intersect(this.board.pawn.union(this.board.rooksAndQueens())).nonEmpty()?!1:this.board[t].intersects(this.board.knight)?this.board[t].size()<=2&&this.board[ae(t)].diff(this.board.king).diff(this.board.queen).isEmpty():this.board[t].intersects(this.board.bishop)?(!this.board.bishop.intersects(E.darkSquares())||!this.board.bishop.intersects(E.lightSquares()))&&this.board.pawn.isEmpty()&&this.board.knight.isEmpty():!0}toSetup(){var t,n;return{board:this.board.clone(),pockets:(t=this.pockets)===null||t===void 0?void 0:t.clone(),turn:this.turn,castlingRights:this.castles.castlingRights,epSquare:Ec(this),remainingChecks:(n=this.remainingChecks)===null||n===void 0?void 0:n.clone(),halfmoves:Math.min(this.halfmoves,150),fullmoves:Math.min(Math.max(this.fullmoves,1),9999)}}isInsufficientMaterial(){return dt.every(t=>this.hasInsufficientMaterial(t))}hasDests(t){t=t||this.ctx();for(const n of this.board[this.turn])if(this.dests(n,t).nonEmpty())return!0;return this.dropDests(t).nonEmpty()}isLegal(t,n){if(xn(t))return!this.pockets||this.pockets[this.turn][t.role]<=0||t.role==="pawn"&&E.backranks().has(t.to)?!1:this.dropDests(n).has(t.to);{if(t.promotion==="pawn"||t.promotion==="king"&&this.rules!=="antichess"||!!t.promotion!==(this.board.pawn.has(t.from)&&E.backranks().has(t.to)))return!1;const r=this.dests(t.from,n);return r.has(t.to)||r.has(Sc(this,t).to)}}isCheck(){const t=this.board.kingOf(this.turn);return V(t)&&this.kingAttackers(t,ae(this.turn),this.board.occupied).nonEmpty()}isEnd(t){return(t?t.variantEnd:this.isVariantEnd())?!0:this.isInsufficientMaterial()||!this.hasDests(t)}isCheckmate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.nonEmpty()&&!this.hasDests(t)}isStalemate(t){return t=t||this.ctx(),!t.variantEnd&&t.checkers.isEmpty()&&!this.hasDests(t)}outcome(t){const n=this.variantOutcome(t);return n||(t=t||this.ctx(),this.isCheckmate(t)?{winner:ae(this.turn)}:this.isInsufficientMaterial()||this.isStalemate(t)?{winner:void 0}:void 0)}allDests(t){t=t||this.ctx();const n=new Map;if(t.variantEnd)return n;for(const r of this.board[this.turn])n.set(r,this.dests(r,t));return n}play(t){const n=this.turn,r=this.epSquare,i=Zo(this,t);if(this.epSquare=void 0,this.halfmoves+=1,n==="black"&&(this.fullmoves+=1),this.turn=ae(n),xn(t))this.board.set(t.to,{role:t.role,color:n}),this.pockets&&this.pockets[n][t.role]--,t.role==="pawn"&&(this.halfmoves=0);else{const o=this.board.take(t.from);if(!o)return;let s;if(o.role==="pawn"){this.halfmoves=0,t.to===r&&(s=this.board.take(t.to+(n==="white"?-8:8)));const l=t.from-t.to;Math.abs(l)===16&&8<=t.from&&t.from<=55&&(this.epSquare=t.from+t.to>>1),t.promotion&&(o.role=t.promotion,o.promoted=!!this.pockets)}else if(o.role==="rook")this.castles.discardRook(t.from);else if(o.role==="king"){if(i){const l=this.castles.rook[n][i];if(V(l)){const a=this.board.take(l);this.board.set(Wr(n,i),o),a&&this.board.set(Vr(n,i),a)}}this.castles.discardColor(n)}if(!i){const l=this.board.set(t.to,o)||s;l&&this.playCaptureAt(t.to,l)}}this.remainingChecks&&this.isCheck()&&(this.remainingChecks[n]=Math.max(this.remainingChecks[n]-1,0))}}class Yo extends vc{constructor(){super("chess")}static default(){const t=new this;return t.reset(),t}static fromSetup(t){const n=new this;return n.setupUnchecked(t),n.validate().map(r=>n)}clone(){return super.clone()}}const kc=(e,t)=>{if(!V(t))return;const n=e.turn==="white"?5:2,r=e.turn==="white"?8:-8;if(ht(t)!==n||e.board.occupied.has(t+r))return;const i=t-r;if(!(!e.board.pawn.has(i)||!e.board[ae(e.turn)].has(i)))return t},Ec=e=>{if(!V(e.epSquare))return;const t=e.ctx(),r=e.board.pieces(e.turn,"pawn").intersect(Kn(ae(e.turn),e.epSquare));for(const i of r)if(e.dests(i,t).has(e.epSquare))return e.epSquare},Cc=(e,t,n)=>{if(!V(e.epSquare)||!Kn(e.turn,t).has(e.epSquare))return!1;if(!V(n.king))return!0;const r=e.turn==="white"?8:-8,i=e.epSquare-r;return e.kingAttackers(n.king,ae(e.turn),e.board.occupied.toggle(t).toggle(i).with(e.epSquare)).without(i).isEmpty()},Oi=(e,t,n)=>{if(!V(n.king)||n.checkers.nonEmpty())return E.empty();const r=e.castles.rook[e.turn][t];if(!V(r)||e.castles.path[e.turn][t].intersects(e.board.occupied))return E.empty();const i=Wr(e.turn,t),o=rn(n.king,i),s=e.board.occupied.without(n.king);for(const c of o)if(e.kingAttackers(c,ae(e.turn),s).nonEmpty())return E.empty();const l=Vr(e.turn,t),a=e.board.occupied.toggle(n.king).toggle(r).toggle(l);return e.kingAttackers(i,ae(e.turn),a).nonEmpty()?E.empty():E.fromSquare(r)},Zo=(e,t)=>{if(xn(t))return;const n=t.to-t.from;if(!(Math.abs(n)!==2&&!e.board[e.turn].has(t.to))&&e.board.king.has(t.from))return n>0?"h":"a"},Sc=(e,t)=>{const n=Zo(e,t);if(!n)return t;const r=e.castles.rook[e.turn][n];return{from:t.from,to:V(r)?r:t.to}},Ac="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR",Pc=Ac+" w KQkq -",Xr=Pc+" 0 1";var se;(function(e){e.Fen="ERR_FEN",e.Board="ERR_BOARD",e.Pockets="ERR_POCKETS",e.Turn="ERR_TURN",e.Castling="ERR_CASTLING",e.EpSquare="ERR_EP_SQUARE",e.RemainingChecks="ERR_REMAINING_CHECKS",e.Halfmoves="ERR_HALFMOVES",e.Fullmoves="ERR_FULLMOVES"})(se||(se={}));class ce extends Error{}const $c=(e,t,n)=>{let r=e.indexOf(t);for(;n-- >0&&r!==-1;)r=e.indexOf(t,r+t.length);return r},At=e=>/^\d{1,4}$/.test(e)?parseInt(e,10):void 0,es=e=>{const t=kr(e);return t&&{role:t,color:e.toLowerCase()===e?"black":"white"}},lr=e=>{const t=$t.empty();let n=7,r=0;for(let i=0;i<e.length;i++){const o=e[i];if(o==="/"&&r===8)r=0,n--;else{const s=parseInt(o,10);if(s>0)r+=s;else{if(r>=8||n<0)return U.err(new ce(se.Board));const l=r+n*8,a=es(o);if(!a)return U.err(new ce(se.Board));e[i+1]==="~"&&(a.promoted=!0,i++),t.set(l,a),r++}}}return n!==0||r!==8?U.err(new ce(se.Board)):U.ok(t)},Ti=e=>{if(e.length>64)return U.err(new ce(se.Pockets));const t=lt.empty();for(const n of e){const r=es(n);if(!r)return U.err(new ce(se.Pockets));t[r.color][r.role]++}return U.ok(t)},Oc=(e,t)=>{let n=E.empty();if(t==="-")return U.ok(n);for(const r of t){const i=r.toLowerCase(),o=r===i?"black":"white",s=o==="white"?0:7;if("a"<=i&&i<="h")n=n.with(vr(i.charCodeAt(0)-97,s));else if(i==="k"||i==="q"){const l=e[o].intersect(E.backrank(o)).intersect(e.rook.union(e.king)),a=i==="k"?l.last():l.first();n=n.with(V(a)&&e.rook.has(a)?a:vr(i==="k"?7:0,s))}else return U.err(new ce(se.Castling))}return dt.some(r=>E.backrank(r).intersect(n).size()>2)?U.err(new ce(se.Castling)):U.ok(n)},Ri=e=>{const t=e.split("+");if(t.length===3&&t[0]===""){const n=At(t[1]),r=At(t[2]);return!V(n)||n>3||!V(r)||r>3?U.err(new ce(se.RemainingChecks)):U.ok(new on(3-n,3-r))}else if(t.length===2){const n=At(t[0]),r=At(t[1]);return!V(n)||n>3||!V(r)||r>3?U.err(new ce(se.RemainingChecks)):U.ok(new on(n,r))}else return U.err(new ce(se.RemainingChecks))},Tc=e=>{const t=e.split(/[\s_]+/),n=t.shift();let r,i=U.ok(void 0);if(n.endsWith("]")){const l=n.indexOf("[");if(l===-1)return U.err(new ce(se.Fen));r=lr(n.slice(0,l)),i=Ti(n.slice(l+1,-1))}else{const l=$c(n,"/",7);l===-1?r=lr(n):(r=lr(n.slice(0,l)),i=Ti(n.slice(l+1)))}let o;const s=t.shift();if(!V(s)||s==="w")o="white";else if(s==="b")o="black";else return U.err(new ce(se.Turn));return r.chain(l=>{const a=t.shift(),c=V(a)?Oc(l,a):U.ok(E.empty()),u=t.shift();let f;if(V(u)&&u!=="-"&&(f=Gt(u),!V(f)))return U.err(new ce(se.EpSquare));let d=t.shift(),p;V(d)&&d.includes("+")&&(p=Ri(d),d=t.shift());const w=V(d)?At(d):0;if(!V(w))return U.err(new ce(se.Halfmoves));const y=t.shift(),S=V(y)?At(y):1;if(!V(S))return U.err(new ce(se.Fullmoves));const O=t.shift();let P=U.ok(void 0);if(V(O)){if(V(p))return U.err(new ce(se.RemainingChecks));P=Ri(O)}else V(p)&&(P=p);return t.length>0?U.err(new ce(se.Fen)):i.chain(j=>c.chain(F=>P.map(H=>({board:l,pockets:j,turn:o,castlingRights:F,remainingChecks:H,epSquare:f,halfmoves:w,fullmoves:Math.max(1,S)}))))})},Rc=e=>{let t=Kt(e.role);return e.color==="white"&&(t=t.toUpperCase()),e.promoted&&(t+="~"),t},xc=e=>{let t="",n=0;for(let r=7;r>=0;r--)for(let i=0;i<8;i++){const o=i+r*8,s=e.get(o);s?(n>0&&(t+=n,n=0),t+=Rc(s)):n++,i===7&&(n>0&&(t+=n,n=0),r!==0&&(t+="/"))}return t},xi=e=>$e.map(t=>Kt(t).repeat(e[t])).join(""),Lc=e=>xi(e.white).toUpperCase()+xi(e.black),Mc=(e,t)=>{let n="";for(const r of dt){const i=E.backrank(r);let o=e.kingOf(r);V(o)&&!i.has(o)&&(o=void 0);const s=e.pieces(r,"rook").intersect(i);for(const l of t.intersect(i).reversed())if(l===s.first()&&V(o)&&l<o)n+=r==="white"?"Q":"q";else if(l===s.last()&&V(o)&&o<l)n+=r==="white"?"K":"k";else{const a=Rn[be(l)];n+=r==="white"?a.toUpperCase():a}}return n||"-"},Ic=e=>`${e.white}+${e.black}`,Nc=(e,t)=>[xc(e.board)+(e.pockets?`[${Lc(e.pockets)}]`:""),e.turn[0],Mc(e.board,e.castlingRights),V(e.epSquare)?en(e.epSquare):"-",...e.remainingChecks?[Ic(e.remainingChecks)]:[],Math.max(0,Math.min(e.halfmoves,9999)),Math.max(1,Math.min(e.fullmoves,9999))].join(" "),Dc=(e,t)=>{let n="";if(xn(t))t.role!=="pawn"&&(n=Kt(t.role).toUpperCase()),n+="@"+en(t.to);else{const r=e.board.getRole(t.from);if(!r)return"--";if(r==="king"&&(e.board[e.turn].has(t.to)||Math.abs(t.to-t.from)===2))n=t.to>t.from?"O-O":"O-O-O";else{const i=e.board.occupied.has(t.to)||r==="pawn"&&be(t.from)!==be(t.to);if(r!=="pawn"){n=Kt(r).toUpperCase();let o;if(r==="king"?o=Qr(t.to).intersect(e.board.king):r==="queen"?o=Qo(t.to,e.board.occupied).intersect(e.board.queen):r==="rook"?o=nn(t.to,e.board.occupied).intersect(e.board.rook):r==="bishop"?o=tn(t.to,e.board.occupied).intersect(e.board.bishop):o=Jr(t.to).intersect(e.board.knight),o=o.intersect(e.board[e.turn]).without(t.from),o.nonEmpty()){const s=e.ctx();for(const l of o)e.dests(l,s).has(t.to)||(o=o.without(l));if(o.nonEmpty()){let l=!1,a=o.intersects(E.fromRank(ht(t.from)));o.intersects(E.fromFile(be(t.from)))?l=!0:a=!0,a&&(n+=Rn[be(t.from)]),l&&(n+=Vo[ht(t.from)])}}}else i&&(n=Rn[be(t.from)]);i&&(n+="x"),n+=en(t.to),t.promotion&&(n+="="+Kt(t.promotion).toUpperCase())}}return n},Fc=(e,t)=>{var n;const r=Dc(e,t);return e.play(t),!((n=e.outcome())===null||n===void 0)&&n.winner?r+"#":e.isCheck()?r+"+":r},Uc=(e,t)=>Fc(e.clone(),t),Gn=e=>Yo.fromSetup(Tc(e).unwrap()).unwrap(),qc=e=>Gn(e).turn,ts=(e,t)=>{let n=e[e.length-1]?.fen??Xr,r=Gn(n),i=uc(t),o=Uc(r,i);return r.play(i),{fen:Nc(r.toSetup()),before_fen:n,uci:t,san:o}},Li=e=>{let t=[];return e.map(n=>{t=[...t,ts(t,n)]}),t},jc=e=>e.map(t=>t.uci).join(" "),Bc=e=>e.map((t,n)=>`${ns(n+1)}${t.san}`).join(" "),ns=e=>e%2===0?"":zc(e),zc=e=>`${Math.ceil(e/2)}.`+(e%2===0?"..":"");var Kc=K('<div class="is2d chessboard"> ');function Gc(e){let t,n,r=I(()=>{try{return Gn(e.fen??Xr)}catch{return Yo.default()}}),i=I(()=>fc(r())),o=I(()=>r().isCheck());return ln(()=>{let s=r().isCheck(),l={fen:e.fen,check:s,premovable:{enabled:!1},movable:{color:e.movable_color,free:!1,dests:i(),events:{after:e.play_orig_key}}};n=lc(t,l)}),ge(()=>{let s;if(e.last_move_uci){let l=e.last_move_uci;s=[l.slice(0,2),l.slice(2,4)]}n.set({lastMove:s,fen:e.fen,turnColor:e.turn_color,orientation:e.orientation??"white",check:o(),movable:{color:e.movable_color,dests:i()}})}),ge(()=>{n.setAutoShapes(e.shapes??[])}),(()=>{var s=Kc();return De(l=>t=l,s),s})()}const Hc=e=>dc(t=>{const n=t.target;n.tagName!=="PIECE"&&n.tagName!=="SQUARE"&&n.tagName!=="CG-BOARD"||(t.preventDefault(),e(Math.sign(t.deltaY)))});var Wc=K('<button class="meet-button draw">');function Vc(e){return(()=>{var t=Wc();return Oe(t,"click",e.onClick,!0),M(t,()=>e.children),re(n=>{var r=e.disabled,i=!!e.gray,o=!!(e.draw||e.meet),s=!!e.meet;return r!==n.e&&(t.disabled=n.e=r),i!==n.t&&t.classList.toggle("gray",n.t=i),o!==n.a&&t.classList.toggle("draw",n.a=o),s!==n.o&&t.classList.toggle("meet",n.o=s),n},{e:void 0,t:void 0,a:void 0,o:void 0}),t})()}qe(["click"]);var Qc=K("<div class=moves-wrap><ul class=replay>"),Jc=K("<li class=move><span class=index>");function Xc(e){let t;return ge(()=>{let n=e.cursor,r=t.parentElement;if(!r)return;const i=t.querySelector(".cursor");if(!i){r.scrollTop=n>0?99999:0;return}let o=i.offsetTop-r.offsetHeight/2+i.offsetHeight;r.scrollTo({behavior:"smooth",top:o})}),(()=>{var n=Qc(),r=n.firstChild;return De(i=>t=i,r),M(r,_(fn,{get fallback(){return e.fallback},get each(){return e.san_moves},children:(i,o)=>(()=>{var s=Jc(),l=s.firstChild;return s.$$click=()=>e.on_set_cursor(o()),M(l,()=>ns(o()+1)),M(s,i,null),re(()=>s.classList.toggle("cursor",e.cursor===o())),s})()})),n})()}qe(["click"]);const sn={equals:!1},Yc=(e,t)=>e.length>0?()=>e(te(t)):e;function Zc(e,t){let n=0;const r=e.map((i,o)=>I(()=>(n=o,i()),void 0,sn));return I(()=>r.map(i=>i())[n],void 0,t)}function Ht(e,t,n){let r=()=>t;const[i,o]=q(t,sn),s=I(Yc(e,()=>r()),t,sn);return[r=Zc([i,s],n),(l=>o(()=>typeof l=="function"?l(te(r)):l))]}function eu(e,t,n){let r=!1,i=!0;const[o,s]=q(void 0,sn),l=I(a=>r?e(a):(i=!o(),a),t,sn);return()=>{r=!0,i&&(i=s());const a=l();return r=!1,a}}function tu(e,t){const n=16.666666666666668;let r=performance.now(),i=0,o;function s(l){o=requestAnimationFrame(s);let a=Math.min(l-r,1e3);for(r=l,i+=a;i>=n;)e(n),i-=n}return{start(){cancelAnimationFrame(o),o=requestAnimationFrame(s)},stop(){cancelAnimationFrame(o)}}}function nu(e,t){const n=f=>{if(f.clientX||f.clientX===0)return[f.clientX,f.clientY]},r=f=>{let[d,p]=n(f)??[0,0];return[d-l.left,p-l.top]};function i(f){f.preventDefault(),e.setPointerCapture(f.pointerId);let d=r(f);t.on_down(d)}function o(f){let d=r(f);t.on_up(d)}function s(f){let d=r(f);t.on_move(d)}let l;a();function a(){l=e.getBoundingClientRect()}function c(){a()}e.addEventListener("pointerdown",i,{passive:!1}),e.addEventListener("pointermove",s,{passive:!1}),document.addEventListener("pointerup",o);let u=new ResizeObserver(a);return u.observe(e),document.addEventListener("scroll",c,{capture:!0,passive:!0}),window.addEventListener("resize",c,{passive:!0}),()=>{e.removeEventListener("pointerdown",i),e.removeEventListener("pointermove",s),document.removeEventListener("pointerup",o),document.removeEventListener("scroll",c),window.removeEventListener("resize",c),u.unobserve(e)}}function ru(e,t,n){return e<t?Math.min(e+n,t):e>t?Math.max(e-n,t):e}function jt(e,t){let[n,r,i,o]=e,[s,l,a,c]=t;return n<s+a&&n+i>s&&r<l+c&&r+o>l}function iu(e,t){let n,r,i,o,s,l=!1,a=0,c={on_down(f){i=void 0,r=f,o=f,l=!1,t()},on_up(f){r=void 0,n=void 0,i=f},on_move(f){n=f,l=!0}},u=nu(e,c);return{get is_hovering(){return n},get is_down(){return r},get is_up(){return i},get is_just_down(){return o},get is_double_click(){return s},get has_moved_after_last_down(){return l},update(f){s=void 0,o&&a>0&&(s=o,a=0),a=ru(a,0,f),o=void 0,i=void 0},disconnect(){u()},manual_trigger_down_hook(f){c.on_down(f)}}}const ou=1e-4;class ne{static rotate_point(t,n,r,i,o){let s=Math.cos(r),l=Math.sin(r),a=t-i,c=n-o,u=a*s-c*l,f=a*l+c*s;return u+=i,f+=o,ne.make(u,f)}static from_angle=t=>new ne(Math.cos(t),Math.sin(t));static make=(t,n)=>new ne(t,n);static xy=t=>new ne(t[0],t[1]);static get unit(){return new ne(1,1)}static get zero(){return new ne(0,0)}get xy(){return[this.x,this.y]}get mul_inverse(){return new ne(1/this.x,1/this.y)}get inverse(){return new ne(-this.x,-this.y)}get half(){return new ne(this.x/2,this.y/2)}get length_squared(){return this.x*this.x+this.y*this.y}get length(){return Math.sqrt(this.length_squared)}get normalize(){if(this.length!==0)return this.scale(1/this.length)}get perpendicular(){return new ne(-this.y,this.x)}get angle(){return Math.atan2(this.y,this.x)}x;y;constructor(t,n){this.x=t,this.y=n}clamp_epsilon(t=ou){return this.length<t?ne.zero:this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}project_to(t){let n=t.length_squared,r=this.dot(t);return ne.make(r*t.x/n,r*t.y/n)}distance(t){return this.sub(t).length}addy(t){return ne.make(this.x,this.y+t)}add_angle(t){return ne.from_angle(this.angle+t)}scale(t){return ne.make(this.x*t,this.y*t)}add(t){return ne.make(this.x+t.x,this.y+t.y)}sub(t){return ne.make(this.x-t.x,this.y-t.y)}mul(t){return ne.make(this.x*t.x,this.y*t.y)}div(t){return ne.make(this.x/t.x,this.y/t.y)}truncate(t){let n=this.length;return n>t?this.scale(t/n):this}}var su=K("<i>");const Te=e=>(()=>{var t=su();return re(()=>Jt(t,"data-icon",e.icon)),t})(),Re={Gear:"",CrossX:"",Gears:"",Delete:"",HeartEmpty:"",HeartFilled:"",DotEmpty:""};var lu=K("<div class=sortable-list-wrap><ul class=sortable-list>"),au=K("<div class=sortable-list-dragging>"),cu=K("<li class=draggable><div class=handle><span>.</span></div><div class=content>");function uu(e){const[t,n]=q(void 0),[r,i]=Ht(()=>e.list),o=I(Vi(r,L=>({item:L}))),s=I(()=>t()?o().indexOf(t()):-1),l=(L,z)=>{if(L===z)return;let x=o();[x[L],x[z]]=[x[z],x[L]],i(x.slice(0).map(h=>h.item))};let a,c;const u=()=>(c===void 0&&(c=e.portal_selector.getBoundingClientRect()),c);let f,[d,p]=q(void 0);const w=()=>(f===void 0&&(f=N.getBoundingClientRect()),f),y=()=>{let L=u(),z=w(),x=10;return[z.left-L.left,z.bottom-L.top-x,z.width,x]},S=()=>{let L=u(),z=w();return[z.left-L.left,z.top-L.top,z.width,10]},O=()=>(d()===void 0&&p(Q.getBoundingClientRect()),d()),P=L=>[L[0]-5,L[1]-5,10,10];ln(()=>{let L,x=tu(A=>{if(a.is_just_down&&(L=a.is_just_down),a.is_hovering){if(jt(y(),P(a.is_hovering))&&(N.scrollTop+=10),jt(S(),P(a.is_hovering))&&(N.scrollTop-=10),Y(a.is_hovering),t()!==void 0){let $=b(a.is_hovering);$&&l(s(),$[0])}if(L&&ne.make(...a.is_hovering).distance(ne.make(...L))>4){let $=b(a.is_hovering);if($){let[m,C]=$,k=o()[m];n(k),F(C)}L=void 0}}a.is_up&&(n(void 0),x.stop(),e.set_ordered(o().map($=>$.item)),e.portal_selector.classList.remove("active")),a.update(A)});a=iu(e.portal_selector,x.start);const h=()=>{p(void 0),f=void 0,c=void 0};N.addEventListener("scroll",h);let g=new ResizeObserver(h);g.observe(N),Ne(()=>{a.disconnect(),x.stop(),N.removeEventListener("scroll",h),g.unobserve(N)});const v=I(()=>{O();let A=u();return[...Q.querySelectorAll(".draggable")].map($=>{let m=$.getBoundingClientRect(),C=[m.left-A.left,m.top-A.top];return[C[0],C[1],m.width,m.height]})}),b=A=>{let $=v().findIndex(C=>jt(C,P(A)));if($===-1)return;let m=v()[$];return[$,[A[0]-m[0],A[1]-m[1]]]}});const[j,F]=q([0,0]),[H,Y]=q([0,0]),ie=I(()=>({transform:`translate(${H()[0]-j()[0]}px, ${H()[1]-j()[1]}px)`}));let N,Q;const ee=L=>{if(a===void 0)return;let z=u(),x=[L.clientX-z.left,L.clientY-z.top];jt(y(),P(x))||jt(S(),P(x))||(a.manual_trigger_down_hook(x),L.preventDefault(),e.portal_selector.classList.add("active"))},B=(L,z)=>cn(()=>e.children(L,z));return[_(ke,{get when(){return t()},children:L=>_(Rr,{get mount(){return e.portal_selector},get children(){var z=au();return M(z,()=>e.dragging(L().item)),re(x=>Ji(z,ie(),x)),z}})}),(()=>{var L=lu(),z=L.firstChild;return De(x=>N=x,L),De(x=>Q=x,z),M(z,_(fn,{get each(){return o()},children:(x,h)=>(()=>{var g=cu(),v=g.firstChild,b=v.firstChild,A=b.firstChild,$=v.nextSibling;return v.$$pointerdown=ee,M(v,_(Te,{get icon(){return Re.DotEmpty}}),b),M(b,()=>h()+1,A),M($,()=>B(x.item,h)()),re(()=>g.classList.toggle("dragging",s()===h())),g})()})),L})()]}qe(["pointerdown"]);var fu=K('<div class="dropdown-menu show">'),du=K("<button class=dropdown-menu-toggle-button>");const rs=e=>{let t,n;const[r,i]=q(!1);ge(()=>{if(r(),n===void 0||t===void 0)return;let a=e.portal_selector.getBoundingClientRect(),c=n.getBoundingClientRect(),u=c.bottom-a.top,f=c.left-a.left;f+200>window.innerWidth&&(f-=200-c.width),t.style.top=`${u}px`,t.style.left=`${f}px`});const o=()=>{i(!1)};Ne(()=>{window.removeEventListener("resize",o),document.removeEventListener("click",s)}),ln(()=>{window.addEventListener("resize",o),document.addEventListener("click",s)});function s(a){t===void 0||t.contains(a.target),i(!1)}function l(a){e.portal_selector.classList.contains("active")||a.stopImmediatePropagation(),i(!r())}return ge(()=>{r()?e.portal_selector.classList.add("active"):e.portal_selector.classList.remove("active")}),[_(Rr,{get mount(){return e.portal_selector},get children(){return _(ke,{get when(){return r()},get children(){var a=fu(),c=t;return typeof c=="function"?De(c,a):t=a,M(a,()=>e.children),a}})}}),(()=>{var a=du();a.$$click=l;var c=n;return typeof c=="function"?De(c,a):n=a,M(a,()=>e.button),re(()=>a.classList.toggle("active",!!r())),a})()]};qe(["click"]);var hu=K("<span class=heart><span class=nb>");const pu=e=>{const[t,n]=q(!1),[r,i]=Ht(()=>e.is_heart),o=()=>{i(!r()),e.on_heart(r()),n(!0),setTimeout(()=>n(!1),200)};return(()=>{var s=hu(),l=s.firstChild;return s.$$click=o,M(s,_(ke,{get when(){return r()},get fallback(){return _(Te,{get icon(){return Re.HeartEmpty}})},get children(){return _(Te,{get icon(){return Re.HeartFilled}})}}),l),M(l,()=>e.nb_heart),re(a=>{var c=!!r(),u=!!t();return c!==a.e&&s.classList.toggle("is-heart",a.e=c),u!==a.t&&s.classList.toggle("beat",a.t=u),a},{e:void 0,t:void 0}),s})()};qe(["click"]);var gu=K("<button class=action-button>");const Ie={Ok:1,Cancel:2,Normal:3},pt=e=>{const t=Bi(()=>e.action);return(()=>{var n=gu();return Oe(n,"click",e.onClick,!0),M(n,_(ke,{get when(){return e.waiting},get fallback(){return e.children},children:"..."})),re(r=>{var i=e.waiting,o=!!e.waiting,s=!!t(Ie.Ok),l=!!t(Ie.Cancel),a=!!t(Ie.Normal);return i!==r.e&&(n.disabled=r.e=i),o!==r.t&&n.classList.toggle("waiting",r.t=o),s!==r.a&&n.classList.toggle("ok",r.a=s),l!==r.o&&n.classList.toggle("cancel",r.o=l),a!==r.i&&n.classList.toggle("normal",r.i=a),r},{e:void 0,t:void 0,a:void 0,o:void 0,i:void 0}),n})()};qe(["click"]);const Mn=(e,t,n=[],r=[])=>{if(e){if(Array.isArray(e))e.forEach(i=>Mn(i,t,n,r));else if(typeof e=="function")Mn(e.apply(null,n),t,n,r);else{const i=e;(!t||(typeof t=="function"?t(i):i.nodeName===t))&&r.push(i)}return r}};var hn=K("<div>");const pn=e=>{const[t,n]=Tr(e,["open","children","portal_selector","close_on_click_outside"]),[r,i]=q(!1),[o,s]=q(t.open);ge(()=>s(t.open));const l=d=>s(typeof d=="boolean"?d:p=>!p),a=eu(()=>Mn(t.children,d=>d.className.indexOf("sb-modal-content")!==-1,[{open:o,toggle:l,set_hold_close_outside:i}])??[]),c=I(()=>Mn(t.children,d=>d.className.indexOf("sb-modal-content")===-1,[{open:o,toggle:l,set_hold_close_outside:i}]));let u;ge(()=>o()&&u?.focus(),u?.scrollIntoView());const f=()=>We(n,{role:"dialog",tabIndex:-1,class:e.class?`sb-modal ${e.class}`:"sb-modal",children:a(),onClick:I(()=>t.close_on_click_outside?d=>{if(r())return;const p=d.target;a().some(w=>w?.contains(p))||l(!1)}:void 0)()});return _(Es,{get children(){return[_(fi,{get when(){return!o()},get children(){return c()}}),_(fi,{get when(){return o()},get children(){return[Rt(c),_(Rr,{get mount(){return t.portal_selector},get children(){var d=hn(),p=u;return typeof p=="function"?De(p,d):u=d,wt(d,We(f),!1,!1),d}})]}})]}})},Hn=e=>(()=>{var t=hn();return wt(t,We(e,{get class(){return Rt(()=>!!e.class)()?`sb-modal-content ${e.class}`:"sb-modal-content"}}),!1,!1),t})(),Wn=e=>(()=>{var t=hn();return wt(t,We(e,{get class(){return Rt(()=>!!e.class)()?`sb-modal-header ${e.class}`:"sb-modal-header"}}),!1,!1),t})(),Vn=e=>(()=>{var t=hn();return wt(t,We(e,{get class(){return Rt(()=>!!e.class)()?`sb-modal-body ${e.class}`:"sb-modal-body"}}),!1,!1),t})(),Yr=e=>(()=>{var t=hn();return wt(t,We(e,{get class(){return Rt(()=>!!e.class)()?`sb-modal-footer ${e.class}`:"sb-modal-footer"}}),!1,!1),t})();var mu=K("<label class=custom-field><input name=custom-field class=highlighted-text type=text placeholder=_><span class=placeholder>");const Qn=e=>{const t=r=>{e.on_keyup(r.target.value,r.key==="Enter")},n=()=>e.value??"";return(()=>{var r=mu(),i=r.firstChild,o=i.nextSibling;return Oe(i,"keyup",t),M(o,()=>e.placeholder),re(()=>Jt(i,"size",e.size??50)),re(()=>i.value=n()),r})()};var yu=K("<span class=error-line>");const Jn=e=>_(ke,{get when(){return e.error},children:t=>(()=>{var n=yu();return M(n,t),n})()}),wu="https://api.linechess.com:3300",Xn=(e,t)=>fetch(wu+e,{...t,credentials:"include"}).then(n=>n.json());async function _u(e,t={}){return await Xn(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).catch(r=>new bu(r))}let Zr=Xn("/session/init");const Qe=(e,t)=>Zr.then(()=>Xn(e,t)),de=(e,t={})=>Zr.then(()=>_u(e,t));class bu extends Error{constructor(t){super(t),this.name="FetchError"}}const le=e=>e instanceof Error?U.err(e):typeof e=="object"&&e.errors!==void 0?U.err(e.errors):typeof e=="object"&&e.ok===!0?U.ok(e.data):U.ok(e);function vu(){return{async logout(){await de("/logout"),Zr=Xn("/session/init")},async upgrade_account(e){await de("/upgrade-account",{lichess_username:e})},undo:function(){return de("/undo")},set_search_lines_term:function(e){return de("/search",{term:e})},next_searched_lines_page:function(e){return de("/search/next-page",{i:e})},next_playlist_page:function(e){return de("/playlist/next-page",{i:e})},like_line:function(e,t){return de("/line/like",{id:e,yes:t}).then(le)},like_playlist:function(e,t){return de("/playlist/like",{id:e,yes:t}).then(le)},edit_playlist:function(e,t){return de("/playlist/edit",{id:e,body:t}).then(le)},create_playlist:function(e,t){return de("/playlist/create",{name:e,line:t}).then(le)},delete_playlist:function(e){return de("/playlist/delete",{id:e}).then(le)},add_line_to_playlist:function(e,t){return de("/playlist/add",{id:e,line_id:t}).then(le)},delete_line:function(e){return de("/line/delete",{id:e}).then(le)},edit_line:function(e,t){return de("/line/edit",{id:e,...t}).then(le)},create_line:function(e,t,n,r){return de("/line/create",{playlist_id:e,name:t,moves:n,orientation:r}).then(le)},set_ordered_line_slots:function(e,t){return de("/line/set_ordered",{playlist_id:e,lines:t}).then(le)},get_searched_playlists:function(){return Qe("/playlist/search").then(le)},get_global_recent_playlists:function(){return Qe("/playlist/global/recent").then(le)},get_mine_recent_playlists:function(){return Qe("/playlist/mine/recent").then(le)},get_global_playlists:function(){return Qe("/playlist/global").then(le)},get_mine_playlists:function(){return Qe("/playlist/mine").then(le)},get_liked_playlists:function(){return Qe("/playlist/liked").then(le)},get_selected_playlist_model:function(e){return Qe(`/playlist/selected/${e}`).then(le)},get_working_playlist_model:function(){return Qe("/playlist/selected").then(le)}}}function Or(e,t={}){const n=t.storage||globalThis.localStorage,r=t.name||`storage-${ks()}`;if(!n)return[e[0],e[1],null];const i=t.storageOptions,o=t.serialize||JSON.stringify.bind(JSON),s=t.deserialize||JSON.parse.bind(JSON),l=n.getItem(r,i),a=typeof e[0]=="function"?u=>{try{const f=s(u);e[1](()=>f)}catch{}}:u=>{try{const f=s(u);e[1](xl(f))}catch{}};let c=!0;if(l instanceof Promise?l.then(u=>c&&u&&a(u)):l&&a(l),typeof t.sync?.[0]=="function"){const u=typeof e[0]=="function"?e[0]:()=>e[0];t.sync[0](f=>{f.key!==r||(f.url||globalThis.location.href)!==globalThis.location.href||f.newValue===o(te(u))||a(f.newValue)})}return[e[0],typeof e[0]=="function"?u=>{const f=e[1](u),d=u!=null?o(f):u;return t.sync?.[1](r,d),d!=null?n.setItem(r,d,i):n.removeItem(r,i),c=!1,f}:(...u)=>{e[1](...u);const f=o(te(()=>e[0]));t.sync?.[1](r,f),n.setItem(r,f,i),c=!1},l]}function ku(e){let t=vu();const[n,r]=Or(q(void 0,{equals:!1}),{name:".linechess.selected_line_id.v1"}),[i,o]=Or(q(void 0,{equals:!1}),{name:".linechess.selected_playlist_id.v1"}),[s,l]=q(!0,{equals:!1}),[a,c]=q(!0,{equals:!1}),[u,f]=q(!0,{equals:!1}),[d,p]=q(!0,{equals:!1}),[w,y]=q(!0,{equals:!1}),[S,O]=q(!1,{equals:!1}),[P,j]=q(!1,{equals:!1}),F=ze(async()=>{let m=i(),C;return m===void 0?(C=await t.get_working_playlist_model(),o(C.unwrap().playlist._id),l(!0)):(C=await t.get_selected_playlist_model(m),C.isErr&&(C=await t.get_working_playlist_model(),o(C.unwrap().playlist._id),l(!0))),C.map(k=>{let T=k.lines.find(W=>W._id===n())??k.lines[0];r(T?._id)}),C}),H=ze(async()=>s()?t.get_mine_playlists():U.err(new Error("No Fetch Requested"))),Y=ze(async()=>a()?t.get_liked_playlists():U.err(new Error("No Fetch Requested"))),ie=ze(async()=>u()?t.get_global_playlists():U.err(new Error("No Fetch Requested"))),N=ze(async()=>d()?t.get_mine_recent_playlists():U.err(new Error("No Fetch Requested"))),Q=ze(async()=>w()?t.get_global_recent_playlists():U.err(new Error("No Fetch Requested"))),ee=ze(async()=>P()?t.get_searched_playlists():U.err(new Error("No Fetch Requested")));function B(m){b.playlist&&A("playlist","playlist",m)}function L(m){b.global_playlists&&A("global_playlists","list",C=>C._id===m._id,m)}function z(m){b.global_recent_playlists&&A("global_recent_playlists","list",C=>C._id===m._id,m)}function x(m){b.mine_playlists&&A("mine_playlists","list",C=>C._id===m._id,m)}function h(m){b.mine_recent_playlists&&A("mine_recent_playlists","list",C=>C._id===m._id,m)}function g(m,C){b.global_playlists&&A("global_playlists","list",k=>k._id===m,"nb_lines",k=>C?k-1:k+1),b.global_recent_playlists&&A("global_recent_playlists","list",k=>k._id===m,"nb_lines",k=>C?k-1:k+1),b.mine_playlists&&A("mine_playlists","list",k=>k._id===m,"nb_lines",k=>C?k-1:k+1),b.mine_recent_playlists&&A("mine_recent_playlists","list",k=>k._id===m,"nb_lines",k=>C?k-1:k+1),b.liked_playlists&&A("liked_playlists","list",k=>k._id===m,"nb_lines",k=>C?k-1:k+1)}function v(m,C){b.global_playlists&&A("global_playlists","list",k=>k._id===m,"nb_likes",k=>C?k+1:k-1),b.global_recent_playlists&&A("global_recent_playlists","list",k=>k._id===m,"nb_likes",k=>C?k+1:k-1),b.mine_playlists&&A("mine_playlists","list",k=>k._id===m,"nb_likes",k=>C?k+1:k-1),b.mine_recent_playlists&&A("mine_recent_playlists","list",k=>k._id===m,"nb_likes",k=>C?k+1:k-1),b.liked_playlists&&A("liked_playlists","list",k=>k._id===m,"nb_likes",k=>C?k+1:k-1)}let[b,A]=Ir({get selected_line(){let m=n();return F()?.unwrap().lines.find(C=>C._id===m)},get playlist(){return F()?.unwrap()},get mine_playlists(){let m=H()?.unwrap();return m?{list:m}:void 0},get liked_playlists(){let m=Y()?.unwrap();return m?{list:m}:void 0},get global_playlists(){return ie()?.unwrap()},get mine_recent_playlists(){let m=N()?.unwrap();return m?{list:m}:void 0},get global_recent_playlists(){let m=Q()?.unwrap();return m?{list:m}:void 0},get searched_playlists(){return ee()?.unwrap()}});return[b,{async profile_login(m){await t.upgrade_account(m),o(void 0),l(!0),c(!0),f(!0),p(!0),y(!0),O(!1),j(!1)},async profile_logout(){await t.logout(),o(void 0),l(!0),c(!0),f(!0),p(!0),y(!0),O(!1),j(!1)},select_line(m){const[,{set_orientation:C,import_UCIs:k}]=e.build;r(m);let T=b.selected_line;T&&(k(T.moves),C(T.orientation))},select_playlist(m){o(m)},create_line:async function(m,C,k){let T=i(),W=await t.create_line(T,m,C,k);return W.isErr||await W.map(Z=>{Vt(()=>{Z._playlist_id===i()?b.playlist&&A("playlist","lines",b.playlist.lines.length,Z):o(Z._playlist_id),r(Z._id),g(Z._playlist_id,!1)})}),W},delete_line:async function(m){let C=b.playlist?.lines.find(T=>T._id===m)?._playlist_id,k=await t.delete_line(m);return k.isErr||(C&&g(C,!0),b.playlist&&(A("playlist","lines",b.playlist.lines.filter(T=>T._id!==m)),n()===m&&r(b.playlist.lines[0]?._id))),k},edit_line:async function(m,C,k,T){return(await t.edit_line(m,{name:C,orientation:k,moves:T})).map(Z=>{b.playlist&&A("playlist","lines",we=>we._id===Z._id,Z)})},set_ordered_line_slots:async function(m){let C=await t.set_ordered_line_slots(m[0]._playlist_id,m.map(k=>k._id));return b.playlist&&Vt(()=>{m.forEach((k,T)=>{A("playlist","lines",W=>W._id===k._id,"slot",T)})}),C.map(()=>{})},add_line_to_playlist:async function(m,C){return(await t.add_line_to_playlist(m,C)).map(T=>{r(C),o(m),f(!0),y(!0),l(!0),p(!0)})},create_playlist:async function(m,C){let k=await t.create_playlist(m,C);return k.map(T=>{o(T._id),f(!0),y(!0),l(!0),p(!0)}),k},delete_playlist:async function(){let m=i();if(m===void 0)return U.err(new Error("No Playlist Selected"));let C=await t.delete_playlist(m);return C.map(k=>{o(void 0),f(!0),y(!0),l(!0),p(!0)}),C.map(()=>{})},edit_playlist:async function(m,C){let k=await t.edit_playlist(m,{name:C});return k.map(T=>{B(T),L(T),z(T),x(T),h(T)}),k.map(()=>{})},like_playlist:async function(m,C){let k=await t.like_playlist(m,C);return c(!0),b.playlist&&b.playlist.playlist._id===m&&A("playlist","playlist","nb_likes",T=>C?T+1:T-1),v(m,C),k.map(()=>{})},next_playlist_page:async function(m){await t.next_playlist_page(m),f(!0)},next_searched_lines_page:async function(m){await t.next_searched_lines_page(m),O(S())},next_searched_playlist_page:async function(m){await t.next_searched_lines_page(m),j(P())},set_search_lines_term:async function(m){await t.set_search_lines_term(m),j(!0),O(!0)},undo:async function(){await t.undo(),o(i()),l(!0),c(!0),f(!0),p(!0),y(!0),O(!1),j(!1)}}]}const Eu=e=>{let[t]=e.openings,[n,r]=Ht(()=>t.selected_line?.orientation??"white");const[i,o]=Ht(()=>Li(t.selected_line?.moves.split(" ")??[]));let[s,l]=Ht(()=>i().length-1);const a=I(()=>i()[s()]),c=I(()=>a()?.fen??Xr),u=I(()=>qc(c())),f=I(()=>i().map(F=>F.san)),d=I(()=>a()?.uci),p=I(()=>i().slice(0,s()+1)),w=I(()=>Bc(i())),y=I(()=>jc(i())),S=F=>o(Li(F.split(" ")));let O={get orientation(){return n()},get cursor(){return s()},get fen(){return c()},get turn_color(){return u()},get san_moves(){return f()},get last_move_uci(){return d()},get export_PGN(){return w()},get export_UCI(){return y()}};const P=F=>{F<0?l(-1):i()[F]!==void 0&&l(F)};return[O,{flip(){r(ae(n()))},import_UCIs:S,set_orientation:r,add_uci_and_goto_it(F){Vt(()=>{let H=p(),Y=ts(H,F);o([...H,Y]),l(i().length-1)})},goto_next_step(){P(s()+1)},goto_prev_step(){P(s()-1)},goto_first_step(){P(0)},goto_last_step(){P(i().length-1)},goto_set_cursor(F){P(F)},clear_steps(){o([]),l(0)},delete_after(){o(p())}}]};var _e={},Mi;function Cu(){return Mi||(Mi=1,(function(e){var t=_e&&_e.__extends||(function(){var h=function(g,v){return h=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(b,A){b.__proto__=A}||function(b,A){for(var $ in A)A.hasOwnProperty($)&&(b[$]=A[$])},h(g,v)};return function(g,v){h(g,v);function b(){this.constructor=g}g.prototype=v===null?Object.create(v):(b.prototype=v.prototype,new b)}})(),n=_e&&_e.__assign||function(){return n=Object.assign||function(h){for(var g,v=1,b=arguments.length;v<b;v++){g=arguments[v];for(var A in g)Object.prototype.hasOwnProperty.call(g,A)&&(h[A]=g[A])}return h},n.apply(this,arguments)},r=_e&&_e.__awaiter||function(h,g,v,b){function A($){return $ instanceof v?$:new v(function(m){m($)})}return new(v||(v=Promise))(function($,m){function C(W){try{T(b.next(W))}catch(Z){m(Z)}}function k(W){try{T(b.throw(W))}catch(Z){m(Z)}}function T(W){W.done?$(W.value):A(W.value).then(C,k)}T((b=b.apply(h,g||[])).next())})},i=_e&&_e.__generator||function(h,g){var v={label:0,sent:function(){if($[0]&1)throw $[1];return $[1]},trys:[],ops:[]},b,A,$,m;return m={next:C(0),throw:C(1),return:C(2)},typeof Symbol=="function"&&(m[Symbol.iterator]=function(){return this}),m;function C(T){return function(W){return k([T,W])}}function k(T){if(b)throw new TypeError("Generator is already executing.");for(;v;)try{if(b=1,A&&($=T[0]&2?A.return:T[0]?A.throw||(($=A.return)&&$.call(A),0):A.next)&&!($=$.call(A,T[1])).done)return $;switch(A=0,$&&(T=[T[0]&2,$.value]),T[0]){case 0:case 1:$=T;break;case 4:return v.label++,{value:T[1],done:!1};case 5:v.label++,A=T[1],T=[0];continue;case 7:T=v.ops.pop(),v.trys.pop();continue;default:if($=v.trys,!($=$.length>0&&$[$.length-1])&&(T[0]===6||T[0]===2)){v=0;continue}if(T[0]===3&&(!$||T[1]>$[0]&&T[1]<$[3])){v.label=T[1];break}if(T[0]===6&&v.label<$[1]){v.label=$[1],$=T;break}if($&&v.label<$[2]){v.label=$[2],v.ops.push(T);break}$[2]&&v.ops.pop(),v.trys.pop();continue}T=g.call(h,v)}catch(W){T=[6,W],A=0}finally{b=$=0}if(T[0]&5)throw T[1];return{value:T[0]?T[1]:void 0,done:!0}}},o=_e&&_e.__spreadArrays||function(){for(var h=0,g=0,v=arguments.length;g<v;g++)h+=arguments[g].length;for(var b=Array(h),A=0,g=0;g<v;g++)for(var $=arguments[g],m=0,C=$.length;m<C;m++,A++)b[A]=$[m];return b};Object.defineProperty(e,"__esModule",{value:!0});var s=(function(){function h(){}return h.prototype.toString=function(){return"ErrorOAuth2"},h})();e.ErrorOAuth2=s;var l=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorUnknown"},g})(s);e.ErrorUnknown=l;var a=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorNoAuthCode"},g})(s);e.ErrorNoAuthCode=a;var c=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorInvalidReturnedStateParam"},g})(s);e.ErrorInvalidReturnedStateParam=c;var u=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorInvalidJson"},g})(s);e.ErrorInvalidJson=u;var f=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorInvalidScope"},g})(s);e.ErrorInvalidScope=f;var d=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorInvalidRequest"},g})(s);e.ErrorInvalidRequest=d;var p=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorInvalidToken"},g})(s);e.ErrorInvalidToken=p;var w=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorAuthenticationGrant"},g})(s);e.ErrorAuthenticationGrant=w;var y=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorUnauthorizedClient"},g})(w);e.ErrorUnauthorizedClient=y;var S=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorAccessDenied"},g})(w);e.ErrorAccessDenied=S;var O=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorUnsupportedResponseType"},g})(w);e.ErrorUnsupportedResponseType=O;var P=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorServerError"},g})(w);e.ErrorServerError=P;var j=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorTemporarilyUnavailable"},g})(w);e.ErrorTemporarilyUnavailable=j;var F=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorAccessTokenResponse"},g})(s);e.ErrorAccessTokenResponse=F;var H=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorInvalidClient"},g})(F);e.ErrorInvalidClient=H;var Y=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorInvalidGrant"},g})(F);e.ErrorInvalidGrant=Y;var ie=(function(h){t(g,h);function g(){return h!==null&&h.apply(this,arguments)||this}return g.prototype.toString=function(){return"ErrorUnsupportedGrantType"},g})(F);e.ErrorUnsupportedGrantType=ie;var N=(function(){function h(){this.realm="",this.error=""}return h})();e.ErrorWWWAuthenticate=N,e.RawErrorToErrorClassMap={invalid_request:d,invalid_grant:Y,unauthorized_client:y,access_denied:S,unsupported_response_type:O,invalid_scope:f,server_error:P,temporarily_unavailable:j,invalid_client:H,unsupported_grant_type:ie,invalid_json:u,invalid_token:p};function Q(h){return new(e.RawErrorToErrorClassMap[h]||l)}e.toErrorClass=Q;function ee(h){var g=h.slice(7).replace(/"/g,"").split(", ").map(function(v){var b,A=v.split("="),$=A[0],m=A[1];return b={},b[$]=m,b}).reduce(function(v,b){return n(n({},v),b)},{});return{realm:g.realm,error:g.error}}e.fromWWWAuthenticateHeaderStringToObject=ee;var B="Authorization",L="WWW-Authenticate";e.LOCALSTORAGE_ID="oauth2authcodepkce",e.LOCALSTORAGE_STATE=e.LOCALSTORAGE_ID+"-state",e.RECOMMENDED_CODE_VERIFIER_LENGTH=96,e.RECOMMENDED_STATE_LENGTH=32;var z="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",x=(function(){function h(g){return this.state={},this.config=g,this.recoverState(),this}return h.prototype.decorateFetchHTTPClient=function(g){var v=this;return function(b,A){for(var $=[],m=2;m<arguments.length;m++)$[m-2]=arguments[m];return v.state.isHTTPDecoratorActive?v.getAccessToken().then(function(C){var k=C.token,T=Object.assign({},A);return T.headers||(T.headers={}),T.headers[B]="Bearer "+k.value,g.apply(void 0,o([b,T],$))}).then(function(C){if(C.ok||!C.headers.has(L.toLowerCase()))return C;var k=Q(ee(C.headers.get(L.toLowerCase())).error);return k instanceof p&&v.config.onAccessTokenExpiry(function(){return v.exchangeRefreshTokenForAccessToken()}),Promise.reject(k)}):g.apply(void 0,o([b,A],$))}},h.prototype.isReturningFromAuthServer=function(){var g=h.extractParamFromUrl(location.href,"error");if(g)return Promise.reject(Q(g));var v=h.extractParamFromUrl(location.href,"code");if(!v)return Promise.resolve(!1);var b=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),A=h.extractParamFromUrl(location.href,"state");return A!==b.stateQueryParam?(console.warn("state query string parameter doesn't match the one sent! Possible malicious activity somewhere."),Promise.reject(new c)):(b.authorizationCode=v,b.hasAuthCodeBeenExchangedForAccessToken=!1,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(b)),this.setState(b),Promise.resolve(!0))},h.prototype.fetchAuthorizationCode=function(g){return r(this,void 0,void 0,function(){var v,b,A,$,m,C,k,T,W,Z,we;return i(this,function(rt){switch(rt.label){case 0:return this.assertStateAndConfigArePresent(),v=this.config,b=v.clientId,A=v.extraAuthorizationParams,$=v.redirectUrl,m=v.scopes,[4,h.generatePKCECodes()];case 1:return C=rt.sent(),k=C.codeChallenge,T=C.codeVerifier,W=h.generateRandomState(e.RECOMMENDED_STATE_LENGTH),this.state=n(n({},this.state),{codeChallenge:k,codeVerifier:T,stateQueryParam:W,isHTTPDecoratorActive:!0}),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state)),Z=this.config.authorizationUrl+"?response_type=code&"+("client_id="+encodeURIComponent(b)+"&")+("redirect_uri="+encodeURIComponent($)+"&")+("scope="+encodeURIComponent(m.join(" "))+"&")+("state="+W+"&")+("code_challenge="+encodeURIComponent(k)+"&")+"code_challenge_method=S256",(A||g)&&(we=n(n({},A),g),Z=Z+"&"+h.objectToQueryString(we)),location.replace(Z),[2]}})})},h.prototype.getAccessToken=function(){var g=this;this.assertStateAndConfigArePresent();var v=this.config.onAccessTokenExpiry,b=this.state,A=b.accessToken,$=b.authorizationCode,m=b.explicitlyExposedTokens,C=b.hasAuthCodeBeenExchangedForAccessToken,k=b.refreshToken,T=b.scopes;return $?this.authCodeForAccessTokenRequest?this.authCodeForAccessTokenRequest:!this.isAuthorized()||!C?(this.authCodeForAccessTokenRequest=this.exchangeAuthCodeForAccessToken(),this.authCodeForAccessTokenRequest):k&&this.isAccessTokenExpired()?v(function(){return g.exchangeRefreshTokenForAccessToken()}):Promise.resolve({token:A,explicitlyExposedTokens:m,scopes:T,refreshToken:k}):Promise.reject(new a)},h.prototype.exchangeRefreshTokenForAccessToken=function(){var g=this,v;this.assertStateAndConfigArePresent();var b=this.config,A=b.extraRefreshParams,$=b.clientId,m=b.tokenUrl,C=this.state.refreshToken;C||console.warn("No refresh token is present.");var k=m,T="grant_type=refresh_token&"+("refresh_token="+((v=C)===null||v===void 0?void 0:v.value)+"&")+("client_id="+$);return A&&(T=k+"&"+h.objectToQueryString(A)),fetch(k,{method:"POST",body:T,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(W){return W.status>=400?W.json().then(function(Z){return Promise.reject(Z)}):W.json()}).then(function(W){var Z=W.access_token,we=W.expires_in,rt=W.refresh_token,Lt=W.scope,kt=g.config.explicitlyExposedTokens,Ee=[],Ve={},gn={value:Z,expiry:new Date(Date.now()+parseInt(we)*1e3).toString()};if(g.state.accessToken=gn,rt){var mn={value:rt};g.state.refreshToken=mn}kt&&(Ve=Object.fromEntries(kt.map(function(je){return[je,W[je]]}).filter(function(je){je[0];var It=je[1];return It!==void 0})),g.state.explicitlyExposedTokens=Ve),Lt&&(Ee=Lt.split(" "),g.state.scopes=Ee),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(g.state));var Mt={token:gn,scopes:Ee};return kt&&(Mt.explicitlyExposedTokens=Ve),Mt}).catch(function(W){var Z=g.config.onInvalidGrant,we=W.error||"There was a network error.";switch(we){case"invalid_grant":Z(function(){return g.fetchAuthorizationCode()});break}return Promise.reject(Q(we))})},h.prototype.getGrantedScopes=function(){return this.state.scopes},h.prototype.isHTTPDecoratorActive=function(g){this.state.isHTTPDecoratorActive=g,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(this.state))},h.prototype.isAuthorized=function(){return!!this.state.accessToken},h.prototype.isAccessTokenExpired=function(){var g=this.state.accessToken;return!!(g&&new Date>=new Date(g.expiry))},h.prototype.reset=function(){this.setState({}),this.authCodeForAccessTokenRequest=void 0},h.prototype.assertStateAndConfigArePresent=function(){if(!this.state||!this.config)throw console.error("state:",this.state,"config:",this.config),new Error("state or config is not set.")},h.prototype.exchangeAuthCodeForAccessToken=function(g){var v=this;this.assertStateAndConfigArePresent();var b=this.state,A=b.authorizationCode,$=A===void 0?g:A,m=b.codeVerifier,C=m===void 0?"":m,k=this.config,T=k.clientId,W=k.onInvalidGrant,Z=k.redirectUrl;C?$||console.warn("No authorization grant code is being passed."):console.warn("No code verifier is being sent.");var we=this.config.tokenUrl,rt="grant_type=authorization_code&"+("code="+encodeURIComponent($||"")+"&")+("redirect_uri="+encodeURIComponent(Z)+"&")+("client_id="+encodeURIComponent(T)+"&")+("code_verifier="+C);return fetch(we,{method:"POST",body:rt,headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(Lt){var kt=Lt.json().catch(function(Ee){return{error:"invalid_json"}});return Lt.ok?kt.then(function(Ee){var Ve=Ee.access_token,gn=Ee.expires_in,mn=Ee.refresh_token,Mt=Ee.scope,je=v.config.explicitlyExposedTokens,It=[],Yn={};v.state.hasAuthCodeBeenExchangedForAccessToken=!0,v.authCodeForAccessTokenRequest=void 0;var ri={value:Ve,expiry:new Date(Date.now()+parseInt(gn)*1e3).toString()};if(v.state.accessToken=ri,mn){var as={value:mn};v.state.refreshToken=as}je&&(Yn=Object.fromEntries(je.map(function(Nt){return[Nt,Ee[Nt]]}).filter(function(Nt){Nt[0];var cs=Nt[1];return cs!==void 0})),v.state.explicitlyExposedTokens=Yn),Mt&&(It=Mt.split(" "),v.state.scopes=It),localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(v.state));var ii={token:ri,scopes:It};return je&&(ii.explicitlyExposedTokens=Yn),ii}):kt.then(function(Ee){var Ve=Ee.error;switch(Ve){case"invalid_grant":W(function(){return v.fetchAuthorizationCode()});break}return Promise.reject(Q(Ve))})})},h.prototype.recoverState=function(){return this.state=JSON.parse(localStorage.getItem(e.LOCALSTORAGE_STATE)||"{}"),this},h.prototype.setState=function(g){return this.state=g,localStorage.setItem(e.LOCALSTORAGE_STATE,JSON.stringify(g)),this},h.base64urlEncode=function(g){var v=btoa(g);return v=v.replace(/\+/g,"-"),v=v.replace(/\//g,"_"),v=v.replace(/=/g,""),v},h.extractParamFromUrl=function(g,v){var b=g.split("?");if(b.length<2)return"";b=b[1].split("#");var A=b[0].split("&").reduce(function(m,C){return m.concat(C.split("="))},[]);if(A.length<2)return"";var $=A.indexOf(v);return decodeURIComponent($>=0?A[$+1]:"")},h.objectToQueryString=function(g){return Object.entries(g).map(function(v){var b=v[0],A=v[1];return b+"="+encodeURIComponent(A)}).join("&")},h.generatePKCECodes=function(){var g=new Uint32Array(e.RECOMMENDED_CODE_VERIFIER_LENGTH);crypto.getRandomValues(g);var v=h.base64urlEncode(Array.from(g).map(function(b){return z[b%z.length]}).join(""));return crypto.subtle.digest("SHA-256",new TextEncoder().encode(v)).then(function(b){for(var A=new Uint8Array(b),$="",m=A.byteLength,C=0;C<m;C++)$+=String.fromCharCode(A[C]);return $}).then(h.base64urlEncode).then(function(b){return{codeChallenge:b,codeVerifier:v}})},h.generateRandomState=function(g){var v=new Uint32Array(g);return crypto.getRandomValues(v),Array.from(v).map(function(b){return z[b%z.length]}).join("")},h})();e.OAuth2AuthCodePKCE=x})(_e)),_e}var Su=Cu();const Au="https://lichess.org";function Ii(e){const t=n=>fetch(Au+n,{headers:{Authorization:`Bearer ${e}`}}).then(r=>r.json());return{async fetch_username(){return(await t("/api/account")).username}}}function Pu(e){const t=(()=>{const p=new URL(location.href);return p.search="",p.href})();let n=new Su.OAuth2AuthCodePKCE({authorizationUrl:"https://lichess.org/oauth",tokenUrl:"https://lichess.org/api/token",clientId:"linechess.com",scopes:[""],redirectUrl:t,onAccessTokenExpiry:p=>p(),onInvalidGrant:p=>{}});const r=async()=>{await n.fetchAuthorizationCode()};let[i,o]=Or(q(void 0,{equals:!1}),{name:".linechess.lichess-token"});const[,{profile_login:s,profile_logout:l}]=e.openings;let a=ze(async()=>{let p=i();if(await n.isReturningFromAuthServer()){let{token:y}=await n.getAccessToken();if(y){window.history.replaceState({},document.title,"/"),o(y.value);let O=Ii(y.value),P=await O.fetch_username();return P&&s(P),O}}if(p)return Ii(p)});const c=()=>{o(void 0),l()},u=ze(async()=>a()?.fetch_username());let[f]=Ir({get username(){return u()}});return[f,{login:r,logout:c}]}const is=an();function ei(){return mt(is)}function Pe(){return ei().openings}function $u(){return ei().build}function Ou(){return ei().lichess}function Tu(e){let t,n,r;const[i]=Ir({get lichess(){return r},get openings(){return t},get build(){return n}});return t=ku(i),n=Eu(i),r=Pu(i),_(is.Provider,{value:i,get children(){return e.children}})}var Ru=K("<div class=openings><div class=build><h3>Build</h3><div class=board-wrap><div class=board></div></div><div class=board-tools><a>Flip</a></div></div><div class=explore><h3>Explore</h3><div class=line-info-wrap></div><div class=replay-wrap><div class=replay-tools><a></a><a>Clear</a><a>Delete after</a></div></div><div class=error-info>&nbsp;</div><div class=tools><div class=action>"),xu=K("<span class=no-line>No Line Selected"),Lu=K("<span class=no-line-to-save>Play an opening line to save it."),Mu=K("<div class=line-info><div class=playlist-info><span class=name></span>by<span class=author></span></div><span class=line>"),Iu=K("<div class=playlist><h3>Playlist</h3><div class=filters><div class=tab>Mine</div><div class=tab>Liked</div><div class=tab>Global</div></div><div class=lists></div><div class=room></div><div class=info></div><div class=lines>"),Nu=K("<div class=sortable-list-portal>"),Du=K("<div class=dropdown-menu-portal>"),Fu=K("<div class=modal-portal>"),Uu=K("<span class=no-playlist>Please Select a Playlist"),ti=K("<ul>"),qu=K("<li class=item-new><div class=icon>+</div><div class=title>Create New Playlist"),ju=K("<li class=item><div class=title></div><div class=likes> </div><div class=nb> lines"),Bu=K("<div class=author>by <span>"),zu=K("<span class=no-lines>No Lines here. Let's add some lines."),Ku=K("<div class=title>"),os=K("<ul><li><div>Edit </div></li><li class=red>Delete "),Gu=K("<div class=more>"),Hu=K("<div class=a-line><span class=name></span><div class=more>"),Wu=K("<div class=number2> woop woop!"),Vu=K("<h3>Edit Line"),Qu=K("<h3>Edit Playlist"),Ju=K("<h3>Create New Playlist"),Xu=K("<h2>Add To Playlist"),Yu=K("<div class=close>"),Zu=K("<div class=add-to-playlist-modal-body><h3>Recent</h3><div class=recent></div><h3>All</h3><div class=all></div><div class=new-playlist-float>");const ef=()=>{let[e,{flip:t,add_uci_and_goto_it:n,goto_next_step:r,goto_prev_step:i,goto_set_cursor:o,clear_steps:s,delete_after:l}]=$u();const a=(N,Q)=>{let ee=N+Q;{let B=Gn(e.fen),L=B.turn;B.board.get(Gt(N)).role==="pawn"&&(Q[1]==="8"&&L==="white"||Q[1]==="1"&&L==="black")&&(ee+="q")}n(ee)},c=N=>{N<0?i():r()},[u,f]=q(!1),d=I(()=>u()?"Copied!":"Copy"),p=async()=>{await navigator.clipboard.writeText(e.export_PGN),f(!0),await new Promise(N=>setTimeout(N,1e3)),f(!1)};let w;const y=(N,Q)=>{w=N},[S,O]=q(void 0),[P,j]=q("",{equals:!1}),F=N=>{O(N),setTimeout(()=>{O(void 0)},2e3)},[H,{create_line:Y}]=Pe(),ie=async()=>{if(w===void 0||w.length<3){F("Opening Line Name must be at least 3 characters long.");return}let N=w,Q=e.export_UCI;if(Q.split(" ").length<3){F("You should play at least 3 moves.");return}await Y(N,Q,e.orientation),j(""),w=""};return(()=>{var N=Ru(),Q=N.firstChild,ee=Q.firstChild,B=ee.nextSibling,L=B.firstChild,z=B.nextSibling,x=z.firstChild,h=Q.nextSibling,g=h.firstChild,v=g.nextSibling,b=v.nextSibling,A=b.firstChild,$=A.firstChild,m=$.nextSibling,C=m.nextSibling,k=b.nextSibling;k.firstChild;var T=k.nextSibling,W=T.firstChild;return Oe(L,"wheel",{handleEvent:Hc(c),passive:!1}),M(L,_(Gc,{get fen(){return e.fen},play_orig_key:a,get turn_color(){return e.turn_color},get movable_color(){return e.turn_color},get orientation(){return e.orientation},get last_move_uci(){return e.last_move_uci}})),Oe(x,"click",t,!0),M(v,_(ke,{get when(){return H.selected_line},get fallback(){return xu()},children:Z=>_(tf,{get line(){return Z()},get playlist(){return H.playlist}})})),M(b,_(Xc,{get fallback(){return Lu()},get san_moves(){return e.san_moves},get cursor(){return e.cursor},on_set_cursor:o}),A),$.$$click=p,M($,d),Oe(m,"click",s,!0),Oe(C,"click",l,!0),M(k,_(Jn,{get error(){return S()}}),null),M(T,_(Qn,{get value(){return P()},size:30,on_keyup:y,placeholder:"Opening Line Name"}),W),M(W,_(Vc,{meet:!0,onClick:ie,children:"Save"}),null),M(W,_(pn,{close_on_click_outside:!0,get portal_selector(){return document.querySelector(".modal-portal")},children:({toggle:Z,set_hold_close_outside:we})=>_(hf,{toggle:Z,set_hold_close_outside:we})}),null),M(N,_(nf,{}),null),N})()},tf=e=>(()=>{var t=Mu(),n=t.firstChild,r=n.firstChild,i=r.nextSibling,o=i.nextSibling,s=n.nextSibling;return M(r,()=>e.playlist.playlist.name),M(o,()=>e.playlist.playlist.author??"You"),M(s,()=>e.line.name),t})(),nf=()=>{let[e]=Pe();const t=I(()=>e.playlist),[n,r]=q("mine"),i=Bi(n),o={mine:sf,liked:of,global:rf};return[(()=>{var s=Iu(),l=s.firstChild,a=l.nextSibling,c=a.firstChild,u=c.nextSibling,f=u.nextSibling,d=a.nextSibling,p=d.nextSibling,w=p.nextSibling,y=w.nextSibling;return c.$$click=S=>r("mine"),u.$$click=S=>r("liked"),f.$$click=S=>r("global"),M(d,_(Qs,{get component(){return o[n()]}})),M(w,_(ke,{get when(){return t()},get fallback(){return Uu()},children:S=>_(af,{get playlist(){return S().playlist}})})),M(y,_(ke,{get when(){return t()},children:S=>_(lf,{get lines(){return S().lines}})})),re(S=>{var O=!!i("mine"),P=!!i("liked"),j=!!i("global");return O!==S.e&&c.classList.toggle("active",S.e=O),P!==S.t&&u.classList.toggle("active",S.t=P),j!==S.a&&f.classList.toggle("active",S.a=j),S},{e:void 0,t:void 0,a:void 0}),s})(),Nu(),Du(),Fu()]},rf=()=>{let[e]=Pe();const t=I(()=>e.global_playlists?.list??[]);return(()=>{var n=ti();return M(n,_(fn,{get each(){return t()},children:r=>_(ni,{item:r})})),n})()},of=()=>{let[e]=Pe();const t=I(()=>e.liked_playlists?.list);return(()=>{var n=ti();return M(n,_(fn,{get each(){return t()},children:r=>_(ni,{item:r})})),n})()},sf=()=>{let[e]=Pe();const t=I(()=>e.mine_playlists?.list);return(()=>{var n=ti();return M(n,_(pn,{close_on_click_outside:!0,get portal_selector(){return document.querySelector(".modal-portal")},children:({open:r,toggle:i})=>[(()=>{var o=qu();return o.$$click=()=>i(!0),o})(),_(ss,{open:r,toggle:i})]}),null),M(n,_(fn,{get each(){return t()},children:r=>_(ni,{item:r})}),null),n})()},ni=e=>{const[t,{select_playlist:n}]=Pe(),r=I(()=>e.item),i=I(()=>t.playlist?.playlist._id===e.item._id);ln(()=>{ls(i,o,"lists")});let o;return(()=>{var s=ju(),l=s.firstChild,a=l.nextSibling,c=a.firstChild,u=a.nextSibling,f=u.firstChild;s.$$click=()=>n(e.item._id);var d=o;return typeof d=="function"?De(d,s):o=s,M(l,()=>r().name),M(s,_(ke,{get when(){return r().author},children:p=>(()=>{var w=Bu(),y=w.firstChild,S=y.nextSibling;return M(S,p),w})()}),a),M(a,()=>r().nb_likes,c),M(a,_(Te,{get icon(){return Re.HeartFilled}}),null),M(u,()=>r().nb_lines,f),re(()=>s.classList.toggle("active",!!i())),s})()},lf=e=>{let[,{set_ordered_line_slots:t}]=Pe();const n=I(()=>e.lines.slice(0).sort((r,i)=>r.slot-i.slot));return _(ke,{get when(){return n()},get fallback(){return zu()},children:r=>_(uu,{set_ordered:t,children:cf,dragging:uf,get portal_selector(){return document.querySelector(".sortable-list-portal")},get list(){return r()}})})},af=e=>{const[,{like_playlist:t,delete_playlist:n}]=Pe(),[r,i]=q(!1,{equals:!1});return[(()=>{var o=Ku();return M(o,()=>e.playlist.name),o})(),(()=>{var o=Gu();return M(o,_(pu,{get nb_heart(){return e.playlist.nb_likes},get is_heart(){return e.playlist.have_liked},on_heart:s=>t(e.playlist._id,s)}),null),M(o,_(rs,{get portal_selector(){return document.querySelector(".dropdown-menu-portal")},get button(){return _(Te,{get icon(){return Re.Gear}})},get children(){var s=os(),l=s.firstChild,a=l.firstChild;a.firstChild;var c=l.nextSibling;return c.firstChild,a.$$click=()=>i(!0),M(a,_(Te,{get icon(){return Re.Gears}}),null),Oe(c,"click",n,!0),M(c,_(Te,{get icon(){return Re.Delete}}),null),s}}),null),M(o,_(pn,{close_on_click_outside:!0,get open(){return r()},get portal_selector(){return document.querySelector(".modal-portal")},children:({open:s,toggle:l})=>_(df,{get playlist(){return e.playlist},toggle:l,open:s})}),null),o})()]},cf=e=>{const[t,{select_line:n,delete_line:r}]=Pe(),[i,o]=q(!1,{equals:!1}),s=I(()=>t.selected_line===e);let l;ln(()=>{ls(s,l,"sortable-list-wrap")});const a=()=>{n(e._id)};return(()=>{var c=Hu(),u=c.firstChild,f=u.nextSibling;c.$$click=a;var d=l;return typeof d=="function"?De(d,c):l=c,M(u,()=>e.name),M(f,_(rs,{get portal_selector(){return document.querySelector(".dropdown-menu-portal")},get button(){return _(Te,{get icon(){return Re.Gear}})},get children(){var p=os(),w=p.firstChild,y=w.firstChild;y.firstChild;var S=w.nextSibling;return S.firstChild,y.$$click=()=>o(!0),M(y,_(Te,{get icon(){return Re.Gears}}),null),S.$$click=()=>r(e._id),M(S,_(Te,{get icon(){return Re.Delete}}),null),p}})),M(c,_(pn,{close_on_click_outside:!0,get open(){return i()},get portal_selector(){return document.querySelector(".modal-portal")},children:({open:p,toggle:w})=>_(ff,{line:e,open:p,toggle:w})}),null),re(()=>c.classList.toggle("active",!!s())),c})()},uf=e=>(()=>{var t=Wu(),n=t.firstChild;return M(t,()=>e.name,n),t})(),ff=e=>{let[t,n]=q(void 0);const[,{edit_line:r}]=Pe();let[i,o]=q("");const s=(a,c)=>{o(a),c&&l()},l=()=>{if(i().length<3){n("Line Name must be at least 3 characters long.");return}n(void 0),r(e.line._id,i()),e.toggle(!1)};return ge(gt(e.open,a=>{a||(n(void 0),o(""))})),_(Hn,{get children(){return[_(Wn,{get children(){return Vu()}}),_(Vn,{get children(){return[_(Jn,{get error(){return t()}}),_(Qn,{get value(){return i()},placeholder:"Line Name",on_keyup:s})]}}),_(Yr,{get children(){return[_(pt,{get action(){return Ie.Cancel},onClick:()=>e.toggle(!1),children:"Cancel"}),_(pt,{get action(){return Ie.Ok},onClick:l,children:"Ok"})]}})]}})},df=e=>{let[t,n]=q(void 0);const[,{edit_playlist:r}]=Pe();let[i,o]=q("");const s=(a,c)=>{o(a),c&&l()},l=()=>{if(i().length<3){n("Playlist Name must be at least 3 characters long.");return}n(void 0),r(e.playlist._id,i()),e.toggle(!1)};return ge(gt(e.open,a=>{a||(n(void 0),o(""))})),_(Hn,{get children(){return[_(Wn,{get children(){return Qu()}}),_(Vn,{get children(){return[_(Jn,{get error(){return t()}}),_(Qn,{get value(){return i()},placeholder:"Playlist Name",on_keyup:s})]}}),_(Yr,{get children(){return[_(pt,{get action(){return Ie.Cancel},onClick:()=>e.toggle(!1),children:"Cancel"}),_(pt,{get action(){return Ie.Ok},onClick:l,children:"Ok"})]}})]}})},ss=e=>{let[t,n]=q(void 0),[r,i]=q(!1),[,{create_playlist:o}]=Pe(),[s,l]=q("");const a=async(u,f)=>{l(u),f&&c()},c=async()=>{if(s().length<3){n("Playlist Name must be at least 3 characters long.");return}i(!0),n(void 0);let u=await o(s());u.isOk?e.toggle(!1):u.isErr&&n(u.error.message??"Something went wrong."),i(!1)};return ge(gt(e.open,u=>{u||(n(void 0),i(!1),l(""))})),_(Hn,{get children(){return[_(Wn,{get children(){return Ju()}}),_(Vn,{get children(){return[_(Qn,{get value(){return s()},placeholder:"Playlist Name",on_keyup:a}),_(Jn,{get error(){return t()}})]}}),_(Yr,{get children(){return[_(pt,{get action(){return Ie.Cancel},onClick:()=>e.toggle(!1),children:"Cancel"}),_(pt,{get waiting(){return r()},get action(){return Ie.Ok},onClick:()=>c(),children:"Create"})]}})]}})},hf=e=>{const t=n=>(ge(()=>{e.set_hold_close_outside(n.open())}),Ne(()=>{e.set_hold_close_outside(!1)}),[_(pt,{get action(){return Ie.Normal},onClick:()=>n.toggle(!0),children:"+ New Playlist"}),_(ss,{get open(){return n.open},get toggle(){return n.toggle}})]);return _(Hn,{get children(){return[_(Wn,{get children(){return[Xu(),(()=>{var n=Yu();return n.$$click=()=>e.toggle(!1),M(n,_(Te,{get icon(){return Re.CrossX}})),n})()]}}),_(Vn,{get children(){var n=Zu(),r=n.firstChild,i=r.nextSibling,o=i.nextSibling,s=o.nextSibling,l=s.nextSibling;return M(l,_(pn,{close_on_click_outside:!0,get portal_selector(){return document.querySelector(".modal-portal")},children:({open:a,toggle:c})=>_(t,{toggle:c,open:a})})),n}})]}})},ls=(e,t,n)=>{const r=()=>{let i=t.parentElement;for(;i!==void 0;){if(i?.classList.contains(n))return i;i=i?.parentElement}return i};ge(gt(e,i=>{if(t!==void 0&&i){const c=r();if(!c)return;let u=c,f=t;var o=u.getBoundingClientRect(),s={height:u.clientHeight,width:u.clientWidth},l=f.getBoundingClientRect(),a=l.top>=o.top&&l.bottom<=o.top+s.height;a||c.scroll({top:t.offsetTop,behavior:"smooth"})}}))};qe(["click"]);var pf=K("<div class=challenges><div class=skills><h3>Skills</h3></div><div class=boards><h3>Leaderboards");const gf=()=>pf();var mf=K("<div class=main-wrap>"),yf=K("<small class=com>.com"),wf=K("<main class=main><h1></h1><p> Explore, Build, and Share opening lines.</p><p> Complete Challenges on a unique Skill Tree. </p><p> Compete on the Leaderboards. </p><p> Free, Open Source, No Ads, No Trackers.</p><p>For the  of Chess</p><section class=section-openings><h2>Openings</h2></section><section class=section-challenges><h2>Challenges"),_f=K("<footer><!><!>"),bf=K("<p><small><a>Login with Lichess</a> to make your data publicly available."),vf=K("<p>Welcome from Lichess, <!>! <small><a>Logout.");const kf=Dn(()=>Fn(()=>import("./MainLegal-CHb4rmpJ.js"),__vite__mapDeps([0,1]))),Ef=Dn(()=>Fn(()=>import("./Main404-B9_5e72i.js"),[])),Cf=Dn(()=>Fn(()=>import("./MainAbout-y_45SMR-.js"),__vite__mapDeps([2,1]))),Sf=Dn(()=>Fn(()=>import("./MainContact-B-K_AJCw.js"),__vite__mapDeps([3,4,1])));function Af(){return _(Al,{root:Pf,get children(){return[_(Dt,{path:"/",component:$f}),_(Dt,{path:"/about",component:Cf}),_(Dt,{path:"/legal",component:kf}),_(Dt,{path:"/contact",component:Sf}),_(Dt,{path:"*",component:Ef})]}})}function Pf(e){return(()=>{var t=mf();return M(t,_(Tu,{get children(){return e.children}})),t})()}function $f(){const[e,{login:t,logout:n}]=Ou();return[(()=>{var r=wf(),i=r.firstChild,o=i.nextSibling,s=o.nextSibling,l=s.nextSibling,a=l.nextSibling,c=a.nextSibling,u=c.nextSibling;u.firstChild;var f=u.nextSibling;return f.firstChild,M(i,_(Ft,{class:"title",href:"/",get children(){return["LineChess",yf()]}})),M(r,_(Ss,{fallback:"...",get children(){return _(ke,{get when(){return e.username},get fallback(){return(()=>{var d=bf(),p=d.firstChild,w=p.firstChild;return Oe(w,"click",t,!0),d})()},children:d=>(()=>{var p=vf(),w=p.firstChild,y=w.nextSibling,S=y.nextSibling,O=S.nextSibling,P=O.firstChild;return M(p,d,y),Oe(P,"click",n,!0),p})()})}}),u),M(u,_(ef,{}),null),M(f,_(gf,{}),null),r})(),(()=>{var r=_f(),i=r.firstChild,o=i.nextSibling,s=o.nextSibling,l=s.nextSibling;return l.nextSibling,M(r,_(Ft,{href:"/",children:"LineChess.com"}),i),M(r,_(Ft,{href:"/about",children:"About"}),o),M(r,_(Ft,{href:"/legal",children:"Legal"}),l),M(r,_(Ft,{href:"/contact",children:"Contact"}),null),r})()]}qe(["click"]);const Of=document.getElementById("root");Ns(()=>_(Af,{}),Of);export{Ft as A,q as a,I as b,_ as c,re as d,qe as e,M as i,K as t};
